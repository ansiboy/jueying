"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}!function(factory){if("function"==typeof require&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))){var target=module.exports||exports,result=factory(require);Object.assign(target,result)}else"function"==typeof define&&define.amd?define(factory):factory()}(function(){!function($){$.fn.drag=function(str,arg,opts){var type="string"==typeof str?str:"",fn=$.isFunction(str)?str:$.isFunction(arg)?arg:null;return 0!==type.indexOf("drag")&&(type="drag"+type),opts=(str==fn?arg:opts)||{},fn?this.bind(type,opts,fn):this.trigger(type)};var $event=$.event,$special=$event.special,drag=$special.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(obj){var data=$.data(this,drag.datakey),opts=obj.data||{};data.related+=1,$.each(drag.defaults,function(key,def){void 0!==opts[key]&&(data[key]=opts[key])})},remove:function(){$.data(this,drag.datakey).related-=1},setup:function(){if(!$.data(this,drag.datakey)){var data=$.extend({related:0},drag.defaults);$.data(this,drag.datakey,data),$event.add(this,"touchstart mousedown",drag.init,data),this.attachEvent&&this.attachEvent("ondragstart",drag.dontstart)}},teardown:function(){($.data(this,drag.datakey)||{}).related||($.removeData(this,drag.datakey),$event.remove(this,"touchstart mousedown",drag.init),drag.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",drag.dontstart))},init:function(event){if(!drag.touched){var results,dd=event.data;if(!(0!=event.which&&0<dd.which&&event.which!=dd.which)&&!$(event.target).is(dd.not)&&(!dd.handle||$(event.target).closest(dd.handle,event.currentTarget).length)&&(drag.touched="touchstart"==event.type?this:null,dd.propagates=1,dd.mousedown=this,dd.interactions=[drag.interaction(this,dd)],dd.target=event.target,dd.pageX=event.pageX,dd.pageY=event.pageY,dd.dragging=null,results=drag.hijack(event,"draginit",dd),dd.propagates))return(results=drag.flatten(results))&&results.length&&(dd.interactions=[],$.each(results,function(){dd.interactions.push(drag.interaction(this,dd))})),dd.propagates=dd.interactions.length,!1!==dd.drop&&$special.drop&&$special.drop.handler(event,dd),drag.textselect(!1),drag.touched?$event.add(drag.touched,"touchmove touchend",drag.handler,dd):$event.add(document,"mousemove mouseup",drag.handler,dd),!(!drag.touched||dd.live)&&void 0}},interaction:function(elem,dd){var offset=$(elem)[dd.relative?"position":"offset"]()||{top:0,left:0};return{drag:elem,callback:new drag.callback,droppable:[],offset:offset}},handler:function(event){var dd=event.data;switch(event.type){case!dd.dragging&&"touchmove":event.preventDefault();case!dd.dragging&&"mousemove":if(Math.pow(event.pageX-dd.pageX,2)+Math.pow(event.pageY-dd.pageY,2)<Math.pow(dd.distance,2))break;event.target=dd.target,drag.hijack(event,"dragstart",dd),dd.propagates&&(dd.dragging=!0);case"touchmove":event.preventDefault();case"mousemove":if(dd.dragging){if(drag.hijack(event,"drag",dd),dd.propagates){!1!==dd.drop&&$special.drop&&$special.drop.handler(event,dd);break}event.type="mouseup"}case"touchend":case"mouseup":default:drag.touched?$event.remove(drag.touched,"touchmove touchend",drag.handler):$event.remove(document,"mousemove mouseup",drag.handler),dd.dragging&&(!1!==dd.drop&&$special.drop&&$special.drop.handler(event,dd),drag.hijack(event,"dragend",dd)),drag.textselect(!0),!1===dd.click&&dd.dragging&&$.data(dd.mousedown,"suppress.click",(new Date).getTime()+5),dd.dragging=drag.touched=!1}},hijack:function(event,type,dd,x,elem){if(dd){var result,ia,callback,orig={event:event.originalEvent,type:event.type},mode=type.indexOf("drop")?"drag":"drop",i=x||0,len=isNaN(x)?dd.interactions.length:x;event.type=type,event.originalEvent=null,dd.results=[];do{if(ia=dd.interactions[i]){if("dragend"!==type&&ia.cancelled)continue;callback=drag.properties(event,dd,ia),ia.results=[],$(elem||ia[mode]||dd.droppable).each(function(p,subject){if(callback.target=subject,!(event.isPropagationStopped=function(){return!1})===(result=subject?$event.dispatch.call(subject,event,callback):null)?("drag"==mode&&(ia.cancelled=!0,dd.propagates-=1),"drop"==type&&(ia[mode][p]=null)):"dropinit"==type&&ia.droppable.push(drag.element(result)||subject),"dragstart"==type&&(ia.proxy=$(drag.element(result)||ia.drag)[0]),ia.results.push(result),delete event.result,"dropinit"!==type)return result}),dd.results[i]=drag.flatten(ia.results),"dropinit"==type&&(ia.droppable=drag.flatten(ia.droppable)),"dragstart"!=type||ia.cancelled||callback.update()}}while(++i<len);return event.type=orig.type,event.originalEvent=orig.event,drag.flatten(dd.results)}},properties:function(event,dd,ia){var obj=ia.callback;return obj.drag=ia.drag,obj.proxy=ia.proxy||ia.drag,obj.startX=dd.pageX,obj.startY=dd.pageY,obj.deltaX=event.pageX-dd.pageX,obj.deltaY=event.pageY-dd.pageY,obj.originalX=ia.offset.left,obj.originalY=ia.offset.top,obj.offsetX=obj.originalX+obj.deltaX,obj.offsetY=obj.originalY+obj.deltaY,obj.drop=drag.flatten((ia.drop||[]).slice()),obj.available=drag.flatten((ia.droppable||[]).slice()),obj},element:function(arg){if(arg&&(arg.jquery||1==arg.nodeType))return arg},flatten:function(arr){return $.map(arr,function(member){return member&&member.jquery?$.makeArray(member):member&&member.length?drag.flatten(member):member})},textselect:function(bool){$(document)[bool?"unbind":"bind"]("selectstart",drag.dontstart).css("MozUserSelect",bool?"":"none"),document.unselectable=bool?"off":"on"},dontstart:function(){return!1},callback:function(){}};drag.callback.prototype={update:function(){$special.drop&&this.available.length&&$.each(this.available,function(i){$special.drop.locate(this,i)})}};var $dispatch=$event.dispatch;$event.dispatch=function(event){if(!(0<$.data(this,"suppress."+event.type)-(new Date).getTime()))return $dispatch.apply(this,arguments);$.removeData(this,"suppress."+event.type)};var touchHooks=$event.fixHooks.touchstart=$event.fixHooks.touchmove=$event.fixHooks.touchend=$event.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(event,orig){if(orig){var touched=orig.touches&&orig.touches[0]||orig.changedTouches&&orig.changedTouches[0]||null;touched&&$.each(touchHooks.props,function(i,prop){event[prop]=touched[prop]})}return event}};$special.draginit=$special.dragstart=$special.dragend=drag}(jQuery),function($){var $event=$.event,drag=$event.special.drag,origadd=drag.add,origteardown=drag.teardown;drag.noBubble=!1,drag.livekey="livedrag",drag.add=function(obj){origadd.apply(this,arguments);var data=$.data(this,drag.datakey);!data.live&&obj.selector&&(data.live=!0,$event.add(this,"draginit."+drag.livekey,drag.delegate))},drag.teardown=function(){origteardown.apply(this,arguments);var data=$.data(this,drag.datakey)||{};data.live&&($event.remove(this,"draginit."+drag.livekey,drag.delegate),data.live=!1)},drag.delegate=function(event){var target,elems=[],events=$.data(this,"events")||{};return $.each(events||[],function(key,arr){0===key.indexOf("drag")&&$.each(arr||[],function(i,obj){(target=$(event.target).closest(obj.selector,event.currentTarget)[0])&&($event.add(target,obj.origType+"."+drag.livekey,obj.origHandler||obj.handler,obj.data),$.inArray(target,elems)<0&&elems.push(target))})}),!!elems.length&&$(elems).bind("dragend."+drag.livekey,function(){$event.remove(this,"."+drag.livekey)})}}(jQuery),function($){$.fn.drop=function(str,arg,opts){var type="string"==typeof str?str:"",fn=$.isFunction(str)?str:$.isFunction(arg)?arg:null;return 0!==type.indexOf("drop")&&(type="drop"+type),opts=(str==fn?arg:opts)||{},fn?this.bind(type,opts,fn):this.trigger(type)},$.drop=function(opts){opts=opts||{},drop.multi=!0===opts.multi?1/0:!1===opts.multi?1:isNaN(opts.multi)?drop.multi:opts.multi,drop.delay=opts.delay||drop.delay,drop.tolerance=$.isFunction(opts.tolerance)?opts.tolerance:null===opts.tolerance?null:drop.tolerance,drop.mode=opts.mode||drop.mode||"intersect"};var $special=$.event.special,drop=$.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(obj){$.data(this,drop.datakey).related+=1},remove:function(){$.data(this,drop.datakey).related-=1},setup:function(){if(!$.data(this,drop.datakey)){$.data(this,drop.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}}),drop.targets.push(this)}},teardown:function(){if(!($.data(this,drop.datakey)||{}).related){$.removeData(this,drop.datakey);var element=this;drop.targets=$.grep(drop.targets,function(target){return target!==element})}},handler:function(event,dd){var $targets;if(dd)switch(event.type){case"mousedown":case"touchstart":$targets=$(drop.targets),"string"==typeof dd.drop&&($targets=$targets.filter(dd.drop)),$targets.each(function(){var data=$.data(this,drop.datakey);data.active=[],data.anyactive=0,data.winner=0}),dd.droppable=$targets,$special.drag.hijack(event,"dropinit",dd);break;case"mousemove":case"touchmove":drop.event=event,drop.timer||drop.tolerate(dd);break;case"mouseup":case"touchend":drop.timer=clearTimeout(drop.timer),dd.propagates&&($special.drag.hijack(event,"drop",dd),$special.drag.hijack(event,"dropend",dd))}},locate:function(elem,index){var data=$.data(elem,drop.datakey),$elem=$(elem),posi=$elem.offset()||{},height=$elem.outerHeight(),width=$elem.outerWidth(),location={elem:elem,width:width,height:height,top:posi.top,left:posi.left,right:posi.left+width,bottom:posi.top+height};return data&&(data.location=location,data.index=index,data.elem=elem),location},contains:function(target,test){return(test[0]||test.left)>=target.left&&(test[0]||test.right)<=target.right&&(test[1]||test.top)>=target.top&&(test[1]||test.bottom)<=target.bottom},modes:{intersect:function(event,proxy,target){return this.contains(target,[event.pageX,event.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(event,proxy,target){return Math.max(0,Math.min(target.bottom,proxy.bottom)-Math.max(target.top,proxy.top))*Math.max(0,Math.min(target.right,proxy.right)-Math.max(target.left,proxy.left))},fit:function(event,proxy,target){return this.contains(target,proxy)?1:0},middle:function(event,proxy,target){return this.contains(target,[proxy.left+.5*proxy.width,proxy.top+.5*proxy.height])?1:0}},sort:function(a,b){return b.winner-a.winner||a.index-b.index},tolerate:function(dd){var i,drp,drg,data,arr,len,elem,ia,x=0,end=dd.interactions.length,xy=[drop.event.pageX,drop.event.pageY],tolerance=drop.tolerance||drop.modes[drop.mode];do{if(ia=dd.interactions[x]){if(!ia)return;ia.drop=[],arr=[],len=ia.droppable.length,tolerance&&(drg=drop.locate(ia.proxy)),i=0;do{if(elem=ia.droppable[i]){if(!(drp=(data=$.data(elem,drop.datakey)).location))continue;data.winner=tolerance?tolerance.call(drop,drop.event,drg,drp):drop.contains(drp,xy)?1:0,arr.push(data)}}while(++i<len);for(arr.sort(drop.sort),i=0;(data=arr[i])&&(data.winner&&ia.drop.length<drop.multi?(data.active[x]||data.anyactive||(!1!==$special.drag.hijack(drop.event,"dropstart",dd,x,data.elem)[0]?(data.active[x]=1,data.anyactive+=1):data.winner=0),data.winner&&ia.drop.push(data.elem)):data.active[x]&&1==data.anyactive&&($special.drag.hijack(drop.event,"dropend",dd,x,data.elem),data.active[x]=0,data.anyactive-=1)),++i<len;);}}while(++x<end);drop.last&&xy[0]==drop.last.pageX&&xy[1]==drop.last.pageY?delete drop.timer:drop.timer=setTimeout(function(){drop.tolerate(dd)},drop.delay),drop.last=drop.event}};$special.dropinit=$special.dropstart=$special.dropend=drop}(jQuery),function($){var $event=$.event,drop=$event.special.drop,origadd=drop.add,origteardown=drop.teardown;drop.noBubble=!1,drop.livekey="livedrop",drop.add=function(obj){origadd.apply(this,arguments);var data=$.data(this,drop.datakey);!data.live&&obj.selector&&(data.live=!0,$event.add(this,"dropinit."+drop.livekey,drop.delegate))},drop.teardown=function(){origteardown.apply(this,arguments);var data=$.data(this,drop.datakey)||{};data.live&&($event.remove(this,"dropinit",drop.delegate),data.live=!1)},drop.delegate=function(event,dd){var $targets,elems=[],events=$.data(this,"events")||{};return $.each(events||[],function(key,arr){0===key.indexOf("drop")&&$.each(arr,function(i,obj){($targets=$(event.currentTarget).find(obj.selector)).length&&$targets.each(function(){$event.add(this,obj.origType+"."+drop.livekey,obj.origHandler||obj.handler,obj.data),$.inArray(this,elems)<0&&elems.push(this)})})}),dd&&$event.add(dd.drag,"dragend."+drop.livekey,function(){$.each(elems.concat(this),function(){$event.remove(this,"."+drop.livekey)})}),!!elems.length&&$(elems)}}(jQuery);var constants_componentData="component-data",strings={};function guid(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}var Callback=function(){function Callback(){_classCallCheck(this,Callback),this.funcs=new Array}return _createClass(Callback,[{key:"add",value:function(func){this.funcs.push(func)}},{key:"remove",value:function(func){this.funcs=this.funcs.filter(function(o){return o!=func})}},{key:"fire",value:function(args){this.funcs.forEach(function(o){return o(args)})}}],[{key:"create",value:function(){return new Callback}}]),Callback}();!function(jueying){var ComponentEditor=function(_React$Component){function ComponentEditor(props){_classCallCheck(this,ComponentEditor);var _this=_possibleConstructorReturn(this,(ComponentEditor.__proto__||Object.getPrototypeOf(ComponentEditor)).call(this,props));return _this._element=null,_this.state={editors:[]},_this}return _inherits(ComponentEditor,React.Component),_createClass(ComponentEditor,[{key:"componentWillReceiveProps",value:function(props){this.setState({designer:props.designer})}},{key:"getEditors",value:function(designer){if(null==designer)return[];for(var commonPropEditorInfos=[],componentDatas=designer.selectedComponents,_loop=function(i){var className=componentDatas[i].type,propEditorInfos=jueying.Component.getPropEditors(className);if(0==i)commonPropEditorInfos=propEditorInfos||[];else{var items=[];commonPropEditorInfos.forEach(function(propInfo1){propEditorInfos.forEach(function(propInfo2){var propName1=propInfo1.propNames.join("."),propName2=propInfo2.propNames.join(".");propInfo1.editorType==propInfo2.editorType&&propName1==propName2&&items.push(propInfo1)})}),commonPropEditorInfos=items}},i=0;i<componentDatas.length;i++)_loop(i);var commonFlatProps=void 0;for(i=0;i<componentDatas.length;i++){var control=componentDatas[i],controlProps=Object.assign({},control.props);if(delete controlProps.children,controlProps=this.flatProps(controlProps),0==i)commonFlatProps=controlProps;else{var obj={};for(var key in commonFlatProps)commonFlatProps[key]==controlProps[key]&&(obj[key]=controlProps[key]);commonFlatProps=obj}}for(var editors=[],_loop2=function(_i){var propEditorInfo=commonPropEditorInfos[_i],propName=propEditorInfo.propNames[propEditorInfo.propNames.length-1],editorType=propEditorInfo.editorType,propNames=propEditorInfo.propNames,editor=React.createElement(editorType,{value:commonFlatProps[propNames.join(".")],onChange:function(value){for(var _i2=0;_i2<componentDatas.length;_i2++){var c=componentDatas[_i2];console.assert(c.props.id),designer.updateControlProps(c.props.id,propNames,value)}}});editors.push({prop:propName,editor:editor,group:propEditorInfo.group})},_i=0;_i<commonPropEditorInfos.length;_i++)_loop2(_i);return editors}},{key:"flatProps",value:function(props,baseName){baseName=baseName?baseName+".":"";var obj={};for(var key in props)"object"!=_typeof(props[key])?obj[baseName+key]=props[key]:Object.assign(obj,this.flatProps(props[key],key));return obj}},{key:"render",value:function(){var designer=this.state.designer,editors=this.getEditors(designer);if(0==editors.length)return React.createElement("div",{className:"text-center"},"暂无可用的属性");for(var groupEditorsArray=[],_loop3=function(i){var group=editors[i].group||"",groupEditors=groupEditorsArray.filter(function(o){return o.group==group})[0];null==groupEditors&&(groupEditors={group:editors[i].group,editors:[]},groupEditorsArray.push(groupEditors)),groupEditors.editors.push({prop:editors[i].prop,editor:editors[i].editor})},i=0;i<editors.length;i++)_loop3(i);return React.createElement(React.Fragment,null,groupEditorsArray.map(function(g){return React.createElement("div",{key:g.group,className:"panel panel-default"},g.group?React.createElement("div",{className:"panel-heading"},strings[g.group]||g.group):null,React.createElement("div",{className:"panel-body"},g.editors.map(function(o,i){return React.createElement("div",{key:o.prop,className:"form-group"},React.createElement("label",{key:guid()},strings[o.prop]||o.prop)," ",React.createElement("div",{className:"control"},o.editor))})))}))}},{key:"element",get:function(){return this._element}}]),ComponentEditor}();jueying.ComponentEditor=ComponentEditor}(jueying||(jueying={})),function(jueying){var ComponentPanel=function(_React$Component2){function ComponentPanel(props){_classCallCheck(this,ComponentPanel);var _this2=_possibleConstructorReturn(this,(ComponentPanel.__proto__||Object.getPrototypeOf(ComponentPanel)).call(this,props));return _this2.state={componets:[]},_this2}return _inherits(ComponentPanel,React.Component),_createClass(ComponentPanel,[{key:"componentDraggable",value:function(toolItemElement,componentData){console.assert(null!=toolItemElement),toolItemElement.draggable=!0,toolItemElement.addEventListener("dragstart",function(ev){componentData.props=componentData.props||{},ev.dataTransfer.setData(constants_componentData,JSON.stringify(componentData)),ev.dataTransfer.setData("mousePosition",JSON.stringify({x:ev.offsetX,y:ev.offsetY}))})}},{key:"setComponets",value:function(componets){this.setState({componets:componets})}},{key:"render",value:function(){var _this3=this,props=Object.assign({},this.props),componets=this.state.componets||[];return React.createElement(jueying.DesignerContext.Consumer,null,function(context){return _this3.designer=context.designer,React.createElement("ul",Object.assign({},props,{className:""+jueying.classNames.componentPanel,ref:function(e){return _this3.toolbarElement=_this3.toolbarElement||e}}),componets.map(function(c,i){var props={key:i};return React.createElement("li",Object.assign({},props),React.createElement("div",{className:"btn-link"},React.createElement("i",{className:c.icon,style:{fontSize:44,color:"black"},ref:function(e){if(e){var ctrl=c.componentData;_this3.componentDraggable(e,ctrl)}}})),React.createElement("div",null,c.displayName))}))})}}],[{key:"getComponentData",value:function(dataTransfer){var str=dataTransfer.getData(constants_componentData);if(str)return JSON.parse(str)}},{key:"mouseInnerPosition",value:function(dataTransfer){var str=dataTransfer.getData("mousePosition");if(str)return JSON.parse(str)}}]),ComponentPanel}();jueying.ComponentPanel=ComponentPanel}(jueying||(jueying={})),function(jueying){var ComponentWrapper=function(_React$Component3){function ComponentWrapper(){return _classCallCheck(this,ComponentWrapper),_possibleConstructorReturn(this,(ComponentWrapper.__proto__||Object.getPrototypeOf(ComponentWrapper)).apply(this,arguments))}return _inherits(ComponentWrapper,React.Component),_createClass(ComponentWrapper,[{key:"designtimeBehavior",value:function(element,attr){if(!element)throw Errors.argumentNull("element");if(!attr)throw Errors.argumentNull("args");if(!element.getAttribute("data-behavior")){element.setAttribute("data-behavior","behavior");var designer=this.props.designer;console.assert(null!=attr.container),console.assert(null!=attr.movable),attr.container&&ComponentWrapper.enableDroppable(element,designer),attr.movable?(console.assert(null!=element),ComponentWrapper.draggable(designer,element),null!=this.handler&&ComponentWrapper.draggable(designer,element,this.handler)):element.onclick=function(ev){return ComponentWrapper.invokeOnClick(ev,designer,element)}}}},{key:"componentDidMount",value:function(){if(this.element){var attr=this.props.source.attr;this.designtimeBehavior(this.element,attr)}}},{key:"render",value:function(){var _this5=this;console.assert(!Array.isArray(this.props.children));var attr=this.props.source.attr;if(!(attr.resize||"string"!=typeof this.props.source.type&&this.props.source.type!=jueying.ContainerHost))return this.renderWidthoutWrapper();var props=this.props.source.props,style=props.style=props.style||{},top=style.top,left=style.left,position=style.position,width=style.width,height=style.height,display=style.display,visibility=style.visibility,className=jueying.appendClassName(props.className||"",jueying.classNames.componentWrapper);className=props.selected?jueying.appendClassName(className,jueying.classNames.componentSelected):className;var wrapperProps={id:props.id,className:className,style:{top:top,left:left,position:position,width:width,height:height,display:display,visibility:visibility},ref:function(e){return _this5.element=e||_this5.element}},move_handle=props.selected&&attr.showHandler?React.createElement("div",{className:"move_handle",style:{},ref:function(e){return _this5.handler=e||_this5.handler}}):null,showResizeHandle=attr.resize&&"absolute"==props.style.position&&props.selected,source=this.props.source;return props.style&&(delete props.style.left,delete props.style.top,delete props.style.position,props.style.width="100%",props.style.height="100%"),React.createElement(jueying.ComponentWrapperContext.Provider,{value:this},React.createElement("div",Object.assign({},wrapperProps),move_handle,showResizeHandle?React.createElement(React.Fragment,null,React.createElement("div",{className:"resize_handle NE"}),React.createElement("div",{className:"resize_handle NN"}),React.createElement("div",{className:"resize_handle NW"}),React.createElement("div",{className:"resize_handle WW"}),React.createElement("div",{className:"resize_handle EE"}),React.createElement("div",{className:"resize_handle SW"}),React.createElement("div",{className:"resize_handle SS"}),React.createElement("div",{className:"resize_handle SE"})):null,this.createRawElement(source.type,source.props,source.children)))}},{key:"renderWidthoutWrapper",value:function(){var _this6=this,_props$source=this.props.source,type=_props$source.type,props=_props$source.props,children=_props$source.children;props.ref=function(e){if(e)if(e.tagName){var attr=_this6.props.source.attr;_this6.designtimeBehavior(e,attr)}else;},props.selected&&(props.className=jueying.appendClassName(props.className||"",jueying.classNames.componentSelected));var element=this.createRawElement(type,props,children);return React.createElement(jueying.ComponentWrapperContext.Provider,{value:this},element)}},{key:"createRawElement",value:function(type,props,children){var _React;0==(children||[]).length&&(children=[this.props.designer.designTimeEmptyElement(type,props)]);return(_React=React).createElement.apply(_React,[type,props].concat(_toConsumableArray(children)))}}],[{key:"enableDroppable",value:function(element,designer){console.assert(null!=element),element.addEventListener("dragover",function(event){event.preventDefault(),event.stopPropagation();var componentName=event.dataTransfer.getData(constants_componentData);event.dataTransfer.dropEffect=componentName?"copy":"move",console.log("dragover: left:"+event.layerX+" top:"+event.layerX)}),element.ondrop=function(event){event.preventDefault(),event.stopPropagation();var ctrl=jueying.ComponentPanel.getComponentData(event.dataTransfer);if(ctrl){ctrl.props.style=ctrl.props.style||{},designer.pageData.props.style=designer.pageData.props.style||{},ctrl.props.style.position||(ctrl.props.style.position=designer.pageData.props.style.position);var pos=jueying.ComponentPanel.mouseInnerPosition(event.dataTransfer);console.assert(null!=pos),"absolute"==ctrl.props.style.position&&(ctrl.props.style.left=event.layerX-pos.x,ctrl.props.style.top=event.layerY-pos.y),designer.appendComponent(element.id,ctrl)}}}},{key:"isResizeHandleClassName",value:function(className){return 0<=["resize_handle NE","resize_handle NN","resize_handle NW","resize_handle WW","resize_handle EE","resize_handle SW","resize_handle SS","resize_handle SE"].indexOf(className)}},{key:"draggable",value:function(designer,element,handler){if(!designer)throw Errors.argumentNull("designer");if(!element)throw Errors.argumentNull("element");console.assert(element.id),handler=handler||element;var componentId=element.id;console.assert(componentId);var startPos=void 0,rect=void 0,dragStart=void 0;$(handler).drag("init",function(ev){if(startPos=$(element).position(),$(this).is("."+jueying.classNames.componentSelected))return $("."+jueying.classNames.componentSelected)}).drag("start",function(ev,dd){dd.attr=$(ev.target).prop("className"),dd.width=$(this).width(),dd.height=$(this).height(),dd.sourceElement=element,dragStart=Date.now()}).drag(function(ev,dd){ev.preventDefault(),ev.stopPropagation(),rect={},-1<dd.attr.indexOf("E")&&(rect.width=Math.max(32,dd.width+dd.deltaX)),-1<dd.attr.indexOf("S")&&(rect.height=Math.max(32,dd.height+dd.deltaY)),-1<dd.attr.indexOf("W")&&(rect.width=Math.max(32,dd.width-dd.deltaX),setLeft(dd)),-1<dd.attr.indexOf("N")&&(rect.height=Math.max(32,dd.height-dd.deltaY),setTop(dd)),0<=dd.attr.indexOf("WW")&&setLeft(dd),(0<=dd.attr.indexOf("NE")||0<=dd.attr.indexOf("NW")||0<=dd.attr.indexOf("SW"))&&setPosition(dd),0<=dd.attr.indexOf("NN")&&setTop(dd),-1<dd.attr.indexOf("drag")&&(rect.top=dd.offsetY,rect.left=dd.offsetX),ComponentWrapper.isResizeHandleClassName(dd.attr)||setPosition(dd),dd.attr&&$(this).css(rect)},{click:!0}).drag("end",function(ev,dd){var interval=Date.now()-dragStart;if(ComponentWrapper.isDrag=300<=interval,ComponentWrapper.isResizeHandleClassName(dd.attr)){var _left=void 0,_top=void 0;-1<dd.attr.indexOf("W")&&(_left=startPos.left+dd.deltaX),-1<dd.attr.indexOf("N")&&(_top=startPos.top+dd.deltaY),element.style.transform="",designer.setComponentPosition(element.id,{left:_left,top:_top}),designer.setComponentSize(componentId,rect)}else{var left=startPos.left+dd.deltaX,top=startPos.top+dd.deltaY;designer.setComponentPosition(element.id,{left:left,top:top}),element.style.transform=""}}).click(function(ev){ComponentWrapper.invokeOnClick(ev,designer,element)});var setPosition=function(dd){console.log(["dd.offsetX, dd.offsetY",dd.offsetX,dd.offsetY]),console.log(dd),element.style.transform="translate("+dd.deltaX+"px,"+dd.deltaY+"px)"},setTop=function(dd){element.style.transform="translateY("+dd.deltaY+"px)"},setLeft=function(dd){element.style.transform="translateX("+dd.deltaX+"px)"}}},{key:"invokeOnClick",value:function(ev,designer,element){if(ev.preventDefault(),ev.stopPropagation(),ComponentWrapper.isDrag)ComponentWrapper.isDrag=!1;else{var elementID=element.id;if(ev.ctrlKey){var selectedControlIds=designer.selectedComponentIds;console.assert(elementID),0<=selectedControlIds.indexOf(elementID)?selectedControlIds=selectedControlIds.filter(function(o){return o!=elementID}):selectedControlIds.push(elementID),designer.selectComponent(selectedControlIds)}else designer.selectComponent(element.id)}}}]),ComponentWrapper}();ComponentWrapper.isDrag=!1,jueying.ComponentWrapper=ComponentWrapper}(jueying||(jueying={})),function(jueying){jueying.DesignerContext=React.createContext({designer:null}),jueying.ComponentWrapperContext=React.createContext(null),jueying.component=function(args){return function(constructor){return jueying.PageDesigner&&Component.setAttribute(constructor.name,args),Component.register(constructor.name,constructor),constructor}};var Component=function(){function Component(){_classCallCheck(this,Component)}return _createClass(Component,null,[{key:"setAttribute",value:function(typename,attr){Component.componentAttributes[typename]=attr}},{key:"getAttribute",value:function(type){var typename="string"==typeof type?type:type.name,attr=Component.componentAttributes[typename];return Object.assign({type:type},Component.defaultComponentAttribute,attr||{})}},{key:"getPropEditors",value:function(controlClassName){return this.controlPropEditors[controlClassName]||[]}},{key:"getPropEditor",value:function(controlClassName){for(var _len=arguments.length,propNames=Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)propNames[_key-1]=arguments[_key];return this.getPropEditorByArray(controlClassName,propNames)}},{key:"getPropEditorByArray",value:function(controlClassName,propNames){return(this.controlPropEditors[controlClassName]||[]).filter(function(o){return o.propNames.join(".")==propNames.join(".")})[0]}},{key:"setPropEditor",value:function(componentType,propName,editorType,group){group=group||"";for(var propNames=propName.split("."),className="string"==typeof componentType?componentType:componentType.prototype.typename||componentType.name,classProps=Component.controlPropEditors[className]=Component.controlPropEditors[className]||[],i=0;i<classProps.length;i++){if(classProps[i].propNames.join(".")==propNames.join("."))return void(classProps[i].editorType=editorType)}classProps.push({propNames:propNames,editorType:editorType,group:group})}},{key:"createElement",value:function(args,h){h=h||React.createElement;try{var type=args.type,componentName=args.type,controlType=Component.componentTypes[componentName];controlType&&(type=controlType);var children=args.children?args.children.map(function(o){return Component.createElement(o,h)}):[],props=null==args.props?{}:JSON.parse(JSON.stringify(args.props));return"string"==typeof type&&(props.text&&children.push(props.text),delete props.text),type=type==Component.Fragment?React.Fragment:type,h.apply(void 0,[type,props].concat(_toConsumableArray(children)))}catch(e){return console.error(e),null}}},{key:"register",value:function(componentName,componentType,attr){if(null==componentType&&"function"==typeof componentName&&(componentName=(componentType=componentName).name,componentType.componentName=componentName),!componentName)throw Errors.argumentNull("componentName");if(!componentType)throw Errors.argumentNull("componentType");Component.componentTypes[componentName]=componentType,attr&&Component.setAttribute(componentName,attr)}}]),Component}();Component.Fragment="",Component.defaultComponentAttribute={container:!1,movable:!1,showHandler:!1,resize:!1},Component.componentAttributes={div:{container:!0,movable:!0,showHandler:!0,resize:!0},img:{container:!1,movable:!0,resize:!0},label:{movable:!0},ul:{container:!1,movable:!0,showHandler:!0,resize:!1},li:{container:!0,movable:!1},table:{container:!1,movable:!0,showHandler:!0,resize:!0},thead:{container:!1,movable:!1},tbody:{container:!1,movable:!1},tfoot:{container:!1,movable:!1},tr:{container:!1,movable:!1},td:{container:!0,movable:!1}},Component.controlPropEditors={},Component.componentTypes={},jueying.Component=Component;var FormContext=React.createContext({form:null}),ContainerHost=function(_React$Component4){function ContainerHost(props){_classCallCheck(this,ContainerHost);var _this7=_possibleConstructorReturn(this,(ContainerHost.__proto__||Object.getPrototypeOf(ContainerHost)).call(this,props)),children=_this7.children(props);return _this7.state={children:children},_this7}return _inherits(ContainerHost,React.Component),_createClass(ContainerHost,[{key:"children",value:function(props){var arr=null==props.children?[]:Array.isArray(props.children)?props.children:[props.children],children=[];return arr.forEach(function(o){React.isValidElement(o)&&children.push(o)}),children}},{key:"componentWillReceiveProps",value:function(props){var children=this.children(props);this.setState({children:children})}},{key:"render",value:function(){var props={};for(var key in this.props)"ref"!=key&&"id"!=key&&(props[key]=this.props[key]);props.style=Object.assign({minHeight:40},props.style);var children=this.state.children.filter(function(o){return null==o.props.parent_id});return React.createElement(FormContext.Provider,{value:{form:this}},children)}}]),ContainerHost}();jueying.ContainerHost=ContainerHost;var ComponentContainer=function(_React$Component5){function ComponentContainer(){return _classCallCheck(this,ComponentContainer),_possibleConstructorReturn(this,(ComponentContainer.__proto__||Object.getPrototypeOf(ComponentContainer)).apply(this,arguments))}return _inherits(ComponentContainer,React.Component),_createClass(ComponentContainer,[{key:"enableAppendDroppable",value:function(element){var _this9=this;if(!element.getAttribute("enable-append-droppable")){element.setAttribute("enable-append-droppable","true"),console.assert(null!=element),element.addEventListener("dragover",function(event){event.preventDefault(),event.stopPropagation(),element.className=jueying.appendClassName(element.className||"","active");var componentName=event.dataTransfer.getData(constants_componentData);event.dataTransfer.dropEffect=componentName?"copy":"move",console.log("dragover: left:"+event.layerX+" top:"+event.layerX)});var func=function(event){event.preventDefault(),event.stopPropagation(),element.className=jueying.removeClassName(element.className,"active")};element.addEventListener("dragleave",func),element.addEventListener("dragend",func),element.addEventListener("dragexit",func),element.ondrop=function(event){event.preventDefault(),event.stopPropagation(),element.className=jueying.removeClassName(element.className,"active");var ctrl=jueying.ComponentPanel.getComponentData(event.dataTransfer);ctrl&&(console.assert(_this9.props.id),console.assert(_this9.designer),ctrl.props.parent_id=_this9.props.id,console.assert(null!=_this9.host,"host is null"),_this9.designer.appendComponent(_this9.host.props.id,ctrl))}}}},{key:"enableMoveDroppable",value:function(element){var _this10=this;element.getAttribute("enable-move-droppable")||(element.setAttribute("enable-move-droppable","true"),$(element).drop("start",function(event,dd){dd.sourceElement.id!=_this10.wraper.props.source.props.id&&jueying.appendClassName(element,"active")}).drop("drop",function(event,dd){if(dd.sourceElement.id!=_this10.wraper.props.source.props.id){var componentData=_this10.designer.findComponentData(dd.sourceElement.id);console.assert(null!=componentData);_this10.designer.moveControl(dd.sourceElement.id,_this10.host.props.id),_this10.designer.updateControlProps(dd.sourceElement.id,["parent_id"],_this10.props.id)}}).drop("end",function(event,dd){dd.sourceElement.id!=_this10.wraper.props.source.props.id&&jueying.removeClassName(element,"active")}))}},{key:"render",value:function(){var _this11=this;return React.createElement(FormContext.Consumer,null,function(args){var host=_this11.host=args.form;if(null==host)throw Errors.canntFindHost(_this11.props.id);var children=[];if(host.props&&host.props.children){var arr=void 0;arr=Array.isArray(host.props.children)?host.props.children:[host.props.children],children=arr.filter(function(o){return o.props.parent_id==_this11.props.id})}return React.createElement(jueying.DesignerContext.Consumer,null,function(args){return React.createElement(jueying.ComponentWrapperContext.Consumer,null,function(wraper){_this11.wraper=wraper,console.assert(null!=_this11.wraper);var element=React.createElement(React.Fragment,null,_this11.props.children,children);return args.designer&&(_this11.designer=args.designer,element=React.createElement("div",{className:jueying.classNames.formItem,ref:function(e){e&&(_this11.enableAppendDroppable(e),_this11.enableMoveDroppable(e))}},element)),element})})})}}]),ComponentContainer}();jueying.ComponentContainer=ComponentContainer,jueying.ContainerHostName="ContainerHost",Component.register(jueying.ContainerHostName,ContainerHost,{container:!1})}(jueying||(jueying={})),function(jueying){var EditorPanel=function(_React$Component6){function EditorPanel(props){_classCallCheck(this,EditorPanel);var _this12=_possibleConstructorReturn(this,(EditorPanel.__proto__||Object.getPrototypeOf(EditorPanel)).call(this,props));return _this12.state={componentDatas:[]},_this12.designerComponentChanged=function(){console.assert(null!=_this12.designer),_this12.setState({designer:_this12.designer})},_this12}return _inherits(EditorPanel,React.Component),_createClass(EditorPanel,[{key:"componentWillReceiveProps",value:function(props){this.setState({designer:props.designer})}},{key:"getComponentData",value:function(designer){var componentDatas=[],stack=new Array;for(stack.push(designer.pageData);0<stack.length;){var item=stack.pop();componentDatas.push(item);for(var children=item.children||[],i=0;i<children.length;i++)stack.push(children[i])}return componentDatas}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var _this13=this,emptyText=this.props.emptyText;emptyText=emptyText||"";var componentDatas=[],selectedComponentIds=[],designer=this.state.designer;return designer&&(componentDatas=this.getComponentData(designer),selectedComponentIds=designer.selectedComponentIds||[]),React.createElement("div",{className:jueying.classNames.editorPanel,ref:function(e){return _this13.element=e||_this13.element}},React.createElement("select",{className:"form-control",ref:function(e){e&&(e.value=1==selectedComponentIds.length?selectedComponentIds[0]:"",e.onchange=function(){designer&&e.value&&designer.selectComponent(e.value)})}},componentDatas.map(function(o){return React.createElement("option",{key:o.props.id,id:o.props.id,value:o.props.id},o.props.name)})),React.createElement(jueying.ComponentEditor,{designer:designer,ref:function(e){return _this13.editor=e||_this13.editor}}))}},{key:"designer",get:function(){return this._designer},set:function(value){this._designer&&(this._designer.componentRemoved.remove(this.designerComponentChanged),this._designer.componentAppend.remove(this.designerComponentChanged),this._designer.componentUpdated.remove(this.designerComponentChanged),this._designer.componentSelected.remove(this.designerComponentChanged)),value&&(value.componentRemoved.add(this.designerComponentChanged),value.componentAppend.add(this.designerComponentChanged),value.componentUpdated.add(this.designerComponentChanged),value.componentSelected.add(this.designerComponentChanged)),this._designer=value}}]),EditorPanel}();jueying.EditorPanel=EditorPanel}(jueying||(jueying={}));var jueying,Errors=function(){function Errors(){_classCallCheck(this,Errors)}return _createClass(Errors,null,[{key:"fileNotExists",value:function(fileName){return new Error("File '"+fileName+"' is not exists.")}},{key:"argumentNull",value:function(argumentName){return new Error("Argument "+argumentName+" is null or empty.")}},{key:"pageDataIsNull",value:function(){return new Error("Page data is null.")}},{key:"toolbarRequiredKey",value:function(){return new Error("Toolbar has not a key prop.")}},{key:"loadPluginFail",value:function(pluginId){return new Error("Load plugin '"+pluginId+"' fail.")}},{key:"idRequired",value:function(){return new Error("Property id is required.")}},{key:"canntFindHost",value:function(componentId){return new Error("Can not find host element for component container "+componentId+".")}}]),Errors}();return function(jueying){var PageDesigner=function(_React$Component7){function PageDesigner(props){_classCallCheck(this,PageDesigner);var _this14=_possibleConstructorReturn(this,(PageDesigner.__proto__||Object.getPrototypeOf(PageDesigner)).call(this,props));return _this14.componentSelected=Callback.create(),_this14.componentRemoved=Callback.create(),_this14.componentAppend=Callback.create(),_this14.componentUpdated=Callback.create(),_this14.designtimeComponentDidMount=Callback.create(),_this14.namedComponents={},_this14.initPageData(props.pageData),_this14.state={pageData:props.pageData},_this14.designtimeComponentDidMount.add(function(args){console.log("this:designer event:controlComponentDidMount")}),_this14}return _inherits(PageDesigner,React.Component),_createClass(PageDesigner,[{key:"initPageData",value:function(pageData){if(null!=pageData){pageData.children=pageData.children||[];var hostCtrl=pageData.children.filter(function(o){return o.type==jueying.ContainerHostName})[0];null==hostCtrl&&(hostCtrl={type:jueying.ContainerHostName,props:{id:guid()}},pageData.children.push(hostCtrl)),this.nameComponent(pageData)}}},{key:"updateControlProps",value:function(controlId,navPropsNames,value){var componentData=this.findComponentData(controlId);if(null!=componentData){console.assert(null!=componentData),console.assert(null!=navPropsNames,"props is null"),componentData.props=componentData.props||{};for(var obj=componentData.props,i=0;i<navPropsNames.length-1;i++)obj=obj[navPropsNames[i]]=obj[navPropsNames[i]]||{};obj[navPropsNames[navPropsNames.length-1]]=value,this.setState(this.state),this.componentUpdated.fire([componentData])}}},{key:"sortChildren",value:function(parentId,childIds){if(!parentId)throw Errors.argumentNull("parentId");if(!childIds)throw Errors.argumentNull("childIds");var pageData=this.state.pageData,parentControl=this.findComponentData(parentId);if(null==parentControl)throw new Error("Parent is not exists");console.assert(null!=parentControl),console.assert(null!=parentControl.children),console.assert((parentControl.children||[]).length==childIds.length);var p=parentControl;parentControl.children=childIds.map(function(o){var child=p.children.filter(function(a){return a.props.id==o})[0];return console.assert(null!=child,"child "+o+" is null"),child}),this.setState({pageData:pageData})}},{key:"nameComponent",value:function(component){var props=component.props=component.props||{};if(!props.name){for(var num=0,name=void 0;num+=1,name=""+component.type+num,this.namedComponents[name];);this.namedComponents[name]=component,props.name=name}if(props.id||(props.id=guid()),component.children&&0!=component.children.length)for(var i=0;i<component.children.length;i++)this.nameComponent(component.children[i])}},{key:"appendComponent",value:function(parentId,childControl,childIds){if(!parentId)throw Errors.argumentNull("parentId");if(!childControl)throw Errors.argumentNull("childControl");this.nameComponent(childControl);var parentControl=this.findComponentData(parentId);if(null==parentControl)throw new Error("Parent is not exists");if(console.assert(null!=parentControl),parentControl.children=parentControl.children||[],parentControl.children.push(childControl),childIds)this.sortChildren(parentId,childIds);else{var pageData=this.state.pageData;this.setState({pageData:pageData})}this.selectComponent(childControl.props.id),this.componentAppend.fire(this)}},{key:"setComponentPosition",value:function(componentId,position){return this.setComponentsPosition([{componentId:componentId,position:position}])}},{key:"setComponentSize",value:function(componentId,size){console.assert(componentId),console.assert(size);var componentData=this.findComponentData(componentId);if(!componentData)throw new Error("Control "+componentId+" is not exits.");var style=componentData.props.style=componentData.props.style||{};size.height&&(style.height=size.height),size.width&&(style.width=size.width);var pageData=this.state.pageData;this.setState({pageData:pageData}),this.componentUpdated.fire([componentData])}},{key:"setComponentsPosition",value:function(positions){var _this15=this,componentDatas=new Array;positions.forEach(function(o){var componentId=o.componentId,_o$position=o.position,left=_o$position.left,top=_o$position.top,componentData=_this15.findComponentData(componentId);if(!componentData)throw new Error("Control "+componentId+" is not exits.");var style=componentData.props.style=componentData.props.style||{};left&&(style.left=left),top&&(style.top=top);var pageData=_this15.state.pageData;_this15.setState({pageData:pageData}),componentDatas.push(componentData)}),this.componentUpdated.fire(componentDatas)}},{key:"selectComponent",value:function(componentIds){"string"==typeof componentIds&&(componentIds=[componentIds]);var stack=[];for(stack.push(this.pageData);0<stack.length;){var item=stack.pop(),isSelectedControl=0<=componentIds.indexOf(item.props.id);item.props.selected=isSelectedControl;for(var children=item.children||[],i=0;i<children.length;i++)stack.push(children[i])}this.setState({pageData:this.pageData}),this.componentSelected.fire(this.selectedComponentIds),this.element.focus()}},{key:"removeControl",value:function(){var _this16=this,pageData=this.state.pageData;if(pageData&&pageData.children&&0!=pageData.children.length){for(var _len2=arguments.length,controlIds=Array(_len2),_key2=0;_key2<_len2;_key2++)controlIds[_key2]=arguments[_key2];controlIds.forEach(function(controlId){_this16.removeControlFrom(controlId,pageData.children)}),this.setState({pageData:pageData}),this.componentRemoved.fire(controlIds)}}},{key:"moveControl",value:function(componentId,parentId,childIds){var control=this.findComponentData(componentId);if(null==control)throw new Error("Cannt find control by id "+componentId);console.assert(null!=control,"Cannt find control by id "+componentId);var pageData=this.state.pageData;console.assert(pageData.children),this.removeControlFrom(componentId,pageData.children),this.appendComponent(parentId,control,childIds)}},{key:"removeControlFrom",value:function(controlId,collection){for(var controlIndex=null,i=0;i<collection.length;i++)if(controlId==collection[i].props.id){controlIndex=i;break}if(null!=controlIndex)return 0==controlIndex?collection.shift():controlIndex==collection.length-1?collection.pop():collection.splice(controlIndex,1),!0;for(var _i3=0;_i3<collection.length;_i3++){var o=collection[_i3];if(o.children&&0<o.children.length)if(this.removeControlFrom(controlId,o.children))return!0}return!1}},{key:"findComponentData",value:function(controlId){var pageData=this.state.pageData;if(!pageData)throw Errors.pageDataIsNull();var stack=new Array;for(stack.push(pageData);0<stack.length;){var item=stack.pop();if(null!=item){if(item.props.id==controlId)return item;var children=(item.children||[]).filter(function(o){return"object"==(void 0===o?"undefined":_typeof(o))});stack.push.apply(stack,_toConsumableArray(children))}}return null}},{key:"onKeyDown",value:function(e){if(46==e.keyCode){if(0==this.selectedComponents.length)return;this.removeControl.apply(this,_toConsumableArray(this.selectedComponentIds))}}},{key:"designTimeEmptyElement",value:function(type,props){var typename="string"==typeof type?type:type.name;return this.designTimeText(typename,props)}},{key:"designTimeText",value:function(type,props){var text=props.text;return text||(text=text||props.name||type)}},{key:"createDesignTimeElement",value:function(type,props){for(var _len3=arguments.length,children=Array(2<_len3?_len3-2:0),_key3=2;_key3<_len3;_key3++)children[_key3-2]=arguments[_key3];console.assert(props.id),null!=props.id&&(props.key=props.id),"a"==type&&props.href?props.href="javascript:":"input"!=type&&"button"!=type||(delete props.onClick,props.readOnly=!0);var attr1=jueying.Component.getAttribute(type);console.assert(null!=attr1);var attr2=props.attr||{},attr=Object.assign({},attr1,attr2);delete props.attr;var className=props.selected?jueying.appendClassName(props.className||"",jueying.classNames.componentSelected):props.className;return React.createElement(jueying.ComponentWrapper,Object.assign({},Object.assign({},props,{className:className}),{designer:this,source:{type:type,attr:attr,props:props,children:children}}))}},{key:"componentWillReceiveProps",value:function(props){this.initPageData(props.pageData),this.setState({pageData:props.pageData})}},{key:"render",value:function(){var _this17=this,pageData=this.state.pageData,style=this.props.style;return React.createElement("div",{className:"designer",tabIndex:1,style:style,ref:function(e){return _this17.element=e||_this17.element},onKeyDown:function(e){return _this17.onKeyDown(e)}},React.createElement(jueying.DesignerContext.Provider,{value:{designer:this}},(_this17._root=pageData?jueying.Component.createElement(pageData,_this17.createDesignTimeElement.bind(_this17)):null,_this17._root)))}},{key:"root",get:function(){return this._root}},{key:"pageData",get:function(){return this.state.pageData}},{key:"selectedComponentIds",get:function(){return this.selectedComponents.map(function(o){return o.props.id})}},{key:"selectedComponents",get:function(){var arr=new Array,stack=new Array;for(stack.push(this.pageData);0<stack.length;){var item=stack.pop();1==item.props.selected&&arr.push(item);for(var children=item.children||[],i=0;i<children.length;i++)stack.push(children[i])}return arr}}]),PageDesigner}();jueying.PageDesigner=PageDesigner}(jueying||(jueying={})),function(jueying){var PropEditor=function(_React$Component8){function PropEditor(props){_classCallCheck(this,PropEditor);var _this18=_possibleConstructorReturn(this,(PropEditor.__proto__||Object.getPrototypeOf(PropEditor)).call(this,props));return _this18.state={value:props.value},_this18}return _inherits(PropEditor,React.Component),_createClass(PropEditor,[{key:"componentWillReceiveProps",value:function(props){this.setState({value:props.value})}}]),PropEditor}(),TextInput=function(_PropEditor){function TextInput(){return _classCallCheck(this,TextInput),_possibleConstructorReturn(this,(TextInput.__proto__||Object.getPrototypeOf(TextInput)).apply(this,arguments))}return _inherits(TextInput,PropEditor),_createClass(TextInput,[{key:"render",value:function(){var _this20=this,value=this.state.value;return React.createElement("input",{className:"form-control",value:value||"",onChange:function(e){_this20.setState({value:e.target.value}),_this20.props.onChange(e.target.value)}})}}]),TextInput}();jueying.TextInput=TextInput,jueying.dropdown=function(items,emptyText){return function(_PropEditor2){function Dropdown(){return _classCallCheck(this,Dropdown),_possibleConstructorReturn(this,(Dropdown.__proto__||Object.getPrototypeOf(Dropdown)).apply(this,arguments))}return _inherits(Dropdown,PropEditor),_createClass(Dropdown,[{key:"render",value:function(){var _this22=this,value=this.state.value;if(Array.isArray(items)){var tmp=items;items={};for(var i=0;i<tmp.length;i++)items[tmp[i]]=tmp[i]}return React.createElement("select",{className:"form-control",value:value||"",onChange:function(e){value=e.target.value,_this22.setState({value:value}),_this22.props.onChange(value)}},emptyText?React.createElement("option",{value:""},emptyText):null,Object.getOwnPropertyNames(items).map(function(o){return React.createElement("option",{key:o,value:o},items[o])}))}}]),Dropdown}()}}(jueying||(jueying={})),function(jueying){jueying.classNames={componentSelected:"component-selected",emptyTemplates:"empty-templates",loadingTemplates:"loading-templates",templateSelected:"template-selected",templateDialog:"template-dialog",emptyDocument:"empty-document",component:"component",componentWrapper:"component-wrapper",componentPanel:"component-panel",form:"form",formItem:"form-item",editorPanel:"editor-panel"};var templateDialog_nameHeight=40,templateDialog_fontSize=22,element=document.createElement("style");element.type="text/css",element.innerHTML="\n            ."+jueying.classNames.componentSelected+" {\n                border: solid 1px #337ab7!important;\n            }\n            ."+jueying.classNames.componentSelected+" > :first-child {\n                border-color: blue;\n              }\n              ."+jueying.classNames.componentSelected+" .resize_handle {\n                position: absolute;\n                height: 6px;\n                width: 6px;\n                border: 1px solid #89B;\n                background: #9AC;\n              }\n              ."+jueying.classNames.componentSelected+" .move_handle {\n                height: 12px;\n                width: 12px;\n                top: 6px;\n                left: 8px;\n                border: solid 1px black;\n                position: relative;\n                margin-top: -12px;\n              }\n              ."+jueying.classNames.componentSelected+" .NW,\n              ."+jueying.classNames.componentSelected+" .NN,\n              ."+jueying.classNames.componentSelected+" .NE {\n                top: -4px;\n              }\n              ."+jueying.classNames.componentSelected+" .NE,\n              ."+jueying.classNames.componentSelected+" .EE,\n              ."+jueying.classNames.componentSelected+" .SE {\n                right: -4px;\n              }\n              ."+jueying.classNames.componentSelected+" .SW,\n              ."+jueying.classNames.componentSelected+".SS,\n              ."+jueying.classNames.componentSelected+" .SE {\n                bottom: -4px;\n              }\n              ."+jueying.classNames.componentSelected+" .NW,\n              ."+jueying.classNames.componentSelected+" .WW,\n              ."+jueying.classNames.componentSelected+" .SW {\n                left: -4px;\n              }\n              ."+jueying.classNames.componentSelected+" .SE,\n              ."+jueying.classNames.componentSelected+" .NW {\n                cursor: nw-resize;\n              }\n              ."+jueying.classNames.componentSelected+" .SW,\n              ."+jueying.classNames.componentSelected+" .NE {\n                cursor: ne-resize;\n              }\n              ."+jueying.classNames.componentSelected+" .NN,\n              ."+jueying.classNames.componentSelected+" .SS {\n                cursor: n-resize;\n                left: 50%;\n                margin-left: -4px;\n              }\n              ."+jueying.classNames.componentSelected+" .EE,\n              ."+jueying.classNames.componentSelected+" .WW {\n                cursor: e-resize;\n                top: 50%;\n                margin-top: -4px;\n              }\n            ."+jueying.classNames.emptyTemplates+" {\n                padding:50px 0;\n                text-align: center;\n            }\n            ."+jueying.classNames.loadingTemplates+" {\n                padding:50px 0;\n                text-align: center;\n            }\n            ."+jueying.classNames.templateSelected+" .page-view {\n                border: solid 1px #337ab7!important;\n            }\n            ."+jueying.classNames.templateDialog+" .name {\n                margin-top: -"+templateDialog_nameHeight+"px;\n                height: "+templateDialog_nameHeight+"px;\n                font-size: "+templateDialog_fontSize+"px;\n                text-align: center;\n                padding-top: 6px;\n                background-color: black;\n                opacity: 0.5;\n            }\n            ."+jueying.classNames.templateDialog+" .name span {\n                color: white;\n            }\n            ."+jueying.classNames.emptyDocument+" {\n                text-align: center;\n                padding: 100px 0;\n            }\n            ."+jueying.classNames.component+" > .NW,\n            ."+jueying.classNames.component+" > .NN,\n            ."+jueying.classNames.component+" > .NE,\n            ."+jueying.classNames.component+" > .EE,\n            ."+jueying.classNames.component+" > .SE,\n            ."+jueying.classNames.component+" > .SW,\n            ."+jueying.classNames.component+" > .SS,\n            ."+jueying.classNames.component+" > .WW {\n                display: none;\n            }\n            ."+jueying.classNames.componentSelected+".component > .NW,\n            ."+jueying.classNames.componentSelected+".component > .NN,\n            ."+jueying.classNames.componentSelected+".component > .NE,\n            ."+jueying.classNames.componentSelected+".component > .EE,\n            ."+jueying.classNames.componentSelected+".component > .SE,\n            ."+jueying.classNames.componentSelected+".component > .SW,\n            ."+jueying.classNames.componentSelected+".component > .SS,\n            ."+jueying.classNames.componentSelected+".component > .WW {\n            display: block;\n            }\n            ul.nav-tabs li i {\n                position: relative;\n                top: 4px;\n                right: -6px;\n            }\n            .validationMessage {\n                position: absolute;\n                margin-top: -60px;\n                background-color: red;\n                color: white;\n                padding: 4px 10px;\n            }\n            ."+jueying.classNames.form+" {\n                min-height: 40px;\n                width: 100%;\n            }\n            ."+jueying.classNames.formItem+" {\n                min-height: 40px;\n                width: 100%;\n            }\n            ."+jueying.classNames.formItem+".active,\n            ."+jueying.classNames.componentWrapper+".active,\n            ."+jueying.classNames.componentWrapper+"."+jueying.classNames.componentSelected+".active {\n                border: 1px solid green;\n            }\n            ."+jueying.classNames.editorPanel+" {\n                width: 300px;\n                background: white;\n                color: black;\n                margin: 0;\n                font-size: 14px;\n                z-index: 100;\n                overflow: auto;\n            }\n            ."+jueying.classNames.editorPanel+" label {\n                width: 80px;\n                float: left;\n                padding: 4px;\n                text-overflow: ellipsis;\n                overflow: hidden;\n            }\n            ."+jueying.classNames.editorPanel+" .control {\n                padding-left: 90px;\n            }\n            ."+jueying.classNames.editorPanel+" .empty {\n                padding-top: 200px;\n                text-align: center;\n            }\n            ."+jueying.classNames.componentPanel+" {\n                background: white;\n                color: black;\n                font-size: 14px;\n                z-index: 100;\n                list-style: none;\n                padding: 0;\n                text-align: center\n            }\n            ."+jueying.classNames.componentPanel+" .panel-heading {\n                text-align: center;\n            }\n            ."+jueying.classNames.componentPanel+" li {\n                text-align: center;\n                padding: 8px;\n            }\n        ",document.head.appendChild(element),jueying.appendClassName=function(element,addonClassName){if(null==element)throw Errors.argumentNull("element");if(!addonClassName)throw Errors.argumentNull("addonClassName");var sourceClassName=void 0;if(sourceClassName=(sourceClassName="string"==typeof element?element:element.className)||"",console.assert(addonClassName),0<=sourceClassName.indexOf(addonClassName))return sourceClassName;var className=sourceClassName+" "+addonClassName;return"string"!=typeof element&&(element.className=className),className},jueying.removeClassName=function(element,targetClassName){var sourceClassName=void 0;return(sourceClassName="string"==typeof element?element:element.className||"").indexOf(targetClassName)<0||(sourceClassName=(sourceClassName=(sourceClassName=sourceClassName||"").replace(new RegExp(targetClassName,"g"),"")).trim(),"string"!=typeof element&&(element.className=sourceClassName)),sourceClassName}}(jueying||(jueying={})),window.jueying=window.jueying||jueying,jueying});

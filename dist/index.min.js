/*!
 * 
 *  maishu-jueying v2.1.10
 *  
 *  Copyright (C) maishu All rights reserved.
 *  
 *  组件设计器 
 *   
 *  作者: 麦舒
 *  日期: 2018/5/30
 *  
 *  个人博客：   http://www.cnblogs.com/ansiboy/
 *  GITHUB:     https://github.com/ansiboy/jueying
 *  QQ 讨论组：  119038574 
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("jquery")):"function"==typeof define&&define.amd?define(["react","jquery"],t):"object"==typeof exports?exports.jueying=t(require("react"),require("jquery")):e.jueying=t(e.react,e.jquery)}(window,(function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(10),a=n(2),s=n(5),l=n(4);t.DesignerContext=r.createContext({designer:null}),t.ComponentWrapperContext=r.createContext(null),t.component=function(e){return function(t){return o.PageDesigner&&i.setAttribute(t.name,e),i.register(t.name,t),t}};class i{static setAttribute(e,t){i.componentAttributes[e]=t}static getAttribute(e){let t="string"==typeof e?e:e.name,n=i.componentAttributes[t];return Object.assign({type:e},i.defaultComponentAttribute,n||{})}static getPropEditors(e){let t=e.type,n=[],r=this.componentPropEditors[t]||[];for(let o=0;o<r.length;o++){let a=r[o].propName,s=i.componentPropEditorDisplay[`${t}.${a}`];null!=s&&0==s(e)||n.push(r[o])}return n}static getPropEditor(e,t){return this.getPropEditorByArray(e,t)}static getPropEditorByArray(e,t){return(this.componentPropEditors[e]||[]).filter(e=>e.propName==t)[0]}static setPropEditor(e,t,n,r){let o,a;if("object"==typeof e){let l=e;o=l.componentType,t=l.propName,n=l.editorType,r=l.group,a=l.display,null!=l.displayName&&(s.proptDisplayNames[t]=l.displayName)}else o=e;r=r||"";let l=t.split("."),p="string"==typeof o?o:o.prototype.typename||o.name;i.componentPropEditorDisplay[`${p}.${t}`]=a;let c=i.componentPropEditors[p]=i.componentPropEditors[p]||[];for(let e=0;e<c.length;e++){if(c[e].propName==l.join("."))return void(c[e].editorType=n)}c.push({propName:t,editorType:n,group:r})}static createElement(e,t){return i._createElement(e,{components:[],componentTypes:[]},t)}static _createElement(e,t,n){if(!e)throw a.Errors.argumentNull("componentData");n=n||r.createElement;try{let o=e.type,a=e.type,s=i.componentTypes[a];s&&(o=s);let p=[];for(let r=0;r<e.children.length;r++){let o=e.children[r];"string"==typeof o?p.push(o):p.push(i._createElement(o,t,n))}let c,d,u=null==e.props?{}:Object.assign({},e.props);null!=s&&s.defaultProps&&(u=Object.assign({},s.defaultProps,u)),"string"==typeof o&&(u.text&&p.push(u.text),delete u.text,n==r.createElement&&delete u.attr),o=o==i.Fragment?r.Fragment:o;let m=u.ref;return u.ref=function(e){if("function"==typeof m&&m(e),e instanceof l.MasterPage){d=e;for(let e=0;e<t.componentTypes.length;e++){let n=t.componentTypes[e];(d.childComponents[n]=d.childComponents[n]||[]).push(t.components[e])}}else null!=e&&(t.components.push(e),t.componentTypes.push("string"==typeof o?o:o.name))},c=n(o,u,...p),c}catch(e){return console.error(e),null}}static register(e,t,n){if(null==t&&"function"==typeof e&&(e=(t=e).name,t.componentName=e),!e)throw a.Errors.argumentNull("componentName");if(!t)throw a.Errors.argumentNull("componentType");i.componentTypes[e]=t,n&&i.setAttribute(e,n)}}i.Fragment="",i.defaultComponentAttribute={container:!1,movable:!1,showHandler:!1,resize:!1},i.componentAttributes={div:{container:!0,movable:!0,showHandler:!0,resize:!0},img:{container:!1,movable:!0,resize:!0},label:{movable:!0},ul:{container:!1,movable:!0,showHandler:!0,resize:!1},li:{container:!0,movable:!1},table:{container:!1,movable:!0,showHandler:!0,resize:!0},thead:{container:!1,movable:!1},tbody:{container:!1,movable:!1},tfoot:{container:!1,movable:!1},tr:{container:!1,movable:!1},td:{container:!0,movable:!1}},i.componentPropEditors={},i.componentPropEditorDisplay={},i.componentTypes={},t.Component=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Errors=class{static placeHolderIdNull(){return new Error("Place holder property id cannt be null or empty.")}static fileNotExists(e){return new Error(`File '${e}' is not exists.`)}static argumentNull(e){return new Error(`Argument ${e} is null or empty.`)}static argumentRangeError(e){return new Error(`Argument ${e} range error.`)}static pageDataIsNull(){return new Error("Page data is null.")}static toolbarRequiredKey(){return new Error("Toolbar has not a key prop.")}static loadPluginFail(e){return new Error(`Load plugin '${e}' fail.`)}static idRequired(){return new Error("Property id is required.")}static canntFindMasterPage(e){return new Error(`Can not find master page for component container ${e}.`)}static propCanntNull(e,t){return new Error(`${e} property ${t} cannt be null or empty.`)}static argumentFieldCanntNull(e,t){return new Error(`${e} of argument ${t} cannt be null or empty.`)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);t.classNames={componentSelected:"component-selected",emptyTemplates:"empty-templates",loadingTemplates:"loading-templates",templateSelected:"template-selected",templateDialog:"template-dialog",emptyDocument:"empty-document",component:"component",componentWrapper:"component-wrapper",componentPanel:"component-panel",componentIcon:"component-icon",placeholder:"placeholder",editorPanel:"editor-panel",designer:"designer",moveDown:"move-down"};let o=40,a=22,s=document.createElement("style");s.type="text/css",s.setAttribute("data-name","jueying"),s.innerHTML=`\n            .${t.classNames.componentSelected} {\n                border: solid 1px #337ab7!important;\n            }\n            .${t.classNames.componentSelected} > :first-child {\n                border-color: blue;\n              }\n              .${t.classNames.componentSelected} .resize_handle {\n                position: absolute;\n                height: 6px;\n                width: 6px;\n                border: 1px solid #89B;\n                background: #9AC;\n              }\n              .${t.classNames.componentSelected} .move_handle {\n                height: 12px;\n                width: 12px;\n                top: 6px;\n                left: 8px;\n                border: solid 1px black;\n                position: relative;\n                margin-top: -12px;\n              }\n              .${t.classNames.componentSelected} .NW,\n              .${t.classNames.componentSelected} .NN,\n              .${t.classNames.componentSelected} .NE {\n                top: -4px;\n              }\n              .${t.classNames.componentSelected} .NE,\n              .${t.classNames.componentSelected} .EE,\n              .${t.classNames.componentSelected} .SE {\n                right: -4px;\n              }\n              .${t.classNames.componentSelected} .SW,\n              .${t.classNames.componentSelected}.SS,\n              .${t.classNames.componentSelected} .SE {\n                bottom: -4px;\n              }\n              .${t.classNames.componentSelected} .NW,\n              .${t.classNames.componentSelected} .WW,\n              .${t.classNames.componentSelected} .SW {\n                left: -4px;\n              }\n              .${t.classNames.componentSelected} .SE,\n              .${t.classNames.componentSelected} .NW {\n                cursor: nw-resize;\n              }\n              .${t.classNames.componentSelected} .SW,\n              .${t.classNames.componentSelected} .NE {\n                cursor: ne-resize;\n              }\n              .${t.classNames.componentSelected} .NN,\n              .${t.classNames.componentSelected} .SS {\n                cursor: n-resize;\n                left: 50%;\n                margin-left: -4px;\n              }\n              .${t.classNames.componentSelected} .EE,\n              .${t.classNames.componentSelected} .WW {\n                cursor: e-resize;\n                top: 50%;\n                margin-top: -4px;\n              }\n            .${t.classNames.emptyTemplates} {\n                padding:50px 0;\n                text-align: center;\n            }\n            .${t.classNames.loadingTemplates} {\n                padding:50px 0;\n                text-align: center;\n            }\n            .${t.classNames.templateSelected} .page-view {\n                border: solid 1px #337ab7!important;\n            }\n            .${t.classNames.templateDialog} .name {\n                margin-top: -${o}px;\n                height: ${o}px;\n                font-size: ${a}px;\n                text-align: center;\n                padding-top: 6px;\n                background-color: black;\n                opacity: 0.5;\n            }\n            .${t.classNames.templateDialog} .name span {\n                color: white;\n            }\n            .${t.classNames.emptyDocument} {\n                text-align: center;\n                padding: 100px 0;\n            }\n            .${t.classNames.component} > .NW,\n            .${t.classNames.component} > .NN,\n            .${t.classNames.component} > .NE,\n            .${t.classNames.component} > .EE,\n            .${t.classNames.component} > .SE,\n            .${t.classNames.component} > .SW,\n            .${t.classNames.component} > .SS,\n            .${t.classNames.component} > .WW {\n                display: none;\n            }\n            .${t.classNames.componentSelected}.component > .NW,\n            .${t.classNames.componentSelected}.component > .NN,\n            .${t.classNames.componentSelected}.component > .NE,\n            .${t.classNames.componentSelected}.component > .EE,\n            .${t.classNames.componentSelected}.component > .SE,\n            .${t.classNames.componentSelected}.component > .SW,\n            .${t.classNames.componentSelected}.component > .SS,\n            .${t.classNames.componentSelected}.component > .WW {\n                display: block;\n            }\n            .${t.classNames.placeholder} {\n                min-height: 40px;\n                width: 100%;\n            }\n            .${t.classNames.placeholder}.active,\n            .${t.classNames.componentWrapper}.active,\n            .${t.classNames.componentWrapper}.${t.classNames.componentSelected}.active {\n                border: 1px solid green;\n            }\n            .${t.classNames.editorPanel} {\n                width: 300px;\n                background: white;\n                color: black;\n                margin: 0;\n                font-size: 14px;\n                z-index: 100;\n                overflow: auto;\n            }\n            .${t.classNames.editorPanel} label {\n                width: 80px;\n                float: left;\n                padding: 4px;\n                text-overflow: ellipsis;\n                overflow: hidden;\n            }\n            .${t.classNames.editorPanel} .control {\n                padding-left: 90px;\n            }\n            .${t.classNames.editorPanel} .empty {\n                padding-top: 200px;\n                text-align: center;\n            }\n            .${t.classNames.designer} .error,\n            .${t.classNames.editorPanel} .error {\n                color: red;\n            }\n            .${t.classNames.componentPanel} {\n                background: white;\n                color: black;\n                font-size: 14px;\n                z-index: 100;\n                list-style: none;\n                padding: 0;\n                text-align: center\n            }\n            .${t.classNames.componentPanel} .panel-heading {\n                text-align: center;\n            }\n            .${t.classNames.componentPanel} li {\n                text-align: center;\n                padding: 8px;\n            }\n            .${t.classNames.componentWrapper}.${t.classNames.moveDown} {\n         \n            }\n        `,document.head.appendChild(s),t.appendClassName=function(e,t){if(null==e)throw r.Errors.argumentNull("element");if(!t)throw r.Errors.argumentNull("addonClassName");let n;if(n="string"==typeof e?e:e.className,n=n||"",console.assert(t),n.indexOf(t)>=0)return n;let o=`${n} ${t}`;return"string"!=typeof e&&(e.className=o),o},t.removeClassName=function(e,t){let n;return n="string"==typeof e?e:e.className||"",n.indexOf(t)<0?n:(n=n||"",n=n.replace(new RegExp(t,"g"),""),n=n.trim(),"string"!=typeof e&&(e.className=n),n)}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(9)),r(n(20)),r(n(22));var o=n(7);t.ComponentTypes=o.ComponentTypes,t.constants=o.constants},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4);t.proptDisplayNames={};var o=n(8);t.guid=o.guid,t.Callback=o.Callback,t.translateComponentDataChildren=function(e){if(null==e||0==e.length)return[];let t=[];for(let n=0;n<e.length;n++){let o=e[n];"string"==typeof o?(o={type:r.ComponentTypes.Text,props:{text:o}},t.push(o)):t.push(e[n])}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(4),a=n(3);class s extends r.Component{constructor(e){super(e),this.state={componets:[]},this.designer=this.props.designer}get element(){return this.toolbarElement}componentDraggable(e,t){console.assert(null!=e),e.draggable=!0,e.addEventListener("dragstart",(function(e){t.props=t.props||{},e.dataTransfer.setData(o.constants.componentData,JSON.stringify(t)),e.dataTransfer.setData("mousePosition",JSON.stringify({x:e.offsetX,y:e.offsetY}))}))}setComponets(e){this.setState({componets:e})}static getComponentData(e){var t=e.getData(o.constants.componentData);if(t)return JSON.parse(t)}static mouseInnerPosition(e){let t=e.getData("mousePosition");if(t)return JSON.parse(t)}render(){let e=this.props.empty||r.createElement("div",{className:"empty"},"暂无可用组件"),t=Object.assign({},this.props),n=this.state.componets||[];return r.createElement("ul",Object.assign({},t,{className:`${a.classNames.componentPanel} ${this.props.className||""}`,ref:e=>this.toolbarElement=this.toolbarElement||e}),0==n.length?e:n.map((e,t)=>{let n={key:t};return n[s.componentIndexName]=`${t}`,r.createElement("li",Object.assign({},n,{className:a.classNames.componentIcon}),r.createElement("div",{className:"btn-link"},r.createElement("i",{className:e.icon,style:{fontSize:44,color:"black"},ref:t=>{if(!t)return;let n=e.componentData;this.componentDraggable(t,n)}})),r.createElement("div",null,e.displayName))}))}}s.componentIndexName="data-component-index",t.ComponentPanel=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentTypes={Text:"Text",PageView:"PageView",PlaceHolder:"PlaceHolder"},t.constants={componentsDir:"components",connectorElementClassName:"component-container",componentTypeName:"data-component-name",componentData:"component-data",componentPosition:"component-position"};var r=n(8);t.guid=r.guid},function(e,t,n){(function(t){
/*!
 * ~
 *  maishu-toolkit v1.1.1
 *  https://github.com/ansiboy/toolkit
 *  
 *  Copyright (c) 2016-2018, shu mai <ansiboy@163.com>
 *  Licensed under the MIT License.
 * 
 */
var n;"undefined"==typeof window||window,n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./out/index.js")}({"./out/callback.js":
/*!*************************!*\
  !*** ./out/callback.js ***!
  \*************************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.funcs=new Array}add(e){this.funcs.push(e)}remove(e){this.funcs=this.funcs.filter(t=>t!=e)}fire(e){this.funcs.forEach(t=>t(e))}static create(){return new r}}t.Callback=r},"./out/errors.js":
/*!***********************!*\
  !*** ./out/errors.js ***!
  \***********************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{argumentNull(e){let t=new Error(`Argument ${e} cannt be null or emtpy.`);return t.name="argumentNull",t}routeDataFieldNull(e){let t=new Error(`The ${e} field of route data cannt be null.`);return t.name="routeDataFieldNull",t}argumentFieldNull(e,t){let n=new Error(`The ${e} field of ${t} cannt be null.`);return n.name="argumentFieldNull",n}argumentTypeIncorrect(e,t){let n=new Error(`Argument ${e} type error, expected type is ${t}.`);return n.name="argumentTypeIncorrect",n}}t.Errors=r,t.errors=new r},"./out/guid.js":
/*!*********************!*\
  !*** ./out/guid.js ***!
  \*********************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.guid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},"./out/index.js":
/*!**********************!*\
  !*** ./out/index.js ***!
  \**********************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(/*! ./guid */"./out/guid.js");t.guid=r.guid;var o=n(/*! ./path */"./out/path.js");t.pathContact=o.pathContact;var a=n(/*! ./errors */"./out/errors.js");t.Errors=a.Errors;var s=n(/*! ./callback */"./out/callback.js");t.Callback=s.Callback},"./out/path.js":
/*!*********************!*\
  !*** ./out/path.js ***!
  \*********************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pathContact=function(...e){if(0==(e=e||[]).length)return"";if(1==e.length)return e[0];let t=e.join("");return t=t.replace(/\/+/g,"/"),t}}})},e.exports=n()}).call(this,n(11))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(1);t.MasterPageName="MasterPage",t.MasterPageContext=r.createContext({master:null});class a extends r.Component{constructor(e){super(e),this.childComponents={};let t=a.children(e);this.state={children:t}}static children(e){let t=null==e.children?[]:Array.isArray(e.children)?e.children:[e.children],n=[];return t.forEach(e=>{r.isValidElement(e)&&n.push(e)}),n}static getDerivedStateFromProps(e){return{children:a.children(e)}}render(){let e={};for(let t in this.props)"ref"!=t&&"id"!=t&&(e[t]=this.props[t]);e.style=Object.assign({minHeight:40},e.style);let n=this.state.children.filter(e=>null==e.props.parentId);return console.assert(null!=this),r.createElement(t.MasterPageContext.Provider,{value:{master:this}},n)}}t.MasterPage=a,o.Component.register(t.MasterPageName,a,{container:!1})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(2),a=n(1),s=n(3),l=n(19);class i extends r.Component{constructor(e){super(e),this.components={};let t=this.props.componentDataHandler.pageData;this.initPageData(t),this.state={pageData:t},this.props.componentDataHandler.componentSelected.add(e=>{this.setState({pageData:this.props.componentDataHandler.pageData})}),this.props.componentDataHandler.componentRemoved.add(e=>{this.setState({pageData:this.props.componentDataHandler.pageData})}),this.props.componentDataHandler.componentUpdated.add(e=>{this.setState({pageData:this.props.componentDataHandler.pageData})}),this.props.componentDataHandler.pageDataChanged.add(e=>{this.setState({pageData:e})})}setComponetRefProp(e){let t={};i.travelComponentData(e).forEach(e=>{console.assert(null!=e.props&&null!=e.id),t[e.type]=t[e.type]||[],t[e.type].push(e.props.id);let n=e.props.ref;e.props.ref=t=>{null!=t&&(this.components[e.type]=this.components[e.type]||[],this.components[e.type].push(t)),"function"==typeof n&&n(t)}});let n=Object.getOwnPropertyNames(this.components);for(let e=0;e<n.length;e++){let r=n[e],o=t[r]||[];this.components[r]=(this.components[r]||[]).filter(e=>o.indexOf(e.id||e.props.id)>=0)}}initPageData(e){null!=e&&(e.children=e.children||[],this.setComponetRefProp(e))}allComponents(){let e=[];for(let t in this.components)e.push(...this.components[t]);return e}get pageData(){return this.state.pageData}get selectedComponentIds(){return this.selectedComponents.map(e=>e.id)}get selectedComponents(){return this.props.componentDataHandler.selectedComponents}get element(){return this._element}updateComponentProp(e,t,n){return this.updateComponentProps({componentId:e,propName:t,value:n})}updateComponentProps(...e){this.props.componentDataHandler.updateComponentProps(e)}appendComponent(e,t,n){this.props.componentDataHandler.appendComponent(e,t,n)}setComponentPosition(e,t){return this.setComponentsPosition([{componentId:e,position:t}])}setComponentSize(e,t){console.assert(null!=e),console.assert(null!=t);let n=this.findComponentData(e);if(!n)throw new Error(`Control ${e} is not exits.`);let r=n.props.style=n.props.style||{};t.height&&(r.height=t.height),t.width&&(r.width=t.width);let{pageData:o}=this.state;this.setState({pageData:o})}setComponentsPosition(e){let t=[];e.forEach(e=>{let{componentId:n}=e,{left:r,top:o}=e.position,a=this.props.componentDataHandler.findComponentData(n);if(!a)throw new Error(`Control ${n} is not exits.`);let s=a.props.style=a.props.style||{};r&&(s.left=r),o&&(s.top=o),t.push({componentId:n,propName:"style",value:s})}),this.props.componentDataHandler.updateComponentProps(t)}selectComponent(e){this.props.componentDataHandler.selectComponents(e),this._element&&this._element.focus()}removeComponent(...e){this.props.componentDataHandler.removeComponents(e)}moveComponent(e,t,n){return this.props.componentDataHandler.moveComponent(e,t,n)}removeComponentFrom(e,t){let n=null;for(let r=0;r<t.length;r++){let o=t[r];if("string"!=typeof o&&e==o.id){n=r;break}}if(null==n){for(let n=0;n<t.length;n++){let r=t[n];if("string"==typeof r)continue;let o=r.children||[];o.forEach(t=>{if("string"==typeof t)return!0;return!!this.removeComponentFrom(e,o)||void 0})}return!1}return 0==n?t.shift():n==t.length-1?t.pop():t.splice(n,1),!0}static travelComponentData(e,t){let n=new Array;n.push(e);let r=[];for(t=t||(()=>!0);n.length>0;){let e=n.shift();t(e)&&r.push(e);let o=(e.children||[]).filter(e=>"object"==typeof e);n.push(...o)}return r}findComponentData(e){return this.props.componentDataHandler.findComponentData(e)}onKeyDown(e){if(46==e.keyCode){if(0==this.selectedComponents.length)return;this.props.componentDataHandler.removeComponents(this.selectedComponentIds)}}createDesignTimeElement(e,t,...n){if(null==e)throw o.Errors.argumentNull("type");if(null==t)throw o.Errors.argumentNull("props");if(null==t.id)throw o.Errors.argumentFieldCanntNull("id","props");console.assert(null!=t.id),null!=t.id&&(t.key=t.id);let i=a.Component.getAttribute(e);console.assert(null!=i);let p=t.attr||{},c=Object.assign({},i,p);delete t.attr;let d=t.selected?s.appendClassName(t.className||"",s.classNames.componentSelected):t.className,u=Object.assign({},t);return delete u.ref,u.className=d,r.createElement(l.ComponentWrapper,Object.assign({},u,{designer:this,source:{type:e,attr:c,props:t,children:n}}))}static getDerivedStateFromProps(e,t){return{pageData:e.componentDataHandler.pageData}}render(){let{pageData:e}=this.state,t=this.props.style,n=this.props.elementTag||"div";return r.createElement(n,{className:s.classNames.designer,tabIndex:1,style:t,ref:t=>{t&&(this._element=t||this._element,this.props.componentFactory.renderDesignTimeComponent(e,t,{handler:this.props.componentDataHandler}))},onKeyDown:e=>this.onKeyDown(e)})}}i.defaultProps={componentDataHandler:null},t.PageDesigner=i},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(13),n(15),n(16),n(17),n(18);var o=n(5);t.strings=o.proptDisplayNames,t.proptDisplayNames=o.proptDisplayNames;var a=n(1);t.Component=a.Component,t.DesignerContext=a.DesignerContext;var s=n(6);t.ComponentPanel=s.ComponentPanel;var l=n(23);t.EditorPanel=l.EditorPanel;var i=n(10);t.PageDesigner=i.PageDesigner;var p=n(25);t.PropEditor=p.PropEditor,t.TextInput=p.TextInput;var c=n(3);t.classNames=c.classNames;var d=n(26);t.ComponentFactory=d.ComponentFactory;var u=n(27);t.ComponentDataHandler=u.ComponentDataHandler,r(n(4)),r(n(28));var m=n(29);t.component=m.component},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(14);null==(window.$||window.jQuery)&&(window.$=window.jQuery=r)},function(e,n){e.exports=t},function(e,t){!function(e){e.fn.drag=function(t,n,r){var o="string"==typeof t?t:"",a=e.isFunction(t)?t:e.isFunction(n)?n:null;return 0!==o.indexOf("drag")&&(o="drag"+o),r=(t==a?n:r)||{},a?this.bind(o,r,a):this.trigger(o)};var t=e.event,n=t.special,r=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var n=e.data(this,r.datakey),o=t.data||{};n.related+=1,e.each(r.defaults,(function(e,t){void 0!==o[e]&&(n[e]=o[e])}))},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(!e.data(this,r.datakey)){var n=e.extend({related:0},r.defaults);e.data(this,r.datakey,n),t.add(this,"touchstart mousedown",r.init,n),this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)}},teardown:function(){(e.data(this,r.datakey)||{}).related||(e.removeData(this,r.datakey),t.remove(this,"touchstart mousedown",r.init),r.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",r.dontstart))},init:function(o){if(!r.touched){var a,s=o.data;if(!(0!=o.which&&s.which>0&&o.which!=s.which)&&!e(o.target).is(s.not)&&(!s.handle||e(o.target).closest(s.handle,o.currentTarget).length)&&(r.touched="touchstart"==o.type?this:null,s.propagates=1,s.mousedown=this,s.interactions=[r.interaction(this,s)],s.target=o.target,s.pageX=o.pageX,s.pageY=o.pageY,s.dragging=null,a=r.hijack(o,"draginit",s),s.propagates))return(a=r.flatten(a))&&a.length&&(s.interactions=[],e.each(a,(function(){s.interactions.push(r.interaction(this,s))}))),s.propagates=s.interactions.length,!1!==s.drop&&n.drop&&n.drop.handler(o,s),r.textselect(!1),r.touched?t.add(r.touched,"touchmove touchend",r.handler,s):t.add(document,"mousemove mouseup",r.handler,s),!(!r.touched||s.live)&&void 0}},interaction:function(t,n){var o=e(t)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new r.callback,droppable:[],offset:o}},handler:function(o){var a=o.data;switch(o.type){case!a.dragging&&"touchmove":o.preventDefault();case!a.dragging&&"mousemove":if(Math.pow(o.pageX-a.pageX,2)+Math.pow(o.pageY-a.pageY,2)<Math.pow(a.distance,2))break;o.target=a.target,r.hijack(o,"dragstart",a),a.propagates&&(a.dragging=!0);case"touchmove":o.preventDefault();case"mousemove":if(a.dragging){if(r.hijack(o,"drag",a),a.propagates){!1!==a.drop&&n.drop&&n.drop.handler(o,a);break}o.type="mouseup"}case"touchend":case"mouseup":default:r.touched?t.remove(r.touched,"touchmove touchend",r.handler):t.remove(document,"mousemove mouseup",r.handler),a.dragging&&(!1!==a.drop&&n.drop&&n.drop.handler(o,a),r.hijack(o,"dragend",a)),r.textselect(!0),!1===a.click&&a.dragging&&e.data(a.mousedown,"suppress.click",(new Date).getTime()+5),a.dragging=r.touched=!1}},hijack:function(n,o,a,s,l){if(a){var i,p,c,d={event:n.originalEvent,type:n.type},u=o.indexOf("drop")?"drag":"drop",m=s||0,h=isNaN(s)?a.interactions.length:s;n.type=o,n.originalEvent=null,a.results=[];do{if(p=a.interactions[m]){if("dragend"!==o&&p.cancelled)continue;c=r.properties(n,a,p),p.results=[],e(l||p[u]||a.droppable).each((function(s,l){if(c.target=l,n.isPropagationStopped=function(){return!1},!1===(i=l?t.dispatch.call(l,n,c):null)?("drag"==u&&(p.cancelled=!0,a.propagates-=1),"drop"==o&&(p[u][s]=null)):"dropinit"==o&&p.droppable.push(r.element(i)||l),"dragstart"==o&&(p.proxy=e(r.element(i)||p.drag)[0]),p.results.push(i),delete n.result,"dropinit"!==o)return i})),a.results[m]=r.flatten(p.results),"dropinit"==o&&(p.droppable=r.flatten(p.droppable)),"dragstart"!=o||p.cancelled||c.update()}}while(++m<h);return n.type=d.type,n.originalEvent=d.event,r.flatten(a.results)}},properties:function(e,t,n){var o=n.callback;return o.drag=n.drag,o.proxy=n.proxy||n.drag,o.startX=t.pageX,o.startY=t.pageY,o.deltaX=e.pageX-t.pageX,o.deltaY=e.pageY-t.pageY,o.originalX=n.offset.left,o.originalY=n.offset.top,o.offsetX=o.originalX+o.deltaX,o.offsetY=o.originalY+o.deltaY,o.drop=r.flatten((n.drop||[]).slice()),o.available=r.flatten((n.droppable||[]).slice()),o},element:function(e){if(e&&(e.jquery||1==e.nodeType))return e},flatten:function(t){return e.map(t,(function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t}))},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).css("MozUserSelect",t?"":"none"),document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){n.drop&&this.available.length&&e.each(this.available,(function(e){n.drop.locate(this,e)}))}};var o=t.dispatch;t.dispatch=function(t){if(!(e.data(this,"suppress."+t.type)-(new Date).getTime()>0))return o.apply(this,arguments);e.removeData(this,"suppress."+t.type)};var a=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,n){if(n){var r=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;r&&e.each(a.props,(function(e,n){t[n]=r[n]}))}return t}};n.draginit=n.dragstart=n.dragend=r}(jQuery)},function(e,t){!function(e){var t=e.event,n=t.special.drag,r=n.add,o=n.teardown;n.noBubble=!1,n.livekey="livedrag",n.add=function(o){r.apply(this,arguments);var a=e.data(this,n.datakey);!a.live&&o.selector&&(a.live=!0,t.add(this,"draginit."+n.livekey,n.delegate))},n.teardown=function(){o.apply(this,arguments);var r=e.data(this,n.datakey)||{};r.live&&(t.remove(this,"draginit."+n.livekey,n.delegate),r.live=!1)},n.delegate=function(r){var o,a=[],s=e.data(this,"events")||{};return e.each(s||[],(function(s,l){0===s.indexOf("drag")&&e.each(l||[],(function(s,l){(o=e(r.target).closest(l.selector,r.currentTarget)[0])&&(t.add(o,l.origType+"."+n.livekey,l.origHandler||l.handler,l.data),e.inArray(o,a)<0&&a.push(o))}))})),!!a.length&&e(a).bind("dragend."+n.livekey,(function(){t.remove(this,"."+n.livekey)}))}}(jQuery)},function(e,t){!function(e){e.fn.drop=function(t,n,r){var o="string"==typeof t?t:"",a=e.isFunction(t)?t:e.isFunction(n)?n:null;return 0!==o.indexOf("drop")&&(o="drop"+o),r=(t==a?n:r)||{},a?this.bind(o,r,a):this.trigger(o)},e.drop=function(t){t=t||{},n.multi=!0===t.multi?1/0:!1===t.multi?1:isNaN(t.multi)?n.multi:t.multi,n.delay=t.delay||n.delay,n.tolerance=e.isFunction(t.tolerance)?t.tolerance:null===t.tolerance?null:n.tolerance,n.mode=t.mode||n.mode||"intersect"};var t=e.event.special,n=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(t){e.data(this,n.datakey).related+=1},remove:function(){e.data(this,n.datakey).related-=1},setup:function(){if(!e.data(this,n.datakey)){e.data(this,n.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}}),n.targets.push(this)}},teardown:function(){if(!(e.data(this,n.datakey)||{}).related){e.removeData(this,n.datakey);var t=this;n.targets=e.grep(n.targets,(function(e){return e!==t}))}},handler:function(r,o){var a;if(o)switch(r.type){case"mousedown":case"touchstart":a=e(n.targets),"string"==typeof o.drop&&(a=a.filter(o.drop)),a.each((function(){var t=e.data(this,n.datakey);t.active=[],t.anyactive=0,t.winner=0})),o.droppable=a,t.drag.hijack(r,"dropinit",o);break;case"mousemove":case"touchmove":n.event=r,n.timer||n.tolerate(o);break;case"mouseup":case"touchend":n.timer=clearTimeout(n.timer),o.propagates&&(t.drag.hijack(r,"drop",o),t.drag.hijack(r,"dropend",o))}},locate:function(t,r){var o=e.data(t,n.datakey),a=e(t),s=a.offset()||{},l=a.outerHeight(),i=a.outerWidth(),p={elem:t,width:i,height:l,top:s.top,left:s.left,right:s.left+i,bottom:s.top+l};return o&&(o.location=p,o.index=r,o.elem=t),p},contains:function(e,t){return(t[0]||t.left)>=e.left&&(t[0]||t.right)<=e.right&&(t[1]||t.top)>=e.top&&(t[1]||t.bottom)<=e.bottom},modes:{intersect:function(e,t,n){return this.contains(n,[e.pageX,e.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(e,t,n){return Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top))*Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left))},fit:function(e,t,n){return this.contains(n,t)?1:0},middle:function(e,t,n){return this.contains(n,[t.left+.5*t.width,t.top+.5*t.height])?1:0}},sort:function(e,t){return t.winner-e.winner||e.index-t.index},tolerate:function(r){var o,a,s,l,i,p,c,d,u=0,m=r.interactions.length,h=[n.event.pageX,n.event.pageY],f=n.tolerance||n.modes[n.mode];do{if(d=r.interactions[u]){if(!d)return;d.drop=[],i=[],p=d.droppable.length,f&&(s=n.locate(d.proxy)),o=0;do{if(c=d.droppable[o]){if(!(a=(l=e.data(c,n.datakey)).location))continue;l.winner=f?f.call(n,n.event,s,a):n.contains(a,h)?1:0,i.push(l)}}while(++o<p);i.sort(n.sort),o=0;do{(l=i[o])&&(l.winner&&d.drop.length<n.multi?(l.active[u]||l.anyactive||(!1!==t.drag.hijack(n.event,"dropstart",r,u,l.elem)[0]?(l.active[u]=1,l.anyactive+=1):l.winner=0),l.winner&&d.drop.push(l.elem)):l.active[u]&&1==l.anyactive&&(t.drag.hijack(n.event,"dropend",r,u,l.elem),l.active[u]=0,l.anyactive-=1))}while(++o<p)}}while(++u<m);n.last&&h[0]==n.last.pageX&&h[1]==n.last.pageY?delete n.timer:n.timer=setTimeout((function(){n.tolerate(r)}),n.delay),n.last=n.event}};t.dropinit=t.dropstart=t.dropend=n}(jQuery)},function(e,t){!function(e){var t=e.event,n=t.special.drop,r=n.add,o=n.teardown;n.noBubble=!1,n.livekey="livedrop",n.add=function(o){r.apply(this,arguments);var a=e.data(this,n.datakey);!a.live&&o.selector&&(a.live=!0,t.add(this,"dropinit."+n.livekey,n.delegate))},n.teardown=function(){o.apply(this,arguments);var r=e.data(this,n.datakey)||{};r.live&&(t.remove(this,"dropinit",n.delegate),r.live=!1)},n.delegate=function(r,o){var a,s=[],l=e.data(this,"events")||{};return e.each(l||[],(function(o,l){0===o.indexOf("drop")&&e.each(l,(function(o,l){(a=e(r.currentTarget).find(l.selector)).length&&a.each((function(){t.add(this,l.origType+"."+n.livekey,l.origHandler||l.handler,l.data),e.inArray(this,s)<0&&s.push(this)}))}))})),o&&t.add(o.drag,"dragend."+n.livekey,(function(){e.each(s.concat(this),(function(){t.remove(this,"."+n.livekey)}))})),!!s.length&&e(s)}}(jQuery)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(2),a=n(6),s=n(3),l=n(1),i=n(4);class p extends r.Component{constructor(e){super(e)}componentDidCatch(e,t){this.setState({error:e})}designtimeBehavior(e,t){if(!e)throw o.Errors.argumentNull("element");if(!t)throw o.Errors.argumentNull("args");if(e.getAttribute("data-behavior"))return;e.setAttribute("data-behavior","behavior");let n=this.props.designer;console.assert(null!=t.container),console.assert(null!=t.movable),t.container&&p.enableAppendDroppable(e,n),t.movable?(console.assert(null!=e),p.draggable(n,e),null!=this.handler&&p.draggable(n,e,this.handler)):e.onclick=t=>p.invokeOnClick(t,n,e)}static enableAppendDroppable(e,t){console.assert(null!=e),e.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation();let t=e.dataTransfer.getData(i.constants.componentData);e.dataTransfer.dropEffect=t?"copy":"move",console.log(`dragover: left:${e.layerX} top:${e.layerX}`)})),e.addEventListener("drop",(function(n){n.preventDefault(),n.stopPropagation();arguments[1];if(!n.dataTransfer)return;let r=a.ComponentPanel.getComponentData(n.dataTransfer);if(!r)return;r.props.style=r.props.style||{},t.pageData.props.style=t.pageData.props.style||{},r.props.style.position||(r.props.style.position=t.pageData.props.style.position);let o=a.ComponentPanel.mouseInnerPosition(n.dataTransfer);console.assert(null!=o),"absolute"==r.props.style.position&&(r.props.style.left=n.layerX-o.x,r.props.style.top=n.layerY-o.y),t.appendComponent(e.id,r)}))}static isResizeHandleClassName(e){return["resize_handle NE","resize_handle NN","resize_handle NW","resize_handle WW","resize_handle EE","resize_handle SW","resize_handle SS","resize_handle SE"].indexOf(e)>=0}static draggable(e,t,n){if(!e)throw o.Errors.argumentNull("designer");if(!t)throw o.Errors.argumentNull("element");console.assert(""!=t.id),n=n||t;let r,a,l,i=t.id;console.assert(""!=i),$(n).drag("init",(function(e){if(r=$(t).position(),$(this).is(`.${s.classNames.componentSelected}`))return $(`.${s.classNames.componentSelected}`)})).drag("start",(function(e,n){n.attr=$(e.target).prop("className"),n.width=$(this).width(),n.height=$(this).height(),n.sourceElement=t,l=Date.now()})).drag((function(e,t){e.preventDefault(),e.stopPropagation(),console.log("drop:"),console.log(t.drop),a={},t.attr.indexOf("E")>-1&&(a.width=Math.max(32,t.width+t.deltaX)),t.attr.indexOf("S")>-1&&(a.height=Math.max(32,t.height+t.deltaY)),t.attr.indexOf("W")>-1&&(a.width=Math.max(32,t.width-t.deltaX),u(t)),t.attr.indexOf("N")>-1&&(a.height=Math.max(32,t.height-t.deltaY),d(t)),t.attr.indexOf("WW")>=0&&u(t),(t.attr.indexOf("NE")>=0||t.attr.indexOf("NW")>=0||t.attr.indexOf("SW")>=0)&&c(t),t.attr.indexOf("NN")>=0&&d(t),t.attr.indexOf("drag")>-1&&(a.top=t.offsetY,a.left=t.offsetX),p.isResizeHandleClassName(t.attr)||c(t),t.attr&&$(this).css(a)}),{click:!0}).drag("end",(function(n,o){let s=Date.now()-l;if(p.isDrag=s>=300,p.isResizeHandleClassName(o.attr)){let n,s;o.attr.indexOf("W")>-1&&(n=r.left+o.deltaX),o.attr.indexOf("N")>-1&&(s=r.top+o.deltaY),t.style.transform="",e.setComponentPosition(t.id,{left:n,top:s}),e.setComponentSize(i,a)}else{let n=r.left+o.deltaX,a=r.top+o.deltaY;e.setComponentPosition(t.id,{left:n,top:a}),t.style.transform=""}})).click(n=>{p.invokeOnClick(n,e,t)});let c=e=>{console.log(["dd.offsetX, dd.offsetY",e.offsetX,e.offsetY]),console.log(e),t.style.transform=`translate(${e.deltaX}px,${e.deltaY}px)`},d=e=>{t.style.transform=`translateY(${e.deltaY}px)`},u=e=>{t.style.transform=`translateX(${e.deltaX}px)`}}static invokeOnClick(e,t,n){if(e.preventDefault(),e.stopPropagation(),p.isDrag)return void(p.isDrag=!1);let r=n.id;if(!e.ctrlKey)return void t.selectComponent(n.id);let o=t.selectedComponentIds;console.assert(""!=r),o.indexOf(r)>=0?o=o.filter(e=>e!=r):o.push(r),t.selectComponent(o)}componentDidMount(){if(!this.element)return;let e=this.props.source.attr;this.designtimeBehavior(this.element,e)}render(){let{error:e}=this.state||{};if(e)return r.createElement("div",{className:"error"},r.createElement("div",null,e.message),r.createElement("div",null,e.stack));let t=this.props.source.attr;if(!(t.resize||"string"!=typeof this.props.source.type&&this.props.source.type!=i.MasterPage))return this.renderWidthoutWrapper();let n=this.props.source.props,o=n.style=JSON.parse(JSON.stringify(n.style||{})),{top:a,left:p,position:c,width:d,height:u,display:m,visibility:h}=o,f=s.appendClassName(n.className||"",s.classNames.componentWrapper);f=n.selected?s.appendClassName(f,s.classNames.componentSelected):f;let g={id:n.id,className:f,style:{top:a,left:p,position:c,width:d,height:u,display:m,visibility:h},ref:e=>this.element=e||this.element},y=n.selected&&t.showHandler?r.createElement("div",{className:"move_handle",style:{},ref:e=>this.handler=e||this.handler}):null,v=t.resize&&"absolute"==n.style.position&&n.selected,b=this.props.source;return n.style&&(delete n.style.left,delete n.style.top,delete n.style.position,g.style.width&&"unset"!=g.style.width&&(n.style.width="100%"),g.style.height&&"unset"!=g.style.height&&(n.style.height="100%")),r.createElement(l.ComponentWrapperContext.Provider,{value:this},r.createElement("div",Object.assign({},g),y,v?r.createElement(r.Fragment,null,r.createElement("div",{className:"resize_handle NE"}),r.createElement("div",{className:"resize_handle NN"}),r.createElement("div",{className:"resize_handle NW"}),r.createElement("div",{className:"resize_handle WW"}),r.createElement("div",{className:"resize_handle EE"}),r.createElement("div",{className:"resize_handle SW"}),r.createElement("div",{className:"resize_handle SS"}),r.createElement("div",{className:"resize_handle SE"})):null,this.createRawElement(b.type,b.props,b.children)))}renderWidthoutWrapper(){let{type:e,props:t,children:n}=this.props.source,o=t.ref;t.ref=e=>{if("function"==typeof o&&o(e),e)if(e.tagName){let t=this.props.source.attr;this.designtimeBehavior(e,t)}else;},t.selected&&(t.className=s.appendClassName(t.className||"",s.classNames.componentSelected));let a=this.createRawElement(e,t,n);return r.createElement(l.ComponentWrapperContext.Provider,{value:this},a)}createRawElement(e,t,n){if(0==(n||[]).length){let r=this.designTimeEmptyElement(e,t);null!=r&&(n=[r])}return r.createElement(e,t,...n)}designTimeEmptyElement(e,t){if("input"==e||"img"==e||"meta"==e||"link"==e)return null;let n="string"==typeof e?e:e.name;return this.designTimeText(n,t)}designTimeText(e,t){let n=t.text;return n||(n=n||t.name||e,n)}}p.isDrag=!1,t.ComponentWrapper=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(21),a=n(3),s=n(6),l=n(9),i=n(1),p=n(7);class c extends r.Component{constructor(e){if(super(e),!this.props.id)throw o.Errors.placeHolderIdNull()}enableAppendDroppable(e,t){if(e.getAttribute("enable-append-droppable"))return;e.setAttribute("enable-append-droppable","true"),console.assert(null!=e),e.addEventListener("dragover",(function(t){t.preventDefault(),t.stopPropagation(),e.className=a.appendClassName(e.className||"","active");let n=t.dataTransfer.getData(p.constants.componentData);t.dataTransfer.dropEffect=n?"copy":"move",console.log(`dragover: left:${t.layerX} top:${t.layerX}`)}));let n=function(t){t.preventDefault(),t.stopPropagation(),e.className=a.removeClassName(e.className,"active")};e.addEventListener("dragleave",n),e.addEventListener("dragend",n),e.addEventListener("dragexit",n),e.ondrop=n=>{let r;n.preventDefault(),n.stopPropagation(),e.className=a.removeClassName(e.className,"active"),n.dataTransfer&&(r=s.ComponentPanel.getComponentData(n.dataTransfer)),r&&(console.assert(null!=this.props.id),console.assert(null!=this.designer),r.parentId=this.props.id,console.assert(null!=t,"host is null"),this.designer.appendComponent(t.props.id,r))}}enableMoveDroppable(e,t){e.getAttribute("enable-move-droppable")||(e.setAttribute("enable-move-droppable","true"),$(e).drop("start",(t,n)=>{n.sourceElement.id!=this.wraper.props.source.props.id&&a.appendClassName(e,"active")}).drop("drop",(e,n)=>{if(n.sourceElement.id==this.wraper.props.source.props.id)return;let r=this.designer.findComponentData(n.sourceElement.id);console.assert(null!=r);this.designer.moveComponent(n.sourceElement.id,t.props.id),this.designer.updateComponentProps({componentId:"string",propName:"string",value:"any"})}).drop("end",(t,n)=>{n.sourceElement.id!=this.wraper.props.source.props.id&&a.removeClassName(e,"active")}))}render(){let e=this.props.empty||r.createElement("div",{key:p.guid(),className:"empty"},"可以拖拉控件到这里");return r.createElement(l.MasterPageContext.Consumer,null,t=>{let n=t.master;if(null==n)throw o.Errors.canntFindMasterPage(this.props.id);let s=[];if(n.props&&n.props.children){let e;e=Array.isArray(n.props.children)?n.props.children:[n.props.children],s=e.filter(e=>null!=e.props.parentId&&e.props.parentId==this.props.id)}return r.createElement(i.DesignerContext.Consumer,null,t=>r.createElement(i.ComponentWrapperContext.Consumer,null,o=>{this.wraper=o,console.assert(null!=this.wraper),null!=t.designer&&0==s.length&&(s=[e]);let l=r.createElement(r.Fragment,null,this.props.children,s);return t.designer&&(this.designer=t.designer,l=r.createElement("div",{key:p.guid(),className:a.classNames.placeholder,ref:e=>{e&&(this.element=e,this.enableAppendDroppable(e,n),this.enableMoveDroppable(e,n))}},l)),l}))})}}t.PlaceHolder=c,i.Component.register(p.ComponentTypes.PlaceHolder,c)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Errors=class{static propCanntNull(e,t){return new Error(`${e} property ${t} cannt be null or empty.`)}static placeHolderIdNull(){return new Error("Place holder property id cannt be null or empty.")}static canntFindMasterPage(e){return new Error(`Can not find master page for component container ${e}.`)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(1),a=n(7);class s extends r.Component{render(){return r.createElement("span",null,this.props.text)}}t.Text=s,o.Component.register(a.ComponentTypes.Text,s)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(24),a=n(3);class s extends r.Component{constructor(e){super(e),this.state={componentDatas:[]}}get designer(){return this._designer}render(){let{empty:e}=this.props;e=e||r.createElement("div",{className:"empty"},"暂无可用的属性");let{designer:t}=this.props;return r.createElement("div",{className:`${a.classNames.editorPanel} ${this.props.className||""}`,ref:e=>this.element=e||this.element},r.createElement(o.PropertyEditor,{designer:t,ref:e=>this.editor=e||this.editor,empty:e,customRender:this.props.customRender}))}}t.EditorPanel=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(1),a=n(5),s=n(2);class l extends r.Component{constructor(e){super(e),this._element=null,this.state={groupedEditors:[]},this.props.designer.componentSelected.add(()=>{let e=this.getEditors(this.props.designer);this.setState({groupedEditors:e})})}getEditors(e){if(null==e)return[];let t,n=[],a=e.selectedComponents;for(let e=0;e<a.length;e++){let t=a[e],r=o.Component.getPropEditors(t);if(0==e)n=r||[];else{let e=[];n.forEach(t=>{r.forEach(n=>{let r=t.propName,o=n.propName;t.editorType==n.editorType&&r==o&&e.push(t)})}),n=e}}for(let e=0;e<a.length;e++){let n=a[e],r=Object.assign({},n.props);if(delete r.children,0==e)t=r;else{let e={};for(let n in t)t[n]==r[n]&&(e[n]=r[n]);t=e}}let s=[];for(let o=0;o<n.length;o++){let l=n[o],i=l.propName,p=l.editorType,c={value:this.propValue(i,t),editComponents:a,updateComponentProp:t=>{let n=a.map(e=>({componentId:e.id,propName:l.propName,value:t}));e.updateComponentProps(n)}},d=r.createElement(p,c);s.push({prop:l.propName,editor:d,group:l.group})}return s}propValue(e,t){if(!e)throw s.Errors.argumentNull("propName");if(!t)throw s.Errors.argumentNull("props");let n=e.split("."),r=t;for(let e=0;e<n.length;e++)if(r=r[n[e]],null==r)return null;return r}render(){let{designer:e}=this.props,t=this.state.groupedEditors;if(0==t.length){let e=this.props.empty;return r.createElement("div",{className:"text-center"},e)}if(this.props.customRender){let n=t.map(e=>Object.assign({displayName:a.proptDisplayNames[e.prop]||e.prop},e)),r=this.props.customRender(e.selectedComponents,n);if(null!=r)return r}let n=[];for(let e=0;e<t.length;e++){let r=t[e].group||"",o=n.filter(e=>e.group==r)[0];null==o&&(o={group:t[e].group,editors:[]},n.push(o)),o.editors.push({prop:t[e].prop,editor:t[e].editor})}return r.createElement(r.Fragment,null,n.map(e=>r.createElement("div",{key:e.group,className:"panel panel-default"},e.group?r.createElement("div",{className:"panel-heading"},a.proptDisplayNames[e.group]||e.group):null,r.createElement("div",{className:"panel-body"},e.editors.map((e,t)=>r.createElement("div",{key:e.prop,className:"form-group clearfix"},r.createElement("label",null,a.proptDisplayNames[e.prop]||e.prop),r.createElement("div",{className:"control"},r.createElement(i,null,e.editor))))))))}get element(){return this._element}}t.PropertyEditor=l;class i extends r.Component{constructor(e){super(e),this.state={}}componentDidCatch(e,t){this.setState({error:e})}render(){let{error:e}=this.state||{};return e?r.createElement("div",{className:"error"},r.createElement("div",null,e.message),r.createElement("div",null,e.stack)):this.props.children}}t.ErrorBoundary=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{i(r.next(e))}catch(e){a(e)}}function l(e){try{i(r.throw(e))}catch(e){a(e)}}function i(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,l)}i((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);class a extends o.Component{constructor(e){super(e)}static dropdown(e,t){return function(e,t){let n,s=[];if(null==t&&Array.isArray(e)){t=e.length>0&&"number"==typeof e[0]?"number":"string";for(let t=0;t<e.length;t++)s[t]={text:e[t],value:e[t]}}else if(null==t){t="string";let n=Object.getOwnPropertyNames(e);for(let t=0;t<n.length;t++)s[t]={text:e[n[t]],value:n[t]}}else Array.isArray(e)?s=e:n=e;return class extends a{constructor(e){super(e),this.state={}}componentDidMount(){return r(this,void 0,void 0,(function*(){if(n){let e=yield n;this.setState({items:e})}}))}render(){let{items:e}=this.state,{value:n}=this.props;return e=e||s,o.createElement("select",{className:"form-control",value:null==n?"":n,onChange:e=>{let r=e.target.value;if("number"==t){let e=/^[+-]?\d+(\.\d+)?$/;n=/^\d+$/.test(r)?parseInt(r):e.test(r)?parseFloat(r):null}else n=r;this.props.updateComponentProp(n)}},e.map(e=>o.createElement("option",{key:e.value,value:e.value},e.text)))}}}(e,t)}static textInput(){return s}}t.PropEditor=a;class s extends a{render(){let{value:e}=this.props;return o.createElement("input",{className:"form-control",value:e||"",onChange:e=>{this.props.updateComponentProp(e.target.value)}})}}t.TextInput=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ComponentFactory=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),o=n(8);class a{constructor(e){this._components={},this.componentSelected=o.Callback.create(),this.componentRemoved=o.Callback.create(),this.componentAppend=o.Callback.create(),this.componentUpdated=o.Callback.create(),this.pageDataChanged=o.Callback.create(),this._pageData=e,this.fillComponentData(this._pageData)}fillComponentData(e){null!=e&&(e.children=e.children||[],a.nameComponent(e),a.setComponetRefProp(e,this._components))}get selectedComponents(){let e=new Array,t=new Array;for(t.push(this._pageData);t.length>0;){let n=t.pop();null!=n.props&&1==n.selected&&e.push(n),n.children.forEach(e=>{if("string"==typeof e)return!0;t.push(e)})}return e}get selectedComponentIds(){return this.selectedComponents.map(e=>e.id)}get components(){return this._components}get pageData(){return this._pageData}set pageData(e){this._pageData=e,this.fillComponentData(e),this.pageDataChanged.fire(e)}moveComponent(e,t,n){let r=this.findComponentData(e);if(null==r)throw new Error(`Cannt find component by id ${e}`);console.assert(null!=r,`Cannt find component by id ${e}`);let o=this.pageData;console.assert(null!=o.children);let a=o.children;this.removeComponentFrom(e,a),this.appendComponent(t,r,n)}updateComponentProps(e){let t=[];for(let n=0;n<e.length;n++){let{componentId:r,propName:o,value:a}=e[n],s=this.findComponentData(r);if(null==s)continue;let l=o.split(".");console.assert(null!=s),console.assert(null!=l,"props is null"),s.props=s.props||{};let i=s.props;for(let e=0;e<l.length-1;e++)i=i[l[e]]=i[l[e]]||{};i[l[l.length-1]]=a,t.push(s)}this.componentUpdated.fire(t)}findComponentData(e){let t=this._pageData;if(!t)throw r.Errors.pageDataIsNull();return a.travelComponentData(t,t=>t.id==e)[0]}removeComponentFrom(e,t){let n=null;for(let r=0;r<t.length;r++){let o=t[r];if("string"!=typeof o&&e==o.id){n=r;break}}if(null==n){for(let n=0;n<t.length;n++){let r=t[n];if("string"==typeof r)continue;let o=r.children;if(o&&o.length>0){if(this.removeComponentFrom(e,o))return!0}}return!1}return 0==n?t.shift():n==t.length-1?t.pop():t.splice(n,1),!0}static travelComponentData(e,t){let n=new Array;n.push(e);let r=[];for(t=t||(()=>!0);n.length>0;){let e=n.shift();t(e)&&r.push(e);let o=(e.children||[]).filter(e=>"object"==typeof e);n.push(...o)}return r}appendComponent(e,t,n){if(!e)throw r.Errors.argumentNull("parentId");if(!t)throw r.Errors.argumentNull("childComponent");this.fillComponentData(t);let o=this.findComponentData(e);if(null==o)throw new Error("Parent is not exists");console.assert(null!=o),o.children=o.children||[],null!=n?o.children.splice(n,0,t):o.children.push(t),this.selectComponents(t.id),this.componentAppend.fire(this)}static nameComponent(e){let t={},n=e.props=e.props||{};if(n.id&&(e.id=n.id,delete n.id),n.parentId&&(e.parentId=n.parentId,delete e.parentId),n.selected&&(e.selected=n.selected),n.name&&(e.name=n.name,delete n.name),!e.name){let n,r=0;do{r+=1,n=`${e.type}${r}`}while(t[n]);t[n]=e,e.name=n}e.id||(e.id=o.guid()),e.children=e.children||[],e.children&&0!=e.children.length&&e.children.forEach(e=>{if("string"==typeof e)return!0;a.nameComponent(e)})}static setComponetRefProp(e,t){let n={};a.travelComponentData(e).forEach(e=>{console.assert(null!=e.props&&null!=e.id),n[e.type]=n[e.type]||[],n[e.type].push(e.props.id);let r=e.props.ref;e.props.ref=n=>{null!=n&&(t[e.type]=t[e.type]||[],t[e.type].push(n)),"function"==typeof r&&r(n)}});let r=Object.getOwnPropertyNames(t);for(let e=0;e<r.length;e++){let o=r[e],a=n[o]||[];t[o]=(t[o]||[]).filter(e=>a.indexOf(e.id||e.props.id)>=0)}}selectComponent(e){return this.selectComponents(e)}selectComponents(e){"string"==typeof e&&(e=[e]);var t=[];for(t.push(this._pageData);t.length>0;){let n=t.pop(),r=e.indexOf(n.id)>=0;n.selected=r,n.children.forEach(e=>{if("string"==typeof e)return!0;t.push(e)})}this.componentSelected.fire(this.selectedComponentIds)}removeComponent(e){return this.removeComponents([e])}removeComponents(e){let t=this.pageData;if(!t||!t.children||0==t.children.length)return;let n=t.children;e.forEach(e=>{this.removeComponentFrom(e,n)}),this.componentRemoved.fire(e)}}t.ComponentDataHandler=a},function(e,t,n){(function(t){
/*!
 * ~
 *  jueying-core v1.0.2
 * 
 *  Copyright (c) 2016-2018, mais.shu <ansiboy@163.com>
 *  Licensed under the MIT License.
 * 
 */
var r;"undefined"==typeof window||window,r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./out/index.js")}({"./out/component-factory.js":
/*!**********************************!*\
  !*** ./out/component-factory.js ***!
  \**********************************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(/*! react */"react"),o=n(/*! ./errors */"./out/errors.js");t.CompoenntFactory=class{constructor(e){this.compoenntTypes=e}createComponent(e,t){try{return this._createComponent(e,t)}catch(e){return this.createErrorElement(e)}}createViewComponent(e,...t){return r.createElement("div",e,...t)}createErrorElement(e){return this.createViewComponent(this.createViewComponent("Error:"),this.createViewComponent(e.message))}_createComponent(e,t){if("string"==typeof e)return e;let n=(e.children||[]).map(e=>this._createComponent(e)),a=e.props||{},s=e.typeName,l=this.compoenntTypes[s];if(null==l)throw o.errors.componentNotExists(s);return r.createElement(l,a,n)}}},"./out/errors.js":
/*!***********************!*\
  !*** ./out/errors.js ***!
  \***********************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors={pathFieldRequired:e=>new Error(`Path field of '${e}' component config can not be null or empty.`),canntFindModule:(e,t)=>new Error(`Can not find component '${e}' in the module, module path is: '${t}'.`),componentNotExists:e=>new Error(`Component '${e}' not exists.`)}},"./out/index.js":
/*!**********************!*\
  !*** ./out/index.js ***!
  \**********************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(/*! ./component-factory */"./out/component-factory.js");t.CompoenntFactory=r.CompoenntFactory},react:
/*!************************!*\
  !*** external "react" ***!
  \************************/
/*! no static exports found */function(t,n){t.exports=e}})},e.exports=r(n(0))}).call(this,n(11))},function(e,t,n){
/*!
 * ~
 *  jueying-core v1.0.2
 * 
 *  Copyright (c) 2016-2018, mais.shu <ansiboy@163.com>
 *  Licensed under the MIT License.
 * 
 */
var r;window,r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./out/decorators.js")}({"./out/decorators.js":
/*!***************************!*\
  !*** ./out/decorators.js ***!
  \***************************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.component=function(e){return function(e){}}}})},e.exports=r()}])}));
//# sourceMappingURL=index.min.js.map
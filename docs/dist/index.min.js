/*!
 * 
 *  maishu-jueying v4.0.3
 *  
 *  Copyright (C) maishu All rights reserved.
 *  
 *  组件设计器 
 *   
 *  作者: 麦舒
 *  日期: 2018/5/30
 *  
 *  个人博客：   http://www.cnblogs.com/ansiboy/
 *  GITHUB:     https://github.com/ansiboy/jueying
 *  QQ 讨论组：  119038574 
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("maishu-jueying-core"),require("maishu-dilu")):"function"==typeof define&&define.amd?define(["react","maishu-jueying-core","maishu-dilu"],t):"object"==typeof exports?exports.jueying=t(require("react"),require("maishu-jueying-core"),require("maishu-dilu")):e.jueying=t(e.react,e["maishu-jueying-core"],e["maishu-dilu"])}(window,(function(e,t,n){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors=void 0;const o=n(10);class r extends o.Errors{placeHolderIdNull(){return new Error("Place holder property id cannt be null or empty.")}fileNotExists(e){return new Error(`File '${e}' is not exists.`)}argumentNull(e){return new Error(`Argument ${e} is null or empty.`)}argumentRangeError(e){return new Error(`Argument ${e} range error.`)}pageDataIsNull(){return new Error("Page data is null.")}toolbarRequiredKey(){return new Error("Toolbar has not a key prop.")}loadPluginFail(e){return new Error(`Load plugin '${e}' fail.`)}idRequired(){return new Error("Property id is required.")}canntFindMasterPage(e){return new Error(`Can not find master page for component container ${e}.`)}propCanntNull(e,t){return new Error(`${e} property ${t} cannt be null or empty.`)}argumentFieldCanntNull(e,t){return new Error(`${e} of argument ${t} cannt be null or empty.`)}designerContextArgumentNull(){let e=new Error("Designer cottext argument null.");return e.name=t.errors.designerContextArgumentNull.name,e}}t.errors=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.elementFactoryName=t.isCustomComponent=t.groupDisplayNames=t.proptDisplayNames=t.constants=void 0;const o=n(4);t.constants={componentsDir:"components",connectorElementClassName:"component-container",componentTypeName:"data-component-name",componentData:"component-data",componentPosition:"component-position"},t.proptDisplayNames={},t.groupDisplayNames={},t.isCustomComponent=function(e){return e.type.toLocaleLowerCase()!=e.type&&!o.componentTypes[e.type]},t.elementFactoryName="h"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors=void 0;const o=n(10),r=n(13);class a extends o.Errors{pathFieldRequired(e){return new Error(`Path field of '${e}' component config can not be null or empty.`)}canntFindModule(e,t){return new Error(`Can not find component '${e}' in the module, module path is: '${t}'.`)}componentTypeNotExists(e){return new Error(`Component '${e}' not exists.`)}argumentNull(e){return new Error(`Argument '${e}' can not be null or empty.`)}propsFileNull(e){let t=new Error(`Field '${e}' of props is null.`);return t.name="propsFileNull",t}nullPageDataParserArguments(){r.PageDataParser;let e=new Error("PageDataParser arguments is null. Is this component child of PageDataParser?");return e.name="nullPageDataParserArguments",e}}t.errors=new a},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;const o=n(9),r=n(4);class a{static getPropEditors(e){let t=e.type,n=[],o=this.componentPropEditors[t]||[];for(let r=0;r<o.length;r++){let s=o[r].propName,l=a.componentPropEditorDisplay[`${t}.${s}`];null!=l&&0==l(e)||n.push(o[r])}return n}static getPropEditor(e,t){return this.getPropEditorByArray(e,t)}static getPropEditorByArray(e,t){return(this.componentPropEditors[e]||[]).filter(e=>e.propName==t)[0]}static setPropEditor(e){let{componentType:t,editorType:n,display:r,group:s,propName:l,displayName:i,defaultValue:p,validation:c}=e;s=s||o.defaultGroupName,l=l||"",i=i||l;let m=l.split("."),u="string"==typeof t?t:t.prototype.typename||t.name;a.componentPropEditorDisplay[`${u}.${l}`]=r;let d=a.componentPropEditors[u]=a.componentPropEditors[u]||[];for(let e=0;e<d.length;e++){if(d[e].propName==m.join("."))return void(d[e].editorType=n)}d.push({propName:l,displayName:i,editorType:n,group:s,defaultValue:p,validation:c})}static register(e,t){return(0,r.registerComponent)(e,t)}}t.Component=a,a.Fragment="",a.componentPropEditors={},a.componentPropEditorDisplay={}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageDesigner=t.DesignerContext=void 0;const o=n(0),r=n(4),a=n(1),s=n(16),l=n(17),i=n(12),p=n(5),c=n(18),m=n(2);t.DesignerContext=o.createContext(null);class u extends o.Component{constructor(e){if(super(e),this._prePageData=null,!e)throw a.errors.argumentNull("props");if(!e.componentsConfig)throw a.errors.argumentFieldCanntNull("componentsConfig","props");this.checkComponentsConfig(e.componentsConfig);let t=this.props.pageData,n={};this.initPageData(t,n),this.state={pageData:t,componentTypes:n,componentEditors:{}}}checkComponentsConfig(e){}initPageData(e,t){if(null==e)throw a.errors.argumentNull("pageData");console.assert(null!=e.children,"PageData children is null."),new i.PageDataTravel(e).each(e=>{"string"!=typeof e&&(0,m.isCustomComponent)(e)&&!t[e.type]&&(t[e.type]=(0,l.createLoadingComponent)())})}initComponent(e,t){let n={};if(t.children.forEach(e=>{e.name&&(n[e.name]=e)}),!e.name){let t,o=0;do{o+=1,t=`${e.type}${o}`}while(n[t]);n[t]=e,e.name=t}e.id||(e.id=(0,s.guid)())}get pageData(){return this.state.pageData}get componentTypes(){return this.state.componentTypes}get prePageData(){return this._prePageData}set prePageData(e){this._prePageData=e}get selectedComponentIds(){return this.selectedComponents.map(e=>e.id)}get selectedComponents(){return this.pageData.children.filter(e=>((e.status||r.ComponentStatus.default)&r.ComponentStatus.selected)==r.ComponentStatus.selected)}get element(){return this._element}updateComponentProp(e,t,n){return this.updateComponentProps([{componentId:e,propName:t,value:n}])}updateComponentProps(e){let t=[];for(let n=0;n<e.length;n++){let{componentId:o,propName:r,value:a}=e[n],s=this.findComponentData(o);if(null==s)continue;let l=r.split(".");console.assert(null!=s),console.assert(null!=l,"props is null"),s.props=s.props||{};let i=s.props;for(let e=0;e<l.length-1;e++)i=i[l[e]]=i[l[e]]||{};i[l[l.length-1]]=a,t.push(s)}this.setState({pageData:this.pageData})}appendComponent(e,t){if(!e.parentId)throw new Error("ParentId field of component data is null.");if(!e)throw a.errors.argumentNull("childComponent");let n=this.pageData;this.initComponent(e,n),null==t?n.children.push(e):n.children.splice(t,0,e),this.selectComponents(e.id)}selectComponent(e){this.selectComponents(e),this._element&&this._element.focus()}selectComponents(e){"string"==typeof e&&(e=[e]),this.pageData.children.forEach(e=>{e.status=e.status||r.ComponentStatus.default,e.status=e.status&~r.ComponentStatus.selected}),this.pageData.children.filter(t=>e.indexOf(t.id)>=0).forEach(e=>{e.status=e.status||r.ComponentStatus.default,e.status=e.status|r.ComponentStatus.selected}),this.setState({pageData:this.pageData})}removeComponent(...e){this.removeComponents(e)}removeComponents(e){let t=this.pageData;if(t&&t.children&&0!=t.children.length){for(let n=0;n<e.length;n++)this.removeComponentFrom(e[n],t);this.setState({pageData:t})}}moveComponent(e,t,n){let o=this.findComponentData(e);if(null==o)throw new Error("Cannt find component by id "+e);console.assert(null!=o,"Cannt find component by id "+e),o.parentId=t;let r=this.pageData;console.assert(null!=r.children),this.removeComponentFrom(e,r),this.appendComponent(o,n)}removeComponentFrom(e,t){let n=t.children.filter(t=>t.id==e)[0];if(null==n)throw new Error(`Component '${e}' is not exists.`);let o=[n],a=[e];for(;o.length>0;){let e=o.pop(),n=t.children.filter(t=>t.parentId==e.id);n.length>0&&(o.push(...n),a.push(...n.filter(e=>null==e.status||(e.status&r.ComponentStatus.asset)!=r.ComponentStatus.asset).map(e=>e.id)))}t.children=t.children.filter(e=>a.indexOf(e.id)<0)}findComponentData(e){let t=this.state.pageData;if(!t)throw a.errors.pageDataIsNull();return t.children.filter(t=>t.id==e)[0]}async loadEditorTypes(e){let t=[];new i.PageDataTravel(e).each(e=>{"string"!=typeof e&&(0,m.isCustomComponent)(e)&&t.push(e.type)});let n=this.props.componentsConfig,o=t.map(e=>n[e]).filter(e=>e).map(e=>e.editor);await Promise.all(o);let r=e.children.filter(e=>"string"!=typeof e).map(e=>e),a=this.state.componentEditors;for(let e of r){a[e.type]=a[e.type]||{};let t=p.Component.getPropEditors(e);for(let n of t)a[e.type][n.propName]=n.editorType}this.setState({componentEditors:a})}loadComponentTypes(e){let t={},n=this.props.componentsConfig,o=[];return new i.PageDataTravel(e).each(e=>{"string"==typeof e||o.indexOf(e.type)>=0||!(0,m.isCustomComponent)(e)||o.push(e.type)}),u.loadComponentTypes(o,n).then(e=>{Object.assign(t,e),this.setState({componentTypes:t})})}static async loadComponentTypes(e,t){let n=[],o={};for(let a=0;a<e.length;a++){let s=e[a];if(!s){let e=`Component '${s}' has not a config.`;o[s]=(0,l.createInfoComponent)(e);continue}if(r.componentTypes[s]){n.push(Promise.resolve(r.componentTypes[s]));continue}let i=new Promise((function(e,n){if(!t[s]){let t=`Component '${s}' is not exists.`;return o[s]=(0,l.createInfoComponent)(t),void e({})}if(!(t[s].type instanceof Promise)){let t=`Component '${s}' type is invalid.`;return o[s]=(0,l.createInfoComponent)(t),void e({})}t[s].type.then(t=>{if(t.default)o[s]=t.default;else{let e=`Component '${s}' module has not export default member.`;o[s]=(0,l.createInfoComponent)(e)}e({})}).catch(e=>{n(e)})}));n.push(i)}return await Promise.all(n),o}onKeyDown(e){if(46==e.keyCode){if(0==this.selectedComponents.length)return;this.removeComponents(this.selectedComponentIds)}}async onPageDataChanged(e){this.loadComponentTypes(e),this.loadEditorTypes(e)}static getDerivedStateFromProps(e,t){return{pageData:e.pageData}}render(){let e=this.state.pageData;return(0,c.deepEqual)(this.prePageData,e)||(this.prePageData=JSON.parse(JSON.stringify(e)),this.onPageDataChanged(e)),o.createElement("div",{tabIndex:0,ref:e=>this._element=this._element||e,onKeyDown:e=>this.onKeyDown(e),className:this.props.className,style:this.props.style},o.createElement(t.DesignerContext.Provider,{value:{designer:this}},this.props.children))}}t.PageDesigner=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeClassName=t.appendClassName=t.classNames=void 0;const o=n(1);t.classNames={componentSelected:"component-selected",emptyTemplates:"empty-templates",loadingTemplates:"loading-templates",templateSelected:"template-selected",templateDialog:"template-dialog",emptyDocument:"empty-document",empty:"empty",selected:"selected",component:"component",componentWrapper:"component-wrapper",componentPanel:"component-panel",componentIcon:"component-icon",placeholder:"placeholder",editorPanel:"editor-panel",designer:"designer",moveDown:"move-down"};let r=40,a=22,s=document.createElement("style");s.type="text/css",s.setAttribute("data-name","jueying"),s.innerHTML=`\n            .${t.classNames.componentSelected} {\n                border: solid 1px #337ab7!important;\n            }\n            .${t.classNames.componentSelected} > :first-child {\n                border-color: blue;\n              }\n              .${t.classNames.componentSelected} .resize_handle {\n                position: absolute;\n                height: 6px;\n                width: 6px;\n                border: 1px solid #89B;\n                background: #9AC;\n              }\n              .${t.classNames.componentSelected} .move_handle {\n                height: 12px;\n                width: 12px;\n                top: 6px;\n                left: 8px;\n                border: solid 1px black;\n                position: relative;\n                margin-top: -12px;\n              }\n              .${t.classNames.componentSelected} .NW,\n              .${t.classNames.componentSelected} .NN,\n              .${t.classNames.componentSelected} .NE {\n                top: -4px;\n              }\n              .${t.classNames.componentSelected} .NE,\n              .${t.classNames.componentSelected} .EE,\n              .${t.classNames.componentSelected} .SE {\n                right: -4px;\n              }\n              .${t.classNames.componentSelected} .SW,\n              .${t.classNames.componentSelected}.SS,\n              .${t.classNames.componentSelected} .SE {\n                bottom: -4px;\n              }\n              .${t.classNames.componentSelected} .NW,\n              .${t.classNames.componentSelected} .WW,\n              .${t.classNames.componentSelected} .SW {\n                left: -4px;\n              }\n              .${t.classNames.componentSelected} .SE,\n              .${t.classNames.componentSelected} .NW {\n                cursor: nw-resize;\n              }\n              .${t.classNames.componentSelected} .SW,\n              .${t.classNames.componentSelected} .NE {\n                cursor: ne-resize;\n              }\n              .${t.classNames.componentSelected} .NN,\n              .${t.classNames.componentSelected} .SS {\n                cursor: n-resize;\n                left: 50%;\n                margin-left: -4px;\n              }\n              .${t.classNames.componentSelected} .EE,\n              .${t.classNames.componentSelected} .WW {\n                cursor: e-resize;\n                top: 50%;\n                margin-top: -4px;\n              }\n            .${t.classNames.emptyTemplates} {\n                padding:50px 0;\n                text-align: center;\n            }\n            .${t.classNames.loadingTemplates} {\n                padding:50px 0;\n                text-align: center;\n            }\n            .${t.classNames.templateSelected} .page-view {\n                border: solid 1px #337ab7!important;\n            }\n            .${t.classNames.templateDialog} .name {\n                margin-top: -${r}px;\n                height: ${r}px;\n                font-size: ${a}px;\n                text-align: center;\n                padding-top: 6px;\n                background-color: black;\n                opacity: 0.5;\n            }\n            .${t.classNames.templateDialog} .name span {\n                color: white;\n            }\n            .${t.classNames.emptyDocument} {\n                text-align: center;\n                padding: 100px 0;\n            }\n            .${t.classNames.component} > .NW,\n            .${t.classNames.component} > .NN,\n            .${t.classNames.component} > .NE,\n            .${t.classNames.component} > .EE,\n            .${t.classNames.component} > .SE,\n            .${t.classNames.component} > .SW,\n            .${t.classNames.component} > .SS,\n            .${t.classNames.component} > .WW {\n                display: none;\n            }\n            .${t.classNames.componentSelected}.component > .NW,\n            .${t.classNames.componentSelected}.component > .NN,\n            .${t.classNames.componentSelected}.component > .NE,\n            .${t.classNames.componentSelected}.component > .EE,\n            .${t.classNames.componentSelected}.component > .SE,\n            .${t.classNames.componentSelected}.component > .SW,\n            .${t.classNames.componentSelected}.component > .SS,\n            .${t.classNames.componentSelected}.component > .WW {\n                display: block;\n            }\n            .${t.classNames.placeholder} {\n                min-height: 40px;\n                width: 100%;\n            }\n            .${t.classNames.placeholder}.active,\n            .${t.classNames.componentWrapper}.active,\n            .${t.classNames.componentWrapper}.${t.classNames.componentSelected}.active {\n                border: 1px solid green;\n            }\n            .${t.classNames.editorPanel} {\n                width: 300px;\n                background: white;\n                color: black;\n                margin: 0;\n                font-size: 14px;\n                z-index: 100;\n                overflow: auto;\n            }\n            .${t.classNames.editorPanel} label {\n                width: 80px;\n                float: left;\n                padding: 4px;\n                text-overflow: ellipsis;\n                overflow: hidden;\n            }\n            .${t.classNames.editorPanel} .control {\n                padding-left: 90px;\n            }\n            .${t.classNames.editorPanel} .empty {\n                padding-top: 200px;\n                text-align: center;\n            }\n            .${t.classNames.designer} .error,\n            .${t.classNames.editorPanel} .error {\n                color: red;\n            }\n            .${t.classNames.componentPanel} {\n                background: white;\n                color: black;\n                font-size: 14px;\n                z-index: 100;\n                list-style: none;\n                padding: 0;\n                text-align: center\n            }\n            .${t.classNames.componentPanel} .panel-heading {\n                text-align: center;\n            }\n            .${t.classNames.componentPanel} li {\n                text-align: center;\n                padding: 8px;\n            }\n            .${t.classNames.componentWrapper}.${t.classNames.moveDown} {\n         \n            }\n        `,null!=document.head&&document.head.appendChild(s),t.appendClassName=function(e,t){if(null==e)throw o.errors.argumentNull("element");if(!t)throw o.errors.argumentNull("addonClassName");let n;if(n="string"==typeof e?e:e.className,n=n||"",console.assert(null!=t),n.indexOf(t)>=0)return n;let r=`${n} ${t}`;return"string"!=typeof e&&(e.className=r),r},t.removeClassName=function(e,t){let n;return n="string"==typeof e?e:e.className||"",n.indexOf(t)<0||(n=n||"",n=n.replace(new RegExp(t,"g"),""),n=n.trim(),"string"!=typeof e&&(e.className=n)),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseComponentData=void 0;const o=n(3),r=n(23);t.parseComponentData=function e(t,n,a){if(!t)throw o.errors.argumentNull("componentData");if(!n)throw o.errors.argumentNull("componentTypes");if(!t.type)throw o.errors.argumentFieldNull("type","componentData");let s=t.type.toLowerCase()==t.type?t.type:n[t.type]||r.componentTypes[t.type];if(null==s)throw o.errors.componentTypeNotExists(t.type);let l=[],i=t.children||[];i.length>0&&(l=i.map(t=>"string"==typeof t?t:e(t,n,a)));let p=Object.assign({},t.props);return p.key=p.key||t.id,p.id=t.id,a(s,p,l)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorBoundary=t.PropertyEditor=t.defaultGroupName=void 0;const o=n(0),r=n(5),a=n(1),s=n(6),l=n(2),i=n(19);t.defaultGroupName="";class p extends o.Component{constructor(e){super(e),this.state={}}getEditors(e){if(null==e)return[];let t=[],n=e.selectedComponents;for(let e=0;e<n.length;e++){let o=n[e],a=r.Component.getPropEditors(o);if(0==e)t=a||[];else{let e=[];t.forEach(t=>{a.forEach(n=>{let o=t.propName,r=n.propName;t.editorType==n.editorType&&o==r&&e.push(t)})}),t=e}}let a={};for(let e=0;e<n.length;e++){let t=n[e],o=Object.assign({},t.props);if(delete o.children,0==e)a=o;else{let e={};for(let t in a)a[t]==o[t]&&(e[t]=o[t]);a=e}}let s=[];for(let r=0;r<t.length;r++){let l=t[r],p=l.propName,c=l.editorType,m=this.propValue(p,a);null==m&&(m=l.defaultValue);let u={value:m,editComponents:n,updateComponentProp:o=>{let r=n.map(e=>({componentId:e.id,propName:l.propName,value:o}));null==this._validator&&(this._validateFields=t.filter(e=>null!=e.validation).map(e=>Object.assign(e.validation,{name:e.propName,rules:[]})),this._validator=new i.FormValidator(this.element,...this._validateFields)),this._validateFields.filter(e=>e.name==l.propName).length>0&&this._validator.checkElement(l.propName),e.updateComponentProps(r)}},d=o.createElement(c,u);s.push({prop:l.propName,displayName:l.displayName,editor:d,group:l.group})}return s}propValue(e,t){if(!e)throw a.errors.argumentNull("propName");if(!t)throw a.errors.argumentNull("props");let n=e.split("."),o=t;for(let e=0;e<n.length;e++)if(o=o[n[e]],null==o)return null;return o}render(){return o.createElement(s.DesignerContext.Consumer,null,e=>{if(!e)throw a.errors.designerContextArgumentNull();let n=e.designer,r=this.getEditors(n);if(0==r.length){let e=this.props.empty;return o.createElement("div",{className:"text-center"},e)}if(this.props.customRender){let e=r.map(e=>Object.assign({displayName:e.displayName},e)),t=this.props.customRender(n.selectedComponents,e);if(null!=t)return o.createElement("div",{ref:e=>this._element=e||this._element},t)}let s=[];for(let e=0;e<r.length;e++){let n=r[e].group||t.defaultGroupName,o=s.filter(e=>e.group==n)[0];null==o&&(o={group:r[e].group,editors:[]},s.push(o)),o.editors.push({prop:r[e].prop,displayName:r[e].displayName,editor:r[e].editor})}return s.map(e=>o.createElement("div",{key:e.group,className:"panel panel-default",ref:e=>this._element=e||this._element},e.group?o.createElement("div",{className:"panel-heading"},l.groupDisplayNames[e.group]||e.group):null,o.createElement("div",{className:"panel-body"},e.editors.map((e,t)=>o.createElement("div",{key:e.prop,className:"form-group clearfix"},o.createElement("label",null,e.displayName),o.createElement("div",{className:"control"},o.createElement(c,null,e.editor)))))))})}get element(){return this._element}get validator(){return this._validator}}t.PropertyEditor=p,p.contextType=s.DesignerContext;class c extends o.Component{constructor(e){super(e),this.state={}}componentDidCatch(e,t){this.setState({error:e})}render(){let{error:e}=this.state||{};return e?o.createElement("div",{className:"error"},o.createElement("div",null,e.message),o.createElement("div",null,e.stack)):this.props.children}}t.ErrorBoundary=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors=t.Errors=void 0;class o{argumentNull(e){let t=new Error(`Argument ${e} cannt be null or emtpy.`);return t.name="argumentNull",t}routeDataFieldNull(e){let t=new Error(`The ${e} field of route data cannt be null.`);return t.name="routeDataFieldNull",t}argumentFieldNull(e,t){let n=new Error(`The ${e} field of ${t} cannt be null.`);return n.name="argumentFieldNull",n}argumentTypeIncorrect(e,t){let n=new Error(`Argument ${e} type error, expected type is ${t}.`);return n.name="argumentTypeIncorrect",n}pathStartsHttp(e){let t=new Error(`Path ${e} start with http or https.`);return t.name="pathStartsHttp",t}}t.Errors=o,t.errors=new o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.strings=void 0,t.strings={emptyCompoenntPanel:"暂无可用组件",emptyDiagram:"请拖放组件到此处",componentLoading:"组件正在加载中..."}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageDataTravel=void 0;const o=n(1);class r{constructor(e){this.pageData=e}each(e){let t=[...this.pageData.children||[]],n=t.pop();for(;null!=n;){if(e(n),"string"!=typeof n){let e=n.children||[];t.push(...e)}n=t.pop()}}static findComponent(e,t){if(!e)throw o.errors.argumentNull("pageData");if(!t)throw o.errors.argumentNull("componentId");let n;return new r(e).each((function(e){"string"==typeof e||n||t==e.id&&(n=e)})),n}}t.PageDataTravel=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageDataParser=t.PageDataParserContext=void 0;const o=n(3),r=n(0),a=n(8);t.PageDataParserContext=r.createContext(null);class s extends r.Component{constructor(e){if(super(e),!e)throw o.errors.argumentNull("props");if(!e.pageData)throw o.errors.argumentFieldNull("pageData","props");if(!e.elementFactory)throw o.errors.argumentFieldNull("elementFactory","props");this.state={pageData:e.pageData,componentTypes:e.componentTypes}}static getDerivedStateFromProps(e,t){return{pageData:e.pageData,componentTypes:e.componentTypes}}render(){let{pageData:e}=this.state,{elementFactory:n,componentTypes:o}=this.props,s=e.children.filter(e=>!e.parentId).map(e=>(0,a.parseComponentData)(e,o,n));return r.createElement(t.PageDataParserContext.Provider,{value:{pageData:e,elementFactory:n,componentTypes:o}},s)}}t.PageDataParser=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DesignComponentContext=void 0;const o=n(0);t.DesignComponentContext=o.createContext(null)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentDiagram=t.classNames=t.DesignerContext=t.PageDesigner=t.EditorPanel=t.Component=t.groupDisplayNames=void 0;var o=n(2);Object.defineProperty(t,"groupDisplayNames",{enumerable:!0,get:function(){return o.groupDisplayNames}});var r=n(5);Object.defineProperty(t,"Component",{enumerable:!0,get:function(){return r.Component}});var a=n(20);Object.defineProperty(t,"EditorPanel",{enumerable:!0,get:function(){return a.EditorPanel}});var s=n(6);Object.defineProperty(t,"PageDesigner",{enumerable:!0,get:function(){return s.PageDesigner}}),Object.defineProperty(t,"DesignerContext",{enumerable:!0,get:function(){return s.DesignerContext}});var l=n(7);Object.defineProperty(t,"classNames",{enumerable:!0,get:function(){return l.classNames}});var i=n(21);Object.defineProperty(t,"ComponentDiagram",{enumerable:!0,get:function(){return i.ComponentDiagram}}),n(25)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.guid=void 0,t.guid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLoadingComponent=t.createInfoComponent=void 0;const o=n(0),r=n(11);t.createInfoComponent=function(e){return class extends o.Component{render(){return o.createElement("div",{className:"text-center",style:{paddingTop:20,paddingBottom:20}},e)}}},t.createLoadingComponent=function(){return class extends o.Component{render(){return o.createElement("div",{key:this.props.id,style:{padding:"50px 0 50px 0",textAlign:"center"}},r.strings.componentLoading)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deepEqual=void 0,t.deepEqual=function e(t,n){if(t===n)return!0;if("object"==typeof t&&null!=t&&"object"==typeof n&&null!=n){if(Object.keys(t).length!=Object.keys(n).length)return!1;for(var o in t){if(!n.hasOwnProperty(o))return!1;if(!e(t[o],n[o]))return!1}return!0}return!1}},function(e,t){e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditorPanel=void 0;const o=n(0),r=n(9),a=n(7);class s extends o.Component{constructor(e){super(e),this.state={componentDatas:[]}}validateInputs(){return this.editor.validator.checkAsync()}render(){let{empty:e}=this.props;return e=e||o.createElement("div",{className:"empty"},"暂无可用的属性"),o.createElement("div",{className:`${a.classNames.editorPanel} ${this.props.className||""}`,ref:e=>this.element=e||this.element},o.createElement(r.PropertyEditor,{ref:e=>this.editor=e||this.editor,empty:e,customRender:this.props.customRender}))}}t.EditorPanel=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentDiagram=void 0;const o=n(1),r=n(22),a=n(8),s=n(0),l=n(6),i=n(11),p=n(7),c=n(12),m=n(14);class u extends s.Component{constructor(e){if(super(e),!e)throw o.errors.argumentNull("props");this.state={}}selectComponent(e,t){t?e.selectComponent(t):e.selectComponent([])}static createComponent(e,t,n){let r=t;if(!r.id)throw o.errors.argumentFieldNull("id","props");return s.createElement(l.DesignerContext.Consumer,null,a=>{if(!a)throw o.errors.designerContextArgumentNull();let l=c.PageDataTravel.findComponent(a.designer.pageData,r.id);if(!l)throw new Error(`Can not find component data by '${r.id}' in the page data.`);let i=a.designer.props.componentsConfig[l.type];if(!i)return s.createElement(e,t,n);let p={componentData:l,componentConfig:i};return s.createElement(m.DesignComponentContext.Provider,{value:p},s.createElement(e,t,n))})}render(){return s.createElement("ul",null,s.createElement(l.DesignerContext.Consumer,null,e=>{if(!e)throw o.errors.designerContextArgumentNull();let t=e.designer.pageData.children||[];if(0==t.length)return s.createElement("li",null,i.strings.emptyCompoenntPanel);let n=e.designer.componentTypes;return s.createElement(s.Fragment,null,t.map(t=>{let o=((t.status||r.ComponentStatus.default)&r.ComponentStatus.selected)==r.ComponentStatus.selected;return s.createElement("li",{key:t.id,className:o?p.classNames.selected:"",onClick:n=>{n.preventDefault(),n.stopPropagation(),this.selectComponent(e.designer,t.id)}},(0,a.parseComponentData)(t,n,u.createComponent))}))}))}}t.ComponentDiagram=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentStatus=void 0,function(e){e[e.default=0]="default",e[e.selected=1]="selected",e[e.disabled=2]="disabled",e[e.asset=4]="asset"}(t.ComponentStatus||(t.ComponentStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerComponent=t.componentTypes=void 0;const o=n(24),r=n(3);t.componentTypes={},t.registerComponent=function(e,n){if(null==n&&"function"==typeof e&&(e=(n=e).name,n.componentName=e),!e)throw r.errors.argumentNull("componentName");if(!n)throw r.errors.argumentNull("componentType");t.componentTypes[e]=n},t.componentTypes[o.ComponentPlaceHolder.typeName]=o.ComponentPlaceHolder},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentPlaceHolder=void 0;const o=n(0),r=n(13),a=n(3),s=n(8);class l extends o.Component{constructor(e){super(e)}render(){return o.createElement(r.PageDataParserContext.Consumer,null,e=>{if(!e)throw a.errors.nullPageDataParserArguments();return e.pageData.children.filter(e=>e.parentId&&e.parentId==this.props.id).map(t=>(0,s.parseComponentData)(t,e.componentTypes,e.elementFactory))})}}t.ComponentPlaceHolder=l,l.typeName="PlaceHolder"},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),r=n(14),a=n(27),s=n(2),l=(e,t,...n)=>{let s={};return t&&(s={key:t.id||t.key}),o.createElement(r.DesignComponentContext.Consumer,s,r=>null!=r?((("number"==typeof r.componentConfig.design?r.componentConfig.design:a.DesignBehavior.default)&a.DesignBehavior.disableClick)==a.DesignBehavior.disableClick&&delete t.onClick,o.createElement(e,t,...n)):o.createElement(e,t,...n))};"undefined"==typeof window?e[s.elementFactoryName]=l:window[s.elementFactoryName]=l}).call(this,n(26))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DesignBehavior=void 0,function(e){e[e.default=1]="default",e[e.disableClick=1]="disableClick"}(t.DesignBehavior||(t.DesignBehavior={}))}])}));
//# sourceMappingURL=index.min.js.map
/*!
 * 
 *  maishu-jueying v3.1.4
 *  
 *  Copyright (C) maishu All rights reserved.
 *  
 *  组件设计器 
 *   
 *  作者: 麦舒
 *  日期: 2018/5/30
 *  
 *  个人博客：   http://www.cnblogs.com/ansiboy/
 *  GITHUB:     https://github.com/ansiboy/jueying
 *  QQ 讨论组：  119038574 
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("maishu-jueying-core")):"function"==typeof define&&define.amd?define(["react","maishu-jueying-core"],t):"object"==typeof exports?exports.jueying=t(require("react"),require("maishu-jueying-core")):e.jueying=t(e.react,e["maishu-jueying-core"])}(window,(function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Errors=class{static placeHolderIdNull(){return new Error("Place holder property id cannt be null or empty.")}static fileNotExists(e){return new Error(`File '${e}' is not exists.`)}static argumentNull(e){return new Error(`Argument ${e} is null or empty.`)}static argumentRangeError(e){return new Error(`Argument ${e} range error.`)}static pageDataIsNull(){return new Error("Page data is null.")}static toolbarRequiredKey(){return new Error("Toolbar has not a key prop.")}static loadPluginFail(e){return new Error(`Load plugin '${e}' fail.`)}static idRequired(){return new Error("Property id is required.")}static canntFindMasterPage(e){return new Error(`Can not find master page for component container ${e}.`)}static propCanntNull(e,t){return new Error(`${e} property ${t} cannt be null or empty.`)}static argumentFieldCanntNull(e,t){return new Error(`${e} of argument ${t} cannt be null or empty.`)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.constants={componentsDir:"components",connectorElementClassName:"component-container",componentTypeName:"data-component-name",componentData:"component-data",componentPosition:"component-position"},t.proptDisplayNames={},t.groupDisplayNames={},t.guid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};class r{constructor(){this.funcs=new Array}add(e){this.funcs.push(e)}remove(e){this.funcs=this.funcs.filter(t=>t!=e)}fire(e){this.funcs.forEach(t=>t(e))}static create(){return new r}}t.Callback=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),o=n(9);class s{static getPropEditors(e){let t=e.type,n=[],r=this.componentPropEditors[t]||[];for(let o=0;o<r.length;o++){let l=r[o].propName,a=s.componentPropEditorDisplay[`${t}.${l}`];null!=a&&0==a(e)||n.push(r[o])}return n}static getPropEditor(e,t){return this.getPropEditorByArray(e,t)}static getPropEditorByArray(e,t){return(this.componentPropEditors[e]||[]).filter(e=>e.propName==t)[0]}static setPropEditor(e){let{componentType:t,editorType:n,display:o,group:l,propName:a,displayName:i,defaultValue:c,validation:p}=e;l=l||r.defaultGroupName,a=a||"",i=i||a;let u=a.split("."),m="string"==typeof t?t:t.prototype.typename||t.name;s.componentPropEditorDisplay[`${m}.${a}`]=o;let d=s.componentPropEditors[m]=s.componentPropEditors[m]||[];for(let e=0;e<d.length;e++){if(d[e].propName==u.join("."))return void(d[e].editorType=n)}d.push({propName:a,displayName:i,editorType:n,group:l,defaultValue:c,validation:p})}static register(e,t){return o.registerComponent(e,t)}}t.Component=s,s.Fragment="",s.componentPropEditors={},s.componentPropEditorDisplay={}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(3),s=n(1),l=n(5),a=n(2),i=n(8);t.defaultGroupName="";class c extends r.Component{constructor(e){super(e),this.state={}}getEditors(e){if(null==e)return[];let t=[],n=e.selectedComponents;for(let e=0;e<n.length;e++){let r=n[e],s=o.Component.getPropEditors(r);if(0==e)t=s||[];else{let e=[];t.forEach(t=>{s.forEach(n=>{let r=t.propName,o=n.propName;t.editorType==n.editorType&&r==o&&e.push(t)})}),t=e}}let s={};for(let e=0;e<n.length;e++){let t=n[e],r=Object.assign({},t.props);if(delete r.children,0==e)s=r;else{let e={};for(let t in s)s[t]==r[t]&&(e[t]=r[t]);s=e}}let l=t.map(e=>Object.assign(e.validation,{name:e.propName}));this._validator=new i.FormValidator(this.element,...l);let a=[];for(let o=0;o<t.length;o++){let l=t[o],i=l.propName,c=l.editorType,p=this.propValue(i,s);null==p&&(p=l.defaultValue);let u={value:p,editComponents:n,updateComponentProp:t=>{let r=n.map(e=>({componentId:e.id,propName:l.propName,value:t}));this._validator.checkElement(l.propName),e.updateComponentProps(r)}},m=r.createElement(c,u);a.push({prop:l.propName,displayName:l.displayName,editor:m,group:l.group})}return a}propValue(e,t){if(!e)throw s.Errors.argumentNull("propName");if(!t)throw s.Errors.argumentNull("props");let n=e.split("."),r=t;for(let e=0;e<n.length;e++)if(r=r[n[e]],null==r)return null;return r}render(){return r.createElement(l.DesignerContext.Consumer,null,e=>{let n=e.designer;if(null==n)return null;let o=this.getEditors(n);if(0==o.length){let e=this.props.empty;return r.createElement("div",{className:"text-center"},e)}if(this.props.customRender){let e=o.map(e=>Object.assign({displayName:e.displayName},e)),t=this.props.customRender(n.selectedComponents,e);if(null!=t)return t}let s=[];for(let e=0;e<o.length;e++){let n=o[e].group||t.defaultGroupName,r=s.filter(e=>e.group==n)[0];null==r&&(r={group:o[e].group,editors:[]},s.push(r)),r.editors.push({prop:o[e].prop,displayName:o[e].displayName,editor:o[e].editor})}return s.map(e=>r.createElement("div",{key:e.group,className:"panel panel-default"},e.group?r.createElement("div",{className:"panel-heading"},a.groupDisplayNames[e.group]||e.group):null,r.createElement("div",{className:"panel-body"},e.editors.map((e,t)=>r.createElement("div",{key:e.prop,className:"form-group clearfix"},r.createElement("label",null,e.displayName),r.createElement("div",{className:"control"},r.createElement(p,null,e.editor)))))))})}get element(){return this._element}get validator(){return this._validator}}t.PropertyEditor=c,c.contextType=l.DesignerContext;class p extends r.Component{constructor(e){super(e),this.state={}}componentDidCatch(e,t){this.setState({error:e})}render(){let{error:e}=this.state||{};return e?r.createElement("div",{className:"error"},r.createElement("div",null,e.message),r.createElement("div",null,e.stack)):this.props.children}}t.ErrorBoundary=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(1),s=n(12);t.DesignerContext=r.createContext({designer:null});class l extends r.Component{constructor(e){super(e),this.components={};let t=this.props.pageData;this.initPageData(t),this.state={pageData:t}}setComponetRefProp(e){let t={};l.travelComponentData(e).forEach(e=>{console.assert(null!=e.props&&null!=e.id),t[e.type]=t[e.type]||[],t[e.type].push(e.id);let n=e.props.ref;e.props.ref=t=>{null!=t&&(this.components[e.type]=this.components[e.type]||{},this.components[e.type][e.id]=t),"function"==typeof n&&n(t)}})}initPageData(e){null!=e&&(e.children=e.children||[],this.fillComponent(e),this.setComponetRefProp(e))}fillComponent(e){let t={};if(!e.name){let n,r=0;do{r+=1,n=`${e.type}${r}`}while(t[n]);t[n]=e,e.name=n}e.id||(e.id=s.guid()),e.children=e.children||[],e.children&&0!=e.children.length&&e.children.forEach(e=>{if("string"==typeof e)return!0;this.fillComponent(e)})}allComponents(){let e=[];for(let t in this.components){let n=Object.getOwnPropertyNames(this.components[t]);e.push(...n.map(e=>this.components[t][e]))}return e}get pageData(){return this.state.pageData}get selectedComponentIds(){return this.selectedComponents.map(e=>e.id)}get selectedComponents(){let e=new Array,t=new Array;for(t.push(this.pageData);t.length>0;){let n=t.pop();null!=n.props&&1==n.selected&&e.push(n),(n.children||[]).forEach(e=>{if("string"==typeof e)return!0;t.push(e)})}return e}get element(){return this._element}updateComponentProp(e,t,n){return this.updateComponentProps([{componentId:e,propName:t,value:n}])}updateComponentProps(e){let t=[];for(let n=0;n<e.length;n++){let{componentId:r,propName:o,value:s}=e[n],l=this.findComponentData(r);if(null==l)continue;let a=o.split(".");console.assert(null!=l),console.assert(null!=a,"props is null"),l.props=l.props||{};let i=l.props;for(let e=0;e<a.length-1;e++)i=i[a[e]]=i[a[e]]||{};i[a[a.length-1]]=s,t.push(l)}this.setState({pageData:this.pageData})}appendComponent(e,t,n){if(!e)throw o.Errors.argumentNull("parentId");if(!t)throw o.Errors.argumentNull("childComponent");this.initPageData(t);let r=this.findComponentData(e);if(null==r)throw new Error("Parent is not exists");console.assert(null!=r),r.children=r.children||[],null!=n?r.children.splice(n,0,t):r.children.push(t),this.selectComponents(t.id)}selectComponent(e){this.selectComponents(e),this._element&&this._element.focus()}selectComponents(e){"string"==typeof e&&(e=[e]);let t=this.selectedComponentIds;if(!this.isSame(e,t)){var n=[];for(n.push(this.pageData);n.length>0;){let t=n.pop(),r=e.indexOf(t.id)>=0;t.selected=r,(t.children||[]).forEach(e=>{if("string"==typeof e)return!0;n.push(e)})}this.setState({pageData:this.pageData})}}isSame(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(t.indexOf(e[n])<0)return!1;return!0}removeComponent(...e){this.removeComponents(e)}removeComponents(e){let t=this.pageData;if(!t||!t.children||0==t.children.length)return;let n=t.children;e.forEach(e=>{this.removeComponentFrom(e,n)}),this.setState({pageData:t})}moveComponent(e,t,n){let r=this.findComponentData(e);if(null==r)throw new Error(`Cannt find component by id ${e}`);console.assert(null!=r,`Cannt find component by id ${e}`);let o=this.pageData;console.assert(null!=o.children);let s=o.children;this.removeComponentFrom(e,s),this.appendComponent(t,r,n)}removeComponentFrom(e,t){let n=null;t=t||[];for(let r=0;r<t.length;r++){let o=t[r];if("string"!=typeof o&&e==o.id){n=r;break}}if(null==n){for(let n=0;n<t.length;n++){let r=t[n];if("string"==typeof r)continue;let o=r.children||[];o.forEach(t=>{if("string"==typeof t)return!0;return!!this.removeComponentFrom(e,o)||void 0})}return!1}return 0==n?t.shift():n==t.length-1?t.pop():t.splice(n,1),!0}static travelComponentData(e,t){let n=new Array;n.push(e);let r=[];for(t=t||(()=>!0);n.length>0;){let e=n.shift();t(e)&&r.push(e);let o=(e.children||[]).filter(e=>"object"==typeof e);n.push(...o)}return r}findComponentData(e){let t=this.state.pageData;if(!t)throw o.Errors.pageDataIsNull();return l.travelComponentData(t,t=>t.id==e)[0]}onKeyDown(e){if(46==e.keyCode){if(0==this.selectedComponents.length)return;this.removeComponents(this.selectedComponentIds)}}findComponetsByTypeName(e){this.components[e]}render(){return r.createElement("div",{tabIndex:0,ref:e=>this._element=this._element||e,onKeyDown:e=>this.onKeyDown(e),className:this.props.className,style:this.props.style},r.createElement(t.DesignerContext.Provider,{value:{designer:this}},this.props.children))}}t.PageDesigner=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);t.classNames={componentSelected:"component-selected",emptyTemplates:"empty-templates",loadingTemplates:"loading-templates",templateSelected:"template-selected",templateDialog:"template-dialog",emptyDocument:"empty-document",component:"component",componentWrapper:"component-wrapper",componentPanel:"component-panel",componentIcon:"component-icon",placeholder:"placeholder",editorPanel:"editor-panel",designer:"designer",moveDown:"move-down"};let o=40,s=22,l=document.createElement("style");l.type="text/css",l.setAttribute("data-name","jueying"),l.innerHTML=`\n            .${t.classNames.componentSelected} {\n                border: solid 1px #337ab7!important;\n            }\n            .${t.classNames.componentSelected} > :first-child {\n                border-color: blue;\n              }\n              .${t.classNames.componentSelected} .resize_handle {\n                position: absolute;\n                height: 6px;\n                width: 6px;\n                border: 1px solid #89B;\n                background: #9AC;\n              }\n              .${t.classNames.componentSelected} .move_handle {\n                height: 12px;\n                width: 12px;\n                top: 6px;\n                left: 8px;\n                border: solid 1px black;\n                position: relative;\n                margin-top: -12px;\n              }\n              .${t.classNames.componentSelected} .NW,\n              .${t.classNames.componentSelected} .NN,\n              .${t.classNames.componentSelected} .NE {\n                top: -4px;\n              }\n              .${t.classNames.componentSelected} .NE,\n              .${t.classNames.componentSelected} .EE,\n              .${t.classNames.componentSelected} .SE {\n                right: -4px;\n              }\n              .${t.classNames.componentSelected} .SW,\n              .${t.classNames.componentSelected}.SS,\n              .${t.classNames.componentSelected} .SE {\n                bottom: -4px;\n              }\n              .${t.classNames.componentSelected} .NW,\n              .${t.classNames.componentSelected} .WW,\n              .${t.classNames.componentSelected} .SW {\n                left: -4px;\n              }\n              .${t.classNames.componentSelected} .SE,\n              .${t.classNames.componentSelected} .NW {\n                cursor: nw-resize;\n              }\n              .${t.classNames.componentSelected} .SW,\n              .${t.classNames.componentSelected} .NE {\n                cursor: ne-resize;\n              }\n              .${t.classNames.componentSelected} .NN,\n              .${t.classNames.componentSelected} .SS {\n                cursor: n-resize;\n                left: 50%;\n                margin-left: -4px;\n              }\n              .${t.classNames.componentSelected} .EE,\n              .${t.classNames.componentSelected} .WW {\n                cursor: e-resize;\n                top: 50%;\n                margin-top: -4px;\n              }\n            .${t.classNames.emptyTemplates} {\n                padding:50px 0;\n                text-align: center;\n            }\n            .${t.classNames.loadingTemplates} {\n                padding:50px 0;\n                text-align: center;\n            }\n            .${t.classNames.templateSelected} .page-view {\n                border: solid 1px #337ab7!important;\n            }\n            .${t.classNames.templateDialog} .name {\n                margin-top: -${o}px;\n                height: ${o}px;\n                font-size: ${s}px;\n                text-align: center;\n                padding-top: 6px;\n                background-color: black;\n                opacity: 0.5;\n            }\n            .${t.classNames.templateDialog} .name span {\n                color: white;\n            }\n            .${t.classNames.emptyDocument} {\n                text-align: center;\n                padding: 100px 0;\n            }\n            .${t.classNames.component} > .NW,\n            .${t.classNames.component} > .NN,\n            .${t.classNames.component} > .NE,\n            .${t.classNames.component} > .EE,\n            .${t.classNames.component} > .SE,\n            .${t.classNames.component} > .SW,\n            .${t.classNames.component} > .SS,\n            .${t.classNames.component} > .WW {\n                display: none;\n            }\n            .${t.classNames.componentSelected}.component > .NW,\n            .${t.classNames.componentSelected}.component > .NN,\n            .${t.classNames.componentSelected}.component > .NE,\n            .${t.classNames.componentSelected}.component > .EE,\n            .${t.classNames.componentSelected}.component > .SE,\n            .${t.classNames.componentSelected}.component > .SW,\n            .${t.classNames.componentSelected}.component > .SS,\n            .${t.classNames.componentSelected}.component > .WW {\n                display: block;\n            }\n            .${t.classNames.placeholder} {\n                min-height: 40px;\n                width: 100%;\n            }\n            .${t.classNames.placeholder}.active,\n            .${t.classNames.componentWrapper}.active,\n            .${t.classNames.componentWrapper}.${t.classNames.componentSelected}.active {\n                border: 1px solid green;\n            }\n            .${t.classNames.editorPanel} {\n                width: 300px;\n                background: white;\n                color: black;\n                margin: 0;\n                font-size: 14px;\n                z-index: 100;\n                overflow: auto;\n            }\n            .${t.classNames.editorPanel} label {\n                width: 80px;\n                float: left;\n                padding: 4px;\n                text-overflow: ellipsis;\n                overflow: hidden;\n            }\n            .${t.classNames.editorPanel} .control {\n                padding-left: 90px;\n            }\n            .${t.classNames.editorPanel} .empty {\n                padding-top: 200px;\n                text-align: center;\n            }\n            .${t.classNames.designer} .error,\n            .${t.classNames.editorPanel} .error {\n                color: red;\n            }\n            .${t.classNames.componentPanel} {\n                background: white;\n                color: black;\n                font-size: 14px;\n                z-index: 100;\n                list-style: none;\n                padding: 0;\n                text-align: center\n            }\n            .${t.classNames.componentPanel} .panel-heading {\n                text-align: center;\n            }\n            .${t.classNames.componentPanel} li {\n                text-align: center;\n                padding: 8px;\n            }\n            .${t.classNames.componentWrapper}.${t.classNames.moveDown} {\n         \n            }\n        `,null!=document.head&&document.head.appendChild(l),t.appendClassName=function(e,t){if(null==e)throw r.Errors.argumentNull("element");if(!t)throw r.Errors.argumentNull("addonClassName");let n;if(n="string"==typeof e?e:e.className,n=n||"",console.assert(null!=t),n.indexOf(t)>=0)return n;let o=`${n} ${t}`;return"string"!=typeof e&&(e.className=o),o},t.removeClassName=function(e,t){let n;return n="string"==typeof e?e:e.className||"",n.indexOf(t)<0?n:(n=n||"",n=n.replace(new RegExp(t,"g"),""),n=n.trim(),"string"!=typeof e&&(e.className=n),n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.groupDisplayNames=r.groupDisplayNames;var o=n(3);t.Component=o.Component;var s=n(10);t.EditorPanel=s.EditorPanel;var l=n(5);t.PageDesigner=l.PageDesigner,t.DesignerContext=l.DesignerContext;var a=n(11);t.PropEditor=a.PropEditor,t.TextInput=a.TextInput;var i=n(6);t.classNames=i.classNames},function(e,t,n){
/*!
 * 
 *  maishu-dilu v1.7.1
 *  https://github.com/ansiboy/dilu
 *  
 *  Copyright (c) 2016-2018, shu mai <ansiboy@163.com>
 *  Licensed under the MIT License.
 * 
 */
var r;window,r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./out/index.js")}({"./out/errors.js":
/*!***********************!*\
  !*** ./out/errors.js ***!
  \***********************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors={argumentNull:e=>new Error(`Parameter ${e} can not be null or empty.`),elementValidateRuleNotSet(e){let t=`元素'${e.name}'没有设置验证规则`;return new Error(t)},fieldElementCanntNull:e=>new Error(null!=e?`The element value in the field cannt be null, field index is ${e}.`:"The element in the field is null"),elementNotExists:e=>new Error(`Element ${e} is not exits in the form.`),fieldResultExpectBooleanType:e=>new Error(`Result of ${e} field is expected boolean.`)}},"./out/formValidator.js":
/*!******************************!*\
  !*** ./out/formValidator.js ***!
  \******************************/
/*! no static exports found */function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function l(e){try{i(r.next(e))}catch(e){s(e)}}function a(e){try{i(r.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}i((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(/*! ./errors */"./out/errors.js");class s{constructor(e,...t){if(this.validateOnChanged=!0,!e)throw o.errors.argumentNull("form");this.fields=t||[],this.form=e,this.elementEvents={}}appendField(e){this.fields.push(e)}clearErrors(){this.fields.map(e=>e.errorElement).filter(e=>null!=e).forEach(e=>e.style.display="none")}clearElementError(e){if(!e)throw o.errors.argumentNull("name");let t=this.fields.filter(t=>t.name==e);for(let e of t)this.fieldErrorElement(e).style.display="none"}setElementError(e,t){if(!e)throw o.errors.argumentNull("name");if(!t)throw o.errors.argumentNull("error");let n=this.fields.filter(t=>t.name==e);for(let e of n){let n=this.fieldErrorElement(e);n.style.removeProperty("display"),n.innerHTML=t}}fieldElement(e){let t=e.name,n=this.form.querySelectorAll(`[name='${t}']`)[0];if(null==n)throw o.errors.elementNotExists(t);return n}fieldErrorElement(e){if(!e.errorElement){let t=this.form.getElementsByClassName(`${s.errorClassName} ${e.name}`)[0];if(!t){let n=this.fieldElement(e);t=document.createElement("span"),t.className=s.errorClassName,t.style.display="none",n.nextSibling?n.parentElement.insertBefore(t,n.nextSibling):n.parentElement.appendChild(t)}e.errorElement=t}return e.errorElement}check(){let e=new Array;for(let t=0;t<this.fields.length;t++){let n=this.fields[t],r=this.fieldElement(n);if(n.condition&&0==n.condition(r))continue;let o=this.checkField(n);e.push(o)}return 0==e.filter(e=>0==e).length}checkAsync(){return r(this,void 0,void 0,(function*(){let e=new Array;for(let t=0;t<this.fields.length;t++){let n=this.fields[t],r=this.fieldElement(n);if(n.condition&&0==n.condition(r))continue;let o=this.checkFieldAsync(n);e.push(o)}return 0==(yield Promise.all(e)).filter(e=>0==e).length}))}bindElementEvent(e,t){if(this.elementEvents[e.name])return;let n=this.fieldElement(e),r=(()=>{let n=!1;return()=>{n||(n=!0,t?this.checkFieldAsync(e).then(()=>n=!1).catch(()=>n=!1):(this.checkField(e),n=!1))}})();if(this.validateOnChanged){n.addEventListener("change",r);let e=n.type||"text";if("text"==e||"password"==e)n.addEventListener("keyup",r);else if("radio"==e){let e=n.name,t=this.form.querySelectorAll(`[name='${e}']`);for(let e=0;e<t.length;e++)t[e]!=n&&t[e].addEventListener("change",r)}}this.elementEvents[e.name]=!0}checkField(e){this.bindElementEvent(e,!1);let t=this.fieldElement(e),n=e.depends||[];for(let e=0;e<n.length;e++){let r=n[e](t);if("object"==typeof r)throw new Error("Please use checkAsync method.");if(!r)return!1}for(let t=0;t<e.rules.length;t++){let n=e.rules[t],r=this.fieldElement(e);if(null==r)throw o.errors.fieldElementCanntNull();let s=this.elementValue(r),l=n.validate(s);if("object"==typeof l)throw new Error("Please use checkAsync method.");if(this.showElement(!l,e,n,r),!l)return!1}return!0}checkFieldAsync(e){return r(this,void 0,void 0,(function*(){this.bindElementEvent(e,!0);let t=this.fieldElement(e),n=e.depends||[];for(let e=0;e<n.length;e++){let r=n[e](t);if("boolean"==typeof r&&(r=Promise.resolve(r)),!(yield r))return!1}for(let t=0;t<e.rules.length;t++){let n=e.rules[t],r=this.fieldElement(e);if(null==r)throw o.errors.fieldElementCanntNull();let s=this.elementValue(r),l=n.validate(s);"boolean"==typeof l&&(l=Promise.resolve(l));let a=yield l;if(this.showElement(!a,e,n,r),!a)return!1}return!0}))}showElement(e,t,n,r){let o=this.fieldErrorElement(t);if(console.assert(null!=o,"errorElement cannt be null."),null!=n.error){o=t.errorElement;let e=this.elementName(r),s="string"==typeof n.error?n.error:n.error()||"";o.innerHTML=s.replace("%s",e)}e?o.style.removeProperty("display"):o.style.display="none"}checkElementAsync(e){let t=this.fields.filter(t=>t.name==e)[0];if(!t)throw o.errors.elementNotExists(e);return this.checkFieldAsync(t)}checkElement(e){let t=this.fields.filter(t=>t.name==e)[0];if(!t)throw o.errors.elementNotExists(e);return this.checkField(t)}elementValue(e){if("TEXTAREA"==e.tagName)return e.value;let t=e;if("radio"==t.type){let e=this.form.querySelectorAll(`[name='${t.name}']`);for(let t=0;t<e.length;t++)if(e[t].checked)return e[t].value;return""}return e.value}elementName(e){return e.tagName,e.name}}t.FormValidator=s,s.errorClassName="validationMessage"},"./out/index.js":
/*!**********************!*\
  !*** ./out/index.js ***!
  \**********************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(/*! ./formValidator */"./out/formValidator.js");t.FormValidator=r.FormValidator;var o=n(/*! ./rules */"./out/rules.js");t.rules=o.rules},"./out/rules.js":
/*!**********************!*\
  !*** ./out/rules.js ***!
  \**********************/
/*! no static exports found */function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=/^[0-9]+$/,o=/^\-?[0-9]*\.?[0-9]+$/,s=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,l=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,a=/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,i=/^1[34578]\d{9}$/,c=/\d{4}-\d{1,2}-\d{1,2}/;let p="%s不能为空",u="%s与%s不匹配",m="%s和%s必须相同",d="%s至少包含%s个字符",h="The %s field must contain a number greater than %s.",f="The %s field must contain a number less than %s.",g="请数入数字",y="The %s field must contain a valid IP.",N="The %s field must contain a valid URL.",E="请输入正确的手机号码",v="请输入正确制";function w(e,t){return{validate:e,error:t}}function x(e){return"function"==typeof e?e():e}function b(e,t){let n;return n="number"==typeof t?o.test(e)?parseFloat(e):null:"string"==typeof t?e:function(e){if(!e.match("today")&&!e.match(c))return null;var t,n=new Date;return e.match("today")||(t=e.split("-"),n.setFullYear(t[0]),n.setMonth(t[1]-1),n.setDate(t[2])),n}(e),n<t?"lessThan":n>t?"greaterThan":"equal"}t.rules={required:e=>w(e=>""!=e,e||p),matches:(e,t)=>w(t=>t==e.value,t||p),email:e=>w(e=>s.test(e),e||p),minLength:(e,t)=>w(t=>(t||"").length>=x(e),t||d),maxLength:(e,t)=>w(t=>(t||"").length<=x(e),t||u),greaterThan:(e,t)=>w(t=>"greaterThan"==b(t,x(e)),t||h),lessThan:(e,t)=>w(t=>"lessThan"==b(t,x(e)),t||f),equal:(e,t)=>w(t=>"equal"==b(t,x(e)),t||m),ip:e=>w(e=>l.test(e),e||y),url:e=>w(e=>a.test(e),e||N),mobile:e=>w(e=>i.test(e),e||E),numeric:e=>w(e=>r.test(e),e||g),custom:(e,t)=>w(e,t||v)}}})},e.exports=r()},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(4),s=n(6);class l extends r.Component{constructor(e){super(e),this.state={componentDatas:[]}}validateInputs(){return this.editor.validator.checkAsync()}render(){let{empty:e}=this.props;return e=e||r.createElement("div",{className:"empty"},"暂无可用的属性"),r.createElement("div",{className:`${s.classNames.editorPanel} ${this.props.className||""}`,ref:e=>this.element=e||this.element},r.createElement(o.PropertyEditor,{ref:e=>this.editor=e||this.editor,empty:e,customRender:this.props.customRender}))}}t.EditorPanel=l},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function l(e){try{i(r.next(e))}catch(e){s(e)}}function a(e){try{i(r.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}i((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);class s extends o.Component{constructor(e){super(e)}static dropdown(e,t){return function(e,t){let n,l=[];if(null==t&&Array.isArray(e)){t=e.length>0&&"number"==typeof e[0]?"number":"string";for(let t=0;t<e.length;t++)l[t]={text:e[t],value:e[t]}}else if(null==t){t="string";let n=Object.getOwnPropertyNames(e);for(let t=0;t<n.length;t++)l[t]={text:e[n[t]],value:n[t]}}else Array.isArray(e)?l=e:n=e;return class extends s{constructor(e){super(e),this.state={}}componentDidMount(){return r(this,void 0,void 0,(function*(){if(n){let e=yield n;this.setState({items:e})}}))}render(){let{items:e}=this.state,{value:n}=this.props;return e=e||l,o.createElement("select",{className:"form-control",value:null==n?"":n,onChange:e=>{let r=e.target.value;if("number"==t){let e=/^[+-]?\d+(\.\d+)?$/;n=/^\d+$/.test(r)?parseInt(r):e.test(r)?parseFloat(r):null}else n=r;this.props.updateComponentProp(n)}},e.map(e=>o.createElement("option",{key:e.value,value:e.value},e.text)))}}}(e,t)}static textInput(){return l}}t.PropEditor=s;class l extends s{render(){let{value:e}=this.props;return o.createElement("input",{className:"form-control",value:e||"",onChange:e=>{this.props.updateComponentProp(e.target.value)}})}}t.TextInput=l},function(e,t,n){"use strict";function r(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function o(...e){if(0==(e=e||[]).length)return"";if(1==e.length)return e[0];let t=e.join("");return t=t.replace(/\/+/g,"/"),t}n.r(t);class s{argumentNull(e){let t=new Error(`Argument ${e} cannt be null or emtpy.`);return t.name="argumentNull",t}routeDataFieldNull(e){let t=new Error(`The ${e} field of route data cannt be null.`);return t.name="routeDataFieldNull",t}argumentFieldNull(e,t){let n=new Error(`The ${e} field of ${t} cannt be null.`);return n.name="argumentFieldNull",n}argumentTypeIncorrect(e,t){let n=new Error(`Argument ${e} type error, expected type is ${t}.`);return n.name="argumentTypeIncorrect",n}queryResultTypeError(){return new Error("Type of the query result is expected as Array or DataSourceSelectResult.")}}let l=new s;class a{constructor(){this.funcs=new Array}add(e){this.funcs.push(e)}remove(e){this.funcs=this.funcs.filter(t=>t!=e)}fire(e){this.funcs.forEach(t=>t(e))}static create(){return new a}}let i=Object.assign(l,{dataSourceCanntInsert:()=>new Error("DataSource can not insert."),dataSourceCanntDelete:()=>new Error("DataSource can not delete."),dataSourceCanntUpdate:()=>new Error("DataSource can not update."),primaryKeyNull:e=>new Error(`Primary key named '${e}' value is null.`)});class c{constructor(e){this.inserting=new a,this.inserted=new a,this.deleting=new a,this.deleted=new a,this.updating=new a,this.updated=new a,this.selecting=new a,this.selected=new a,this.error=new a,this.args=e,this.primaryKeys=e.primaryKeys||[]}get canDelete(){return null!=this.args.delete&&this.primaryKeys.length>0}get canInsert(){return null!=this.args.insert&&this.primaryKeys.length>0}get canUpdate(){return null!=this.args.update&&this.primaryKeys.length>0}executeInsert(e,t){return this.args.insert(e,t)}executeDelete(e,t){return this.args.delete(e,t)}executeUpdate(e,t){return this.args.update(e,t)}executeSelect(e){return e=e||{},this.args.select(e)}insert(e,t,n){if(!this.canInsert)throw i.dataSourceCanntInsert();if(!e)throw i.argumentNull("item");return"number"==typeof t&&(n=t,t=null),this.inserting.fire({sender:this,dataItem:e,index:n}),this.executeInsert(e,t).then(t=>(Object.assign(e,t),this.inserted.fire({sender:this,dataItem:e,index:n}),t)).catch(e=>{throw this.processError(e,"insert"),e})}delete(e,t){if(!this.canDelete)throw i.dataSourceCanntDelete();if(!e)throw i.argumentNull("item");return this.checkPrimaryKeys(e),this.deleting.fire({sender:this,dataItem:e}),this.executeDelete(e,t).then(t=>(this.deleted.fire({sender:this,dataItem:e}),t)).catch(e=>{throw this.processError(e,"delete"),e})}update(e,t){if(!this.canUpdate)throw i.dataSourceCanntUpdate();if(!e)throw i.argumentNull("item");return this.checkPrimaryKeys(e),this.updating.fire({sender:this,dataItem:e}),this.executeUpdate(e,t).then(t=>(Object.assign(e,t),this.updated.fire({sender:this,dataItem:e}),t)).catch(e=>{throw this.processError(e,"update"),e})}isSameItem(e,t){if(null==e)throw i.argumentNull("theItem");if(null==t)throw i.argumentNull("otherItem");if(0==this.primaryKeys.length)return e==t;this.checkPrimaryKeys(e),this.checkPrimaryKeys(t);for(let n of this.primaryKeys)if(e[n]!=t[n])return!1;return!0}checkPrimaryKeys(e){for(let t in e)if(null==e[t]&&this.primaryKeys.indexOf(t)>=0)throw i.primaryKeyNull(t)}select(e){return e=e||{},this.selecting.fire({sender:this,selectArguments:e}),this.executeSelect(e).then(e=>{let t,n;if(Array.isArray(e))t=e,n=e.length;else{if(void 0===e.dataItems||void 0===e.totalRowCount)throw i.queryResultTypeError();t=e.dataItems,n=e.totalRowCount}return this.selected.fire({sender:this,selectResult:{totalRowCount:n,dataItems:t}}),{totalRowCount:n,dataItems:t}}).catch(e=>{throw this.processError(e,"select"),e})}processError(e,t){if(e.method=t,this.error.fire({sender:this,error:e}),!e.handled)throw e}}class p{constructor(){this.startRowIndex=0,this.maximumRows=2147483647}}function u(e){let t=e.indexOf("?");return t<0?{}:function(e){let t,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(n," "))},s={};for(;t=r.exec(e);)s[o(t[1])]=o(t[2]);return s}(e.substr(t+1))}n.d(t,"guid",(function(){return r})),n.d(t,"pathContact",(function(){return o})),n.d(t,"Errors",(function(){return s})),n.d(t,"errors",(function(){return l})),n.d(t,"Callback",(function(){return a})),n.d(t,"DataSource",(function(){return c})),n.d(t,"DataSourceSelectArguments",(function(){return p})),n.d(t,"parseUrl",(function(){return u}))}])}));
//# sourceMappingURL=index.min.js.map
{"version":3,"sources":["webpack://jueying/webpack/universalModuleDefinition","webpack://jueying/webpack/bootstrap","webpack://jueying/external \"react\"","webpack://jueying/./out/errors.js","webpack://jueying/./node_modules/maishu-toolkit/out/guid.js","webpack://jueying/./node_modules/maishu-toolkit/out/errors.js","webpack://jueying/./node_modules/maishu-toolkit/out/callback.js","webpack://jueying/./node_modules/maishu-toolkit/out/data.js","webpack://jueying/./node_modules/maishu-toolkit/out/index.js","webpack://jueying/./out/style.js","webpack://jueying/./out/component.js","webpack://jueying/./out/page-designer.js","webpack://jueying/./out/components/master-page.js","webpack://jueying/./out/components/common.js","webpack://jueying/./out/components/index.js","webpack://jueying/./node_modules/maishu-jueying-core/out/index.js","webpack://jueying/./out/common.js","webpack://jueying/./out/property-editor.js","webpack://jueying/./out/prop-editor.js","webpack://jueying/./out/component-panel.js","webpack://jueying/./out/editor-panel.js","webpack://jueying/./out/component-data-handler.js","webpack://jueying/./out/index.js","webpack://jueying/./node_modules/maishu-jueying-core/out/decorators.js"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","enumerable","get","getter","value","key","bind","Object","prototype","hasOwnProperty","call","object","property","Errors","Error","fileName","argumentName","pluginId","componentId","componentName","fieldName","guid","s4","Math","floor","random","toString","substring","errors","error","name","expectedType","Callback","this","funcs","Array","func","push","filter","o","args","forEach","assign","dataSourceCanntInsert","dataSourceCanntDelete","dataSourceCanntUpdate","primaryKeyNull","classNames","componentSelected","emptyTemplates","loadingTemplates","templateSelected","templateDialog","emptyDocument","component","componentWrapper","componentPanel","componentIcon","placeholder","editorPanel","designer","moveDown","element","document","createElement","type","setAttribute","innerHTML","head","appendChild","Component","componentData","componentType","result","propEditorInfo","componentPropEditors","i","length","propName","display","componentPropEditorDisplay","controlClassName","getPropEditorByArray","propNames","options","editorType","editorDisplay","group","displayName","split","className","typename","classProps","join","attr","argumentNull","Fragment","componentTypes","DesignerContext","PageDesigner","props","super","components","pageData","initPageData","state","componentIds","travelComponentData","item","console","assert","id","itemRef","ref","e","names","getOwnPropertyNames","ids","indexOf","children","fillComponent","setComponetRefProp","namedComponents","num","child","r","selectedComponents","map","arr","stack","pop","selected","_element","updateComponentProps","componentProps","componentDatas","findComponentData","navPropsNames","obj","setState","parentId","componentIndex","parentControl","splice","selectComponents","position","setComponentsPosition","size","style","height","width","positions","toUpdateProps","left","top","focus","isSelectedControl","removeComponents","controlId","removeComponentFrom","childComponentIndex","appendComponent","collection","controlIndex","shift","pageDataIsNull","keyCode","selectedComponentIds","typeName","onKeyDown","Provider","MasterPageContext","master","childComponents","register","container","ComponentTypes","Text","PageView","PlaceHolder","constants","componentsDir","connectorElementClassName","componentTypeName","componentPosition","defineProperty","decorators_1","groupDisplayNames","defaultGroupName","PropertyEditor","commonPropEditorInfos","propEditorInfos","getPropEditors","items","propInfo1","propInfo2","propName1","propName2","commonFlatProps","control","controlProps","editors","editorProps","propValue","editComponents","updateComponentProp","editor","prop","Consumer","getEditors","empty","customRender","groupEditorsArray","groupEditors","g","ErrorBoundary","contextType","info","message","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","rejected","done","then","apply","PropEditor","valueType","itemsPromise","textValues","isArray","text","onChange","textValue","target","floatRegex","test","parseInt","parseFloat","dropdown","TextInput","ComponentPanel","componets","toolbarElement","toolItemElement","draggable","addEventListener","ev","dataTransfer","setData","JSON","stringify","x","offsetX","y","offsetY","str","getData","parse","c","componentIndexName","icon","fontSize","color","ctrl","componentDraggable","EditorPanel","_designer","ComponentDataHandler","_components","create","componentRemoved","componentAppend","componentUpdated","pageDataChanged","_pageData","initComponentData","fire","constructor"],"mappings":"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","file":"index.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"react\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"react\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"jueying\"] = factory(require(\"react\"));\n\telse\n\t\troot[\"jueying\"] = factory(root[\"react\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 14);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","export class Errors {\r\n    static placeHolderIdNull() {\r\n        let msg = `Place holder property id cannt be null or empty.`;\r\n        return new Error(msg);\r\n    }\r\n    static fileNotExists(fileName) {\r\n        return new Error(`File '${fileName}' is not exists.`);\r\n    }\r\n    static argumentNull(argumentName) {\r\n        return new Error(`Argument ${argumentName} is null or empty.`);\r\n    }\r\n    static argumentRangeError(argumentName) {\r\n        return new Error(`Argument ${argumentName} range error.`);\r\n    }\r\n    static pageDataIsNull() {\r\n        return new Error(`Page data is null.`);\r\n    }\r\n    static toolbarRequiredKey() {\r\n        return new Error(`Toolbar has not a key prop.`);\r\n    }\r\n    static loadPluginFail(pluginId) {\r\n        return new Error(`Load plugin '${pluginId}' fail.`);\r\n    }\r\n    static idRequired() {\r\n        return new Error(`Property id is required.`);\r\n    }\r\n    static canntFindMasterPage(componentId) {\r\n        return new Error(`Can not find master page for component container ${componentId}.`);\r\n    }\r\n    static propCanntNull(componentName, property) {\r\n        let msg = `${componentName} property ${property} cannt be null or empty.`;\r\n        return new Error(msg);\r\n    }\r\n    static argumentFieldCanntNull(fieldName, argumentName) {\r\n        let msg = `${fieldName} of argument ${argumentName} cannt be null or empty.`;\r\n        return new Error(msg);\r\n    }\r\n}\r\n//# sourceMappingURL=errors.js.map","export function guid() {\r\n    function s4() {\r\n        return Math.floor((1 + Math.random()) * 0x10000)\r\n            .toString(16)\r\n            .substring(1);\r\n    }\r\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n        s4() + '-' + s4() + s4() + s4();\r\n}\r\n","export class Errors {\r\n    argumentNull(argumentName) {\r\n        let error = new Error(`Argument ${argumentName} cannt be null or emtpy.`);\r\n        let name = \"argumentNull\";\r\n        error.name = name;\r\n        return error;\r\n    }\r\n    routeDataFieldNull(fieldName) {\r\n        let msg = `The ${fieldName} field of route data cannt be null.`;\r\n        let error = new Error(msg);\r\n        let name = \"routeDataFieldNull\";\r\n        error.name = name;\r\n        return error;\r\n    }\r\n    argumentFieldNull(fieldName, argumentName) {\r\n        let msg = `The ${fieldName} field of ${argumentName} cannt be null.`;\r\n        let error = new Error(msg);\r\n        let name = \"argumentFieldNull\";\r\n        error.name = name;\r\n        return error;\r\n    }\r\n    argumentTypeIncorrect(argumentName, expectedType) {\r\n        let msg = `Argument ${argumentName} type error, expected type is ${expectedType}.`;\r\n        let error = new Error(msg);\r\n        let name = \"argumentTypeIncorrect\";\r\n        error.name = name;\r\n        return error;\r\n    }\r\n    queryResultTypeError() {\r\n        let msg = 'Type of the query result is expected as Array or DataSourceSelectResult.';\r\n        return new Error(msg);\r\n    }\r\n}\r\nexport let errors = new Errors();\r\n","export class Callback {\r\n    constructor() {\r\n        this.funcs = new Array();\r\n    }\r\n    add(func) {\r\n        this.funcs.push(func);\r\n    }\r\n    remove(func) {\r\n        this.funcs = this.funcs.filter(o => o != func);\r\n    }\r\n    fire(args) {\r\n        this.funcs.forEach(o => o(args));\r\n    }\r\n    static create() {\r\n        return new Callback();\r\n    }\r\n}\r\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nimport { errors as baseErrors } from \"./errors\";\r\nimport { Callback } from \"./callback\";\r\nlet errors = Object.assign(baseErrors, {\r\n    dataSourceCanntInsert() {\r\n        return new Error(\"DataSource can not insert.\");\r\n    },\r\n    dataSourceCanntDelete() {\r\n        return new Error(\"DataSource can not delete.\");\r\n    },\r\n    dataSourceCanntUpdate() {\r\n        return new Error(\"DataSource can not update.\");\r\n    },\r\n    primaryKeyNull(key) {\r\n        let msg = `Primary key named '${key}' value is null.`;\r\n        return new Error(msg);\r\n    }\r\n});\r\nexport class DataSource {\r\n    constructor(args) {\r\n        this.inserting = new Callback(); //callbacks1<DataSource<T>, T, number>();\r\n        this.inserted = new Callback();\r\n        this.deleting = new Callback(); //callbacks<DataSource<T>, T>();\r\n        this.deleted = new Callback(); //callbacks<DataSource<T>, T>();\r\n        this.updating = new Callback();\r\n        this.updated = new Callback();\r\n        this.selecting = new Callback();\r\n        this.selected = new Callback(); //callbacks<DataSource<T>, DataSourceSelectResult<T>>();\r\n        this.error = new Callback(); //callbacks<this, DataSourceError>();\r\n        this.args = args;\r\n        this.primaryKeys = args.primaryKeys || [];\r\n    }\r\n    ; //callbacks<DataSource<T>, DataSourceSelectArguments>();\r\n    get canDelete() {\r\n        return this.args.delete != null && this.primaryKeys.length > 0;\r\n    }\r\n    get canInsert() {\r\n        return this.args.insert != null && this.primaryKeys.length > 0;\r\n    }\r\n    get canUpdate() {\r\n        return this.args.update != null && this.primaryKeys.length > 0;\r\n    }\r\n    executeInsert(item, args) {\r\n        return this.args.insert(item, args);\r\n    }\r\n    executeDelete(item, args) {\r\n        return this.args.delete(item, args);\r\n    }\r\n    executeUpdate(item, args) {\r\n        return this.args.update(item, args);\r\n    }\r\n    executeSelect(args) {\r\n        args = args || {};\r\n        return this.args.select(args);\r\n    }\r\n    insert(item, args, index) {\r\n        if (!this.canInsert)\r\n            throw errors.dataSourceCanntInsert();\r\n        if (!item)\r\n            throw errors.argumentNull(\"item\");\r\n        if (typeof args == 'number') {\r\n            index = args;\r\n            args = null;\r\n        }\r\n        this.inserting.fire({ sender: this, dataItem: item, index });\r\n        return this.executeInsert(item, args).then((data) => {\r\n            Object.assign(item, data);\r\n            this.inserted.fire({ sender: this, dataItem: item, index });\r\n            return data;\r\n        }).catch(exc => {\r\n            this.processError(exc, 'insert');\r\n            throw exc;\r\n        });\r\n    }\r\n    delete(item, args) {\r\n        if (!this.canDelete)\r\n            throw errors.dataSourceCanntDelete();\r\n        if (!item)\r\n            throw errors.argumentNull(\"item\");\r\n        this.checkPrimaryKeys(item);\r\n        this.deleting.fire({ sender: this, dataItem: item });\r\n        return this.executeDelete(item, args).then((data) => {\r\n            this.deleted.fire({ sender: this, dataItem: item });\r\n            return data;\r\n        }).catch(exc => {\r\n            this.processError(exc, 'delete');\r\n            throw exc;\r\n        });\r\n    }\r\n    update(item, args) {\r\n        if (!this.canUpdate)\r\n            throw errors.dataSourceCanntUpdate();\r\n        if (!item)\r\n            throw errors.argumentNull(\"item\");\r\n        this.checkPrimaryKeys(item);\r\n        this.updating.fire({ sender: this, dataItem: item });\r\n        return this.executeUpdate(item, args).then((data) => {\r\n            Object.assign(item, data);\r\n            this.updated.fire({ sender: this, dataItem: item });\r\n            return data;\r\n        }).catch((exc) => {\r\n            this.processError(exc, 'update');\r\n            throw exc;\r\n        });\r\n    }\r\n    isSameItem(theItem, otherItem) {\r\n        if (theItem == null)\r\n            throw errors.argumentNull('theItem');\r\n        if (otherItem == null)\r\n            throw errors.argumentNull('otherItem');\r\n        if (this.primaryKeys.length == 0)\r\n            return theItem == otherItem;\r\n        this.checkPrimaryKeys(theItem);\r\n        this.checkPrimaryKeys(otherItem);\r\n        for (let pk of this.primaryKeys) {\r\n            if (theItem[pk] != otherItem[pk])\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n    checkPrimaryKeys(item) {\r\n        for (let key in item) {\r\n            if (item[key] == null && this.primaryKeys.indexOf(key) >= 0)\r\n                throw errors.primaryKeyNull(key);\r\n        }\r\n    }\r\n    select(args) {\r\n        args = args || {};\r\n        // fireCallback(this.selecting, this, args);\r\n        this.selecting.fire({ sender: this, selectArguments: args });\r\n        return this.executeSelect(args).then((data) => {\r\n            let dataItems;\r\n            let totalRowCount;\r\n            if (Array.isArray(data)) {\r\n                dataItems = data;\r\n                totalRowCount = data.length;\r\n            }\r\n            else if (data.dataItems !== undefined && data.totalRowCount !== undefined) {\r\n                dataItems = data.dataItems;\r\n                totalRowCount = data.totalRowCount;\r\n            }\r\n            else {\r\n                throw errors.queryResultTypeError();\r\n            }\r\n            this.selected.fire({ sender: this, selectResult: { totalRowCount, dataItems } });\r\n            return { totalRowCount, dataItems };\r\n        }).catch(exc => {\r\n            this.processError(exc, 'select');\r\n            throw exc;\r\n        });\r\n    }\r\n    processError(exc, method) {\r\n        exc.method = method;\r\n        this.error.fire({ sender: this, error: exc });\r\n        if (!exc.handled)\r\n            throw exc;\r\n    }\r\n}\r\nexport class DataSourceSelectArguments {\r\n    constructor() {\r\n        this.startRowIndex = 0;\r\n        this.maximumRows = 2147483647;\r\n    }\r\n}\r\nexport class ArrayDataSource extends DataSource {\r\n    constructor(items) {\r\n        super({\r\n            select(args) {\r\n                return __awaiter(this, void 0, void 0, function* () {\r\n                    if (args.sortExpression) {\r\n                    }\r\n                    let dataItems = items.slice(args.startRowIndex, args.startRowIndex + args.maximumRows);\r\n                    let result = { dataItems, totalRowCount: items.length };\r\n                    return result;\r\n                });\r\n            }\r\n        });\r\n    }\r\n}\r\n// }\r\n","export { guid } from \"./guid\";\r\nexport { pathContact } from \"./path\";\r\nexport { Errors, errors } from \"./errors\";\r\nexport { Callback } from \"./callback\";\r\nexport { DataSource, DataSourceSelectArguments } from \"./data\";\r\nexport { parseUrl } from \"./url\";\r\n","import { Errors } from \"./errors\";\r\nexport let classNames = {\r\n    componentSelected: `component-selected`,\r\n    emptyTemplates: `empty-templates`,\r\n    loadingTemplates: `loading-templates`,\r\n    templateSelected: `template-selected`,\r\n    templateDialog: `template-dialog`,\r\n    emptyDocument: `empty-document`,\r\n    component: 'component',\r\n    componentWrapper: 'component-wrapper',\r\n    componentPanel: 'component-panel',\r\n    componentIcon: 'component-icon',\r\n    placeholder: 'placeholder',\r\n    editorPanel: 'editor-panel',\r\n    designer: 'designer',\r\n    moveDown: 'move-down',\r\n};\r\nlet templateDialog = {\r\n    nameHeight: 40,\r\n    fontSize: 22\r\n};\r\nlet element = document.createElement('style');\r\nelement.type = 'text/css';\r\nelement.setAttribute(\"data-name\", \"jueying\");\r\nelement.innerHTML = `\r\n            .${classNames.componentSelected} {\r\n                border: solid 1px #337ab7!important;\r\n            }\r\n            .${classNames.componentSelected} > :first-child {\r\n                border-color: blue;\r\n              }\r\n              .${classNames.componentSelected} .resize_handle {\r\n                position: absolute;\r\n                height: 6px;\r\n                width: 6px;\r\n                border: 1px solid #89B;\r\n                background: #9AC;\r\n              }\r\n              .${classNames.componentSelected} .move_handle {\r\n                height: 12px;\r\n                width: 12px;\r\n                top: 6px;\r\n                left: 8px;\r\n                border: solid 1px black;\r\n                position: relative;\r\n                margin-top: -12px;\r\n              }\r\n              .${classNames.componentSelected} .NW,\r\n              .${classNames.componentSelected} .NN,\r\n              .${classNames.componentSelected} .NE {\r\n                top: -4px;\r\n              }\r\n              .${classNames.componentSelected} .NE,\r\n              .${classNames.componentSelected} .EE,\r\n              .${classNames.componentSelected} .SE {\r\n                right: -4px;\r\n              }\r\n              .${classNames.componentSelected} .SW,\r\n              .${classNames.componentSelected}.SS,\r\n              .${classNames.componentSelected} .SE {\r\n                bottom: -4px;\r\n              }\r\n              .${classNames.componentSelected} .NW,\r\n              .${classNames.componentSelected} .WW,\r\n              .${classNames.componentSelected} .SW {\r\n                left: -4px;\r\n              }\r\n              .${classNames.componentSelected} .SE,\r\n              .${classNames.componentSelected} .NW {\r\n                cursor: nw-resize;\r\n              }\r\n              .${classNames.componentSelected} .SW,\r\n              .${classNames.componentSelected} .NE {\r\n                cursor: ne-resize;\r\n              }\r\n              .${classNames.componentSelected} .NN,\r\n              .${classNames.componentSelected} .SS {\r\n                cursor: n-resize;\r\n                left: 50%;\r\n                margin-left: -4px;\r\n              }\r\n              .${classNames.componentSelected} .EE,\r\n              .${classNames.componentSelected} .WW {\r\n                cursor: e-resize;\r\n                top: 50%;\r\n                margin-top: -4px;\r\n              }\r\n            .${classNames.emptyTemplates} {\r\n                padding:50px 0;\r\n                text-align: center;\r\n            }\r\n            .${classNames.loadingTemplates} {\r\n                padding:50px 0;\r\n                text-align: center;\r\n            }\r\n            .${classNames.templateSelected} .page-view {\r\n                border: solid 1px #337ab7!important;\r\n            }\r\n            .${classNames.templateDialog} .name {\r\n                margin-top: -${templateDialog.nameHeight}px;\r\n                height: ${templateDialog.nameHeight}px;\r\n                font-size: ${templateDialog.fontSize}px;\r\n                text-align: center;\r\n                padding-top: 6px;\r\n                background-color: black;\r\n                opacity: 0.5;\r\n            }\r\n            .${classNames.templateDialog} .name span {\r\n                color: white;\r\n            }\r\n            .${classNames.emptyDocument} {\r\n                text-align: center;\r\n                padding: 100px 0;\r\n            }\r\n            .${classNames.component} > .NW,\r\n            .${classNames.component} > .NN,\r\n            .${classNames.component} > .NE,\r\n            .${classNames.component} > .EE,\r\n            .${classNames.component} > .SE,\r\n            .${classNames.component} > .SW,\r\n            .${classNames.component} > .SS,\r\n            .${classNames.component} > .WW {\r\n                display: none;\r\n            }\r\n            .${classNames.componentSelected}.component > .NW,\r\n            .${classNames.componentSelected}.component > .NN,\r\n            .${classNames.componentSelected}.component > .NE,\r\n            .${classNames.componentSelected}.component > .EE,\r\n            .${classNames.componentSelected}.component > .SE,\r\n            .${classNames.componentSelected}.component > .SW,\r\n            .${classNames.componentSelected}.component > .SS,\r\n            .${classNames.componentSelected}.component > .WW {\r\n                display: block;\r\n            }\r\n            .${classNames.placeholder} {\r\n                min-height: 40px;\r\n                width: 100%;\r\n            }\r\n            .${classNames.placeholder}.active,\r\n            .${classNames.componentWrapper}.active,\r\n            .${classNames.componentWrapper}.${classNames.componentSelected}.active {\r\n                border: 1px solid green;\r\n            }\r\n            .${classNames.editorPanel} {\r\n                width: 300px;\r\n                background: white;\r\n                color: black;\r\n                margin: 0;\r\n                font-size: 14px;\r\n                z-index: 100;\r\n                overflow: auto;\r\n            }\r\n            .${classNames.editorPanel} label {\r\n                width: 80px;\r\n                float: left;\r\n                padding: 4px;\r\n                text-overflow: ellipsis;\r\n                overflow: hidden;\r\n            }\r\n            .${classNames.editorPanel} .control {\r\n                padding-left: 90px;\r\n            }\r\n            .${classNames.editorPanel} .empty {\r\n                padding-top: 200px;\r\n                text-align: center;\r\n            }\r\n            .${classNames.designer} .error,\r\n            .${classNames.editorPanel} .error {\r\n                color: red;\r\n            }\r\n            .${classNames.componentPanel} {\r\n                background: white;\r\n                color: black;\r\n                font-size: 14px;\r\n                z-index: 100;\r\n                list-style: none;\r\n                padding: 0;\r\n                text-align: center\r\n            }\r\n            .${classNames.componentPanel} .panel-heading {\r\n                text-align: center;\r\n            }\r\n            .${classNames.componentPanel} li {\r\n                text-align: center;\r\n                padding: 8px;\r\n            }\r\n            .${classNames.componentWrapper}.${classNames.moveDown} {\r\n         \r\n            }\r\n        `;\r\nif (document.head != null) {\r\n    document.head.appendChild(element);\r\n}\r\nexport function appendClassName(element, addonClassName) {\r\n    if (element == null)\r\n        throw Errors.argumentNull('element');\r\n    if (!addonClassName)\r\n        throw Errors.argumentNull('addonClassName');\r\n    let sourceClassName;\r\n    if (typeof element == 'string')\r\n        sourceClassName = element;\r\n    else\r\n        sourceClassName = element.className;\r\n    sourceClassName = sourceClassName || '';\r\n    console.assert(addonClassName != null);\r\n    if (sourceClassName.indexOf(addonClassName) >= 0)\r\n        return sourceClassName;\r\n    let className = `${sourceClassName} ${addonClassName}`;\r\n    if (typeof element != 'string')\r\n        element.className = className;\r\n    return className;\r\n}\r\nexport function removeClassName(element, targetClassName) {\r\n    let sourceClassName;\r\n    if (typeof element == 'string')\r\n        sourceClassName = element;\r\n    else\r\n        sourceClassName = element.className || '';\r\n    if (sourceClassName.indexOf(targetClassName) < 0)\r\n        return sourceClassName;\r\n    sourceClassName = sourceClassName || '';\r\n    sourceClassName = sourceClassName.replace(new RegExp(targetClassName, 'g'), '');\r\n    sourceClassName = sourceClassName.trim();\r\n    if (typeof element != 'string')\r\n        element.className = sourceClassName;\r\n    return sourceClassName;\r\n}\r\n//# sourceMappingURL=style.js.map","import { Errors } from \"./errors\";\r\nimport { defaultGroupName } from \"./property-editor\";\r\n// type CreateElementContext = { components: React.Component[], componentTypes: string[] };\r\n// let defaultGroup: GroupedEditor[\"group\"] = { prop: \"\", displayName: \"\" };\r\nexport class Component {\r\n    static getPropEditors(componentData) {\r\n        let componentType = componentData.type;\r\n        let result = [];\r\n        let propEditorInfo = this.componentPropEditors[componentType] || [];\r\n        for (let i = 0; i < propEditorInfo.length; i++) {\r\n            let propName = propEditorInfo[i].propName;\r\n            let display = Component.componentPropEditorDisplay[`${componentType}.${propName}`];\r\n            if (display != null && display(componentData) == false)\r\n                continue;\r\n            result.push(propEditorInfo[i]);\r\n        }\r\n        return result;\r\n    }\r\n    static getPropEditor(controlClassName, propName) {\r\n        return this.getPropEditorByArray(controlClassName, propName);\r\n    }\r\n    /** 通过属性数组获取属性的编辑器 */\r\n    static getPropEditorByArray(controlClassName, propNames) {\r\n        let classEditors = this.componentPropEditors[controlClassName] || [];\r\n        let editor = classEditors.filter(o => o.propName == propNames)[0];\r\n        return editor;\r\n    }\r\n    static setPropEditor(options) {\r\n        let { componentType, editorType, display: editorDisplay, group, propName, displayName } = options;\r\n        group = group || defaultGroupName;\r\n        propName = propName || \"\";\r\n        displayName = displayName || propName;\r\n        // 属性可能为导航属性,例如 style.width\r\n        let propNames = propName.split('.');\r\n        let className = typeof componentType == 'string' ? componentType : componentType.prototype.typename || componentType.name;\r\n        Component.componentPropEditorDisplay[`${className}.${propName}`] = editorDisplay;\r\n        let classProps = Component.componentPropEditors[className] = Component.componentPropEditors[className] || [];\r\n        for (let i = 0; i < classProps.length; i++) {\r\n            let propName1 = classProps[i].propName; //classProps[i].propNames.join('.')\r\n            let propName2 = propNames.join('.');\r\n            if (propName1 == propName2) {\r\n                classProps[i].editorType = editorType;\r\n                return;\r\n            }\r\n        }\r\n        classProps.push({ propName, displayName, editorType: editorType, group });\r\n    }\r\n    static register(componentName, componentType, attr) {\r\n        if (componentType == null && typeof componentName == 'function') {\r\n            componentType = componentName;\r\n            componentName = componentType.name;\r\n            componentType['componentName'] = componentName;\r\n        }\r\n        if (!componentName)\r\n            throw Errors.argumentNull('componentName');\r\n        if (!componentType)\r\n            throw Errors.argumentNull('componentType');\r\n    }\r\n}\r\n//==========================================\r\n// 用于创建 React 的 React.Fragment \r\nComponent.Fragment = \"\";\r\n//==========================================\r\nComponent.componentPropEditors = {};\r\nComponent.componentPropEditorDisplay = {};\r\nComponent.componentTypes = {};\r\n//# sourceMappingURL=component.js.map","import * as React from \"react\";\r\nimport { Errors } from \"./errors\";\r\nimport { guid } from \"maishu-toolkit\";\r\nexport let DesignerContext = React.createContext({ designer: null });\r\nexport class PageDesigner extends React.Component {\r\n    // private handler: ComponentDataHandler;\r\n    constructor(props) {\r\n        super(props);\r\n        // static defaultProps: Partial<PageDesignerProps> = { componentFactory: defaultComponentFactory };\r\n        this.components = {};\r\n        let pageData = this.props.pageData;\r\n        this.initPageData(pageData);\r\n        this.state = { pageData };\r\n        // this.handler = new ComponentDataHandler(pageData);\r\n        // this.handler.componentSelected.add(() => {\r\n        //     this.setState({ pageData: this.handler.pageData });\r\n        // })\r\n        // this.handler.componentRemoved.add(() => {\r\n        //     this.setState({ pageData: this.handler.pageData });\r\n        // })\r\n        // this.handler.componentUpdated.add(() => {\r\n        //     this.setState({ pageData: this.handler.pageData });\r\n        // })\r\n        // this.handler.pageDataChanged.add(args => {\r\n        //     this.setState({ pageData: args });\r\n        // })\r\n    }\r\n    setComponetRefProp(pageData) {\r\n        //=========================================================\r\n        // 纪录当前 pageData 控件 ID\r\n        let componentIds = {};\r\n        //=========================================================\r\n        PageDesigner.travelComponentData(pageData).forEach(item => {\r\n            console.assert(item.props != null && item.id != null);\r\n            componentIds[item.type] = componentIds[item.type] || [];\r\n            componentIds[item.type].push(item.props[\"id\"]);\r\n            let itemRef = item.props.ref;\r\n            item.props.ref = (e) => {\r\n                if (e != null) {\r\n                    this.components[item.type] = this.components[item.type] || [];\r\n                    this.components[item.type].push(e);\r\n                }\r\n                if (typeof itemRef == \"function\")\r\n                    itemRef(e);\r\n            };\r\n        });\r\n        //=========================================================\r\n        // 仅保留 componentIds 中的控件 \r\n        let names = Object.getOwnPropertyNames(this.components);\r\n        for (let i = 0; i < names.length; i++) {\r\n            let typename = names[i];\r\n            let ids = componentIds[typename] || [];\r\n            this.components[typename] = (this.components[typename] || []).filter(o => ids.indexOf(o[\"id\"] || o.props[\"id\"]) >= 0);\r\n        }\r\n        //=========================================================\r\n    }\r\n    initPageData(pageData) {\r\n        if (pageData == null) {\r\n            return;\r\n        }\r\n        pageData.children = pageData.children || [];\r\n        // PageDesigner.nameComponent(pageData);\r\n        this.fillComponent(pageData);\r\n        this.setComponetRefProp(pageData);\r\n    }\r\n    /**\r\n    * 对组件及其子控件进行命名\r\n    * @param component\r\n    */\r\n    fillComponent(component) {\r\n        let namedComponents = {};\r\n        // let props: any = component.props = component.props || {};\r\n        //==================================================\r\n        // 兼容旧版本代码\r\n        // if (props.id) {\r\n        //     component.id = props.id;\r\n        //     delete props.id;\r\n        // }\r\n        // if (props.parentId) {\r\n        //     component.parentId = props.parentId;\r\n        //     delete component.parentId;\r\n        // }\r\n        // if (props.selected) {\r\n        //     component.selected = props.selected;\r\n        // }\r\n        // if (props.name) {\r\n        //     component.name = props.name;\r\n        //     delete props.name;\r\n        // }\r\n        // if (props.attr) {\r\n        //     component.attr = props.attr;\r\n        //     delete props.attr;\r\n        // }\r\n        //==================================================\r\n        if (!component.name) {\r\n            let num = 0;\r\n            let name;\r\n            do {\r\n                num = num + 1;\r\n                name = `${component.type}${num}`;\r\n            } while (namedComponents[name]);\r\n            namedComponents[name] = component;\r\n            component.name = name;\r\n        }\r\n        if (!component.id)\r\n            component.id = guid();\r\n        component.children = component.children || [];\r\n        if (!component.children || component.children.length == 0) {\r\n            return;\r\n        }\r\n        component.children.forEach(child => {\r\n            if (typeof child == \"string\")\r\n                return true;\r\n            this.fillComponent(child);\r\n        });\r\n    }\r\n    allComponents() {\r\n        let r = [];\r\n        for (let key in this.components) {\r\n            r.push(...this.components[key]);\r\n        }\r\n        return r;\r\n    }\r\n    /** 页面数据 */\r\n    get pageData() {\r\n        return this.state.pageData;\r\n    }\r\n    /** 获取已选择了的组件编号 */\r\n    get selectedComponentIds() {\r\n        return this.selectedComponents.map(o => o.id);\r\n    }\r\n    /** 获取已选择了的组件 */\r\n    get selectedComponents() {\r\n        let arr = new Array();\r\n        let stack = new Array();\r\n        stack.push(this.pageData);\r\n        while (stack.length > 0) {\r\n            let item = stack.pop();\r\n            if (item.props != null && item.selected == true)\r\n                arr.push(item);\r\n            (item.children || []).forEach(child => {\r\n                if (typeof child == \"string\")\r\n                    return true;\r\n                stack.push(child);\r\n            });\r\n        }\r\n        return arr;\r\n    }\r\n    get element() {\r\n        return this._element;\r\n    }\r\n    updateComponentProp(componentId, propName, value) {\r\n        return this.updateComponentProps([{ componentId, propName, value }]);\r\n    }\r\n    updateComponentProps(componentProps) {\r\n        let componentDatas = [];\r\n        for (let i = 0; i < componentProps.length; i++) {\r\n            let { componentId, propName, value } = componentProps[i];\r\n            let componentData = this.findComponentData(componentId);\r\n            if (componentData == null)\r\n                continue;\r\n            let navPropsNames = propName.split(\".\");\r\n            console.assert(componentData != null);\r\n            console.assert(navPropsNames != null, 'props is null');\r\n            componentData.props = componentData.props || {};\r\n            let obj = componentData.props;\r\n            for (let i = 0; i < navPropsNames.length - 1; i++) {\r\n                obj = obj[navPropsNames[i]] = obj[navPropsNames[i]] || {};\r\n            }\r\n            obj[navPropsNames[navPropsNames.length - 1]] = value;\r\n            componentDatas.push(componentData);\r\n        }\r\n        // this.componentUpdated.fire(componentDatas);\r\n        this.setState({ pageData: this.pageData });\r\n    }\r\n    /**\r\n     * 添加控件\r\n     * @param parentId 父控件编号\r\n     * @param componentData 控件数据\r\n     * @param componentIndex 新添加组件在子组件中的次序\r\n     */\r\n    appendComponent(parentId, componentData, componentIndex) {\r\n        if (!parentId)\r\n            throw Errors.argumentNull('parentId');\r\n        if (!componentData)\r\n            throw Errors.argumentNull('childComponent');\r\n        this.initPageData(componentData);\r\n        let parentControl = this.findComponentData(parentId);\r\n        if (parentControl == null)\r\n            throw new Error('Parent is not exists');\r\n        console.assert(parentControl != null);\r\n        parentControl.children = parentControl.children || [];\r\n        if (componentIndex != null) {\r\n            parentControl.children.splice(componentIndex, 0, componentData);\r\n        }\r\n        else {\r\n            parentControl.children.push(componentData);\r\n        }\r\n        this.selectComponents(componentData.id);\r\n    }\r\n    /**\r\n     * 设置控件位置\r\n     * @param componentId 组件编号\r\n     * @param position 组件位置\r\n     */\r\n    setComponentPosition(componentId, position) {\r\n        return this.setComponentsPosition([{ componentId, position }]);\r\n    }\r\n    /**\r\n     * 设置控件大小\r\n     * @param componentId 组件编号\r\n     * @param size 组件大小\r\n     */\r\n    setComponentSize(componentId, size) {\r\n        console.assert(componentId != null);\r\n        console.assert(size != null);\r\n        let componentData = this.findComponentData(componentId);\r\n        if (!componentData)\r\n            throw new Error(`Control ${componentId} is not exits.`);\r\n        let style = componentData.props.style = (componentData.props.style || {});\r\n        if (size.height)\r\n            style.height = size.height;\r\n        if (size.width)\r\n            style.width = size.width;\r\n        let { pageData } = this.state;\r\n        this.setState({ pageData });\r\n        // this.componentUpdated.fire([componentData])\r\n    }\r\n    setComponentsPosition(positions) {\r\n        let toUpdateProps = [];\r\n        positions.forEach(o => {\r\n            let { componentId } = o;\r\n            let { left, top } = o.position;\r\n            let componentData = this.findComponentData(componentId);\r\n            if (!componentData)\r\n                throw new Error(`Control ${componentId} is not exits.`);\r\n            let style = componentData.props.style = (componentData.props.style || {});\r\n            if (left)\r\n                style.left = left;\r\n            if (top)\r\n                style.top = top;\r\n            toUpdateProps.push({ componentId, propName: \"style\", value: style });\r\n        });\r\n        this.updateComponentProps(toUpdateProps);\r\n    }\r\n    /**\r\n     * 选择指定的控件\r\n     * @param control 指定的控件\r\n     */\r\n    selectComponent(componentIds) {\r\n        this.selectComponents(componentIds);\r\n        //====================================================\r\n        // 设置焦点，以便获取键盘事件\r\n        if (this._element)\r\n            this._element.focus();\r\n        //====================================================\r\n    }\r\n    /**\r\n     * 选择指定的控件，一个或多个\r\n     * @param control 指定的控件\r\n     */\r\n    selectComponents(componentIds) {\r\n        if (typeof componentIds == 'string')\r\n            componentIds = [componentIds];\r\n        var stack = [];\r\n        stack.push(this.pageData);\r\n        while (stack.length > 0) {\r\n            let item = stack.pop();\r\n            let isSelectedControl = componentIds.indexOf(item.id) >= 0;\r\n            item.selected = isSelectedControl;\r\n            (item.children || []).forEach(child => {\r\n                if (typeof child == \"string\")\r\n                    return true;\r\n                stack.push(child);\r\n            });\r\n        }\r\n        this.setState({ pageData: this.pageData });\r\n    }\r\n    /** 移除控件 */\r\n    removeComponent(...componentIds) {\r\n        this.removeComponents(componentIds);\r\n    }\r\n    removeComponents(componentIds) {\r\n        let pageData = this.pageData;\r\n        if (!pageData || !pageData.children || pageData.children.length == 0)\r\n            return;\r\n        let children = pageData.children;\r\n        componentIds.forEach(controlId => {\r\n            this.removeComponentFrom(controlId, children);\r\n        });\r\n        this.setState({ pageData });\r\n    }\r\n    /**\r\n     * 移动控件到另外一个控件容器\r\n     * @param componentId 要移动的组件编号\r\n     * @param parentId 目标组件编号\r\n     * @param childComponentIndex 组件位置\r\n     */\r\n    moveComponent(componentId, parentId, childComponentIndex) {\r\n        let component = this.findComponentData(componentId);\r\n        if (component == null)\r\n            throw new Error(`Cannt find component by id ${componentId}`);\r\n        console.assert(component != null, `Cannt find component by id ${componentId}`);\r\n        let pageData = this.pageData;\r\n        console.assert(pageData.children != null);\r\n        let children = pageData.children; //translateComponentDataChildren(pageData.children);\r\n        this.removeComponentFrom(componentId, children);\r\n        this.appendComponent(parentId, component, childComponentIndex);\r\n    }\r\n    removeComponentFrom(controlId, collection) {\r\n        let controlIndex = null;\r\n        collection = collection || [];\r\n        for (let i = 0; i < collection.length; i++) {\r\n            let child = collection[i];\r\n            if (typeof child == \"string\")\r\n                continue;\r\n            if (controlId == child.id) {\r\n                controlIndex = i;\r\n                break;\r\n            }\r\n        }\r\n        if (controlIndex == null) {\r\n            for (let i = 0; i < collection.length; i++) {\r\n                let o = collection[i];\r\n                if (typeof o == \"string\")\r\n                    continue;\r\n                let children = o.children || [];\r\n                children.forEach(child => {\r\n                    if (typeof child == \"string\")\r\n                        return true;\r\n                    let isRemoved = this.removeComponentFrom(controlId, children);\r\n                    if (isRemoved) {\r\n                        return true;\r\n                    }\r\n                });\r\n            }\r\n            return false;\r\n        }\r\n        if (controlIndex == 0) {\r\n            collection.shift();\r\n        }\r\n        else if (controlIndex == collection.length - 1) {\r\n            collection.pop();\r\n        }\r\n        else {\r\n            collection.splice(controlIndex, 1);\r\n        }\r\n        return true;\r\n    }\r\n    static travelComponentData(pageData, filter) {\r\n        let stack = new Array();\r\n        stack.push(pageData);\r\n        let r = [];\r\n        // return new Promise((resolve, reject) => {\r\n        filter = filter || (() => true);\r\n        while (stack.length > 0) {\r\n            let item = stack.shift();\r\n            if (filter(item)) {\r\n                r.push(item);\r\n            }\r\n            //===============================================\r\n            // 子元素有可能为字符串, 过滤出对象\r\n            let children = (item.children || []).filter(o => typeof o == 'object');\r\n            //===============================================\r\n            stack.push(...children);\r\n        }\r\n        return r;\r\n    }\r\n    /**\r\n     * 通过组件编号获取组件的数据\r\n     * @param componentId 组件编号\r\n     */\r\n    findComponentData(componentId) {\r\n        let pageData = this.state.pageData;\r\n        if (!pageData)\r\n            throw Errors.pageDataIsNull();\r\n        let componentDatas = PageDesigner.travelComponentData(pageData, (item) => item.id == componentId);\r\n        return componentDatas[0];\r\n    }\r\n    onKeyDown(e) {\r\n        const DELETE_KEY_CODE = 46;\r\n        if (e.keyCode == DELETE_KEY_CODE) {\r\n            if (this.selectedComponents.length == 0)\r\n                return;\r\n            this.removeComponents(this.selectedComponentIds);\r\n        }\r\n    }\r\n    /**\r\n     * 通过组件名称获取组件实例\r\n     * @param typeName 组件名称\r\n     */\r\n    findComponetsByTypeName(typeName) {\r\n        this.components[typeName];\r\n    }\r\n    render() {\r\n        return React.createElement(\"div\", { ref: e => this._element = this._element || e, onKeyDown: e => this.onKeyDown(e), className: this.props.className, style: this.props.style },\r\n            React.createElement(DesignerContext.Provider, { value: { designer: this } }, this.props.children));\r\n    }\r\n}\r\n//# sourceMappingURL=page-designer.js.map","import * as React from \"react\";\r\nimport { Component } from \"../component\";\r\nexport const MasterPageName = 'MasterPage';\r\nexport const MasterPageContext = React.createContext({ master: null });\r\nexport class MasterPage extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.childComponents = {};\r\n        // let children: React.ReactElement<ComponentProps<any>>[] = MasterPage.children(props)\r\n        this.state = {};\r\n    }\r\n    // private static children(props: ComponentProps): React.ReactElement<ComponentProps<any>>[] {\r\n    //     let arr = props.children == null ? [] :\r\n    //         Array.isArray(props.children) ? props.children : [props.children];\r\n    //     let children: React.ReactElement<ComponentProps<any>>[] = []\r\n    //     arr.forEach(o => {\r\n    //         if (!React.isValidElement(o))\r\n    //             return\r\n    //         children.push(o as React.ReactElement<ComponentProps<any>>)\r\n    //     })\r\n    //     return children\r\n    // }\r\n    // static getDerivedStateFromProps(props: ComponentProps) {\r\n    //     let children: React.ReactElement<ComponentProps<any>>[] = MasterPage.children(props)\r\n    //     return { children } as MasterPage[\"state\"];\r\n    // }\r\n    render() {\r\n        // let props = {} as any\r\n        // for (let key in this.props) {\r\n        //     if (key == 'ref' || key == 'id')\r\n        //         continue\r\n        //     props[key] = this.props[key]\r\n        // }\r\n        // props.style = Object.assign({ minHeight: 40 }, props.style)\r\n        // let children = this.state.children.filter(o => o.props.parentId == null);\r\n        let master = this;\r\n        console.assert(master != null);\r\n        let children = this.props.children;\r\n        return React.createElement(MasterPageContext.Provider, { value: { master } }, children);\r\n    }\r\n}\r\nComponent.register(MasterPageName, MasterPage, { container: false });\r\n//# sourceMappingURL=master-page.js.map","export const ComponentTypes = {\r\n    Text: \"Text\",\r\n    PageView: \"PageView\",\r\n    PlaceHolder: \"PlaceHolder\"\r\n};\r\nexport let constants = {\r\n    componentsDir: 'components',\r\n    connectorElementClassName: 'component-container',\r\n    componentTypeName: 'data-component-name',\r\n    componentData: 'component-data',\r\n    componentPosition: \"component-position\"\r\n};\r\nexport { guid } from \"maishu-toolkit\";\r\n//# sourceMappingURL=common.js.map","export * from \"./master-page\";\r\n// export * from \"./place-holder\";\r\n// export * from \"./text\";\r\nexport { ComponentTypes, constants } from \"./common\";\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar decorators_1 = require(\"./decorators\");\r\nexports.component = decorators_1.component;\r\n//# sourceMappingURL=index.js.map","export let constants = {\r\n    componentsDir: 'components',\r\n    connectorElementClassName: 'component-container',\r\n    componentTypeName: 'data-component-name',\r\n    componentData: 'component-data',\r\n    componentPosition: \"component-position\"\r\n};\r\nexport let proptDisplayNames = {};\r\nexport let groupDisplayNames = {};\r\nexport function guid() {\r\n    function s4() {\r\n        return Math.floor((1 + Math.random()) * 0x10000)\r\n            .toString(16)\r\n            .substring(1);\r\n    }\r\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n        s4() + '-' + s4() + s4() + s4();\r\n}\r\nexport class Callback {\r\n    constructor() {\r\n        this.funcs = new Array();\r\n    }\r\n    add(func) {\r\n        this.funcs.push(func);\r\n    }\r\n    remove(func) {\r\n        this.funcs = this.funcs.filter(o => o != func);\r\n    }\r\n    fire(args) {\r\n        this.funcs.forEach(o => o(args));\r\n    }\r\n    static create() {\r\n        return new Callback();\r\n    }\r\n}\r\n//# sourceMappingURL=common.js.map","import * as React from \"react\";\r\nimport { Component } from \"./component\";\r\nimport { Errors } from \"./errors\";\r\nimport { DesignerContext } from \"./page-designer\";\r\nimport { groupDisplayNames } from \"./common\";\r\nexport let defaultGroupName = \"\";\r\nexport class PropertyEditor extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this._element = null;\r\n        this.state = {};\r\n    }\r\n    getEditors(designer) {\r\n        if (designer == null) {\r\n            return [];\r\n        }\r\n        // 各个控件相同的编辑器\r\n        let commonPropEditorInfos = [];\r\n        let selectedComponents = designer.selectedComponents;\r\n        for (let i = 0; i < selectedComponents.length; i++) {\r\n            let componentData = selectedComponents[i];\r\n            let propEditorInfos = Component.getPropEditors(componentData);\r\n            if (i == 0) {\r\n                commonPropEditorInfos = propEditorInfos || [];\r\n            }\r\n            else {\r\n                let items = [];\r\n                commonPropEditorInfos.forEach(propInfo1 => {\r\n                    propEditorInfos.forEach(propInfo2 => {\r\n                        let propName1 = propInfo1.propName; //propInfo1.propNames.join('.')\r\n                        let propName2 = propInfo2.propName; //propInfo2.propNames.join('.')\r\n                        if (propInfo1.editorType == propInfo2.editorType && propName1 == propName2) {\r\n                            items.push(propInfo1);\r\n                        }\r\n                    });\r\n                });\r\n                commonPropEditorInfos = items;\r\n            }\r\n        }\r\n        // 各个控件相同的属性值\r\n        let commonFlatProps = {};\r\n        for (let i = 0; i < selectedComponents.length; i++) {\r\n            let control = selectedComponents[i];\r\n            let controlProps = Object.assign({}, control.props);\r\n            delete controlProps.children;\r\n            // controlProps = this.flatProps(controlProps)\r\n            if (i == 0) {\r\n                commonFlatProps = controlProps;\r\n            }\r\n            else {\r\n                let obj = {};\r\n                for (let key in commonFlatProps) {\r\n                    if (commonFlatProps[key] == controlProps[key])\r\n                        obj[key] = controlProps[key];\r\n                }\r\n                commonFlatProps = obj;\r\n            }\r\n        }\r\n        let editors = [];\r\n        for (let i = 0; i < commonPropEditorInfos.length; i++) {\r\n            let propEditorInfo = commonPropEditorInfos[i];\r\n            let propName = propEditorInfo.propName;\r\n            ;\r\n            let editorType = propEditorInfo.editorType;\r\n            let value = this.propValue(propName, commonFlatProps);\r\n            let editorProps = {\r\n                value: value,\r\n                editComponents: selectedComponents,\r\n                updateComponentProp: (value) => {\r\n                    let componentProps = selectedComponents.map(o => ({\r\n                        componentId: o.id, propName: propEditorInfo.propName, value\r\n                    }));\r\n                    designer.updateComponentProps(componentProps);\r\n                }\r\n            };\r\n            let editor = React.createElement(editorType, editorProps);\r\n            editors.push({ prop: propEditorInfo.propName, displayName: propEditorInfo.displayName, editor, group: propEditorInfo.group });\r\n        }\r\n        return editors;\r\n    }\r\n    propValue(propName, props) {\r\n        if (!propName)\r\n            throw Errors.argumentNull(\"propName\");\r\n        if (!props)\r\n            throw Errors.argumentNull(\"props\");\r\n        let navPropsNames = propName.split(\".\");\r\n        let obj = props;\r\n        for (let i = 0; i < navPropsNames.length; i++) {\r\n            obj = obj[navPropsNames[i]];\r\n            if (obj == null)\r\n                return null;\r\n        }\r\n        return obj;\r\n    }\r\n    render() {\r\n        return React.createElement(DesignerContext.Consumer, null, args => {\r\n            let designer = args.designer;\r\n            if (designer == null)\r\n                return null;\r\n            let editors = this.getEditors(designer);\r\n            if (editors.length == 0) {\r\n                let empty = this.props.empty;\r\n                return React.createElement(\"div\", { className: \"text-center\" }, empty);\r\n            }\r\n            if (this.props.customRender) {\r\n                let items = editors.map(o => Object.assign({ displayName: o.displayName }, o));\r\n                let r = this.props.customRender(designer.selectedComponents, items);\r\n                if (r != null) {\r\n                    return r;\r\n                }\r\n            }\r\n            let groupEditorsArray = [];\r\n            for (let i = 0; i < editors.length; i++) {\r\n                let group = editors[i].group || defaultGroupName;\r\n                let groupEditors = groupEditorsArray.filter(o => o.group == group)[0];\r\n                if (groupEditors == null) {\r\n                    groupEditors = { group: editors[i].group, editors: [] };\r\n                    groupEditorsArray.push(groupEditors);\r\n                }\r\n                groupEditors.editors.push({ prop: editors[i].prop, displayName: editors[i].displayName, editor: editors[i].editor });\r\n            }\r\n            return groupEditorsArray.map((g) => React.createElement(\"div\", { key: g.group, className: \"panel panel-default\" },\r\n                g.group ? React.createElement(\"div\", { className: \"panel-heading\" }, groupDisplayNames[g.group] || g.group) : null,\r\n                React.createElement(\"div\", { className: \"panel-body\" }, g.editors.map((o, i) => React.createElement(\"div\", { key: o.prop, className: \"form-group clearfix\" },\r\n                    React.createElement(\"label\", null, o.displayName),\r\n                    React.createElement(\"div\", { className: \"control\" },\r\n                        React.createElement(ErrorBoundary, null, o.editor)))))));\r\n        });\r\n    }\r\n    get element() {\r\n        return this._element;\r\n    }\r\n}\r\nPropertyEditor.contextType = DesignerContext;\r\nexport class ErrorBoundary extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {};\r\n    }\r\n    componentDidCatch(error, info) {\r\n        // Display fallback UI\r\n        this.setState({ error });\r\n        // You can also log the error to an error reporting service\r\n        //   logErrorToMyService(error, info);\r\n    }\r\n    render() {\r\n        let { error } = this.state || {};\r\n        if (error) {\r\n            return React.createElement(\"div\", { className: \"error\" },\r\n                React.createElement(\"div\", null, error.message),\r\n                React.createElement(\"div\", null, error.stack));\r\n        }\r\n        return this.props.children;\r\n    }\r\n}\r\n//# sourceMappingURL=property-editor.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nimport * as React from \"react\";\r\nexport class PropEditor extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n    static dropdown(items, valueType) {\r\n        return dropdown(items, valueType);\r\n    }\r\n    static textInput() {\r\n        return TextInput;\r\n    }\r\n}\r\nexport class TextInput extends PropEditor {\r\n    render() {\r\n        let { value } = this.props;\r\n        return React.createElement(\"input\", { className: 'form-control', value: value || '', onChange: e => {\r\n                // this.setState({ value: e.target.value })\r\n                this.props.updateComponentProp(e.target.value);\r\n            } });\r\n    }\r\n}\r\nfunction dropdown(items, valueType) {\r\n    let itemsPromise;\r\n    let textValues = [];\r\n    if (valueType == null && Array.isArray(items)) {\r\n        valueType = items.length > 0 && typeof items[0] == \"number\" ? \"number\" : \"string\";\r\n        for (let i = 0; i < items.length; i++) {\r\n            textValues[i] = { text: items[i], value: items[i] };\r\n        }\r\n    }\r\n    else if (valueType == null) {\r\n        valueType = \"string\";\r\n        let propNames = Object.getOwnPropertyNames(items);\r\n        for (let i = 0; i < propNames.length; i++) {\r\n            textValues[i] = { text: items[propNames[i]], value: propNames[i] };\r\n        }\r\n    }\r\n    else if (Array.isArray(items)) {\r\n        textValues = items;\r\n    }\r\n    else {\r\n        itemsPromise = items;\r\n    }\r\n    class Dropdown extends PropEditor {\r\n        constructor(props) {\r\n            super(props);\r\n            this.state = {};\r\n        }\r\n        componentDidMount() {\r\n            return __awaiter(this, void 0, void 0, function* () {\r\n                if (itemsPromise) {\r\n                    let items = yield itemsPromise;\r\n                    this.setState({ items });\r\n                }\r\n            });\r\n        }\r\n        render() {\r\n            let { items } = this.state;\r\n            let { value } = this.props;\r\n            items = items || textValues;\r\n            return React.createElement(\"select\", { className: 'form-control', value: value == null ? \"\" : value, onChange: e => {\r\n                    let textValue = e.target.value;\r\n                    if (valueType == \"number\") {\r\n                        let integerRegex = /^\\d+$/;\r\n                        let floatRegex = /^[+-]?\\d+(\\.\\d+)?$/;\r\n                        if (integerRegex.test(textValue))\r\n                            value = parseInt(textValue);\r\n                        else if (floatRegex.test(textValue))\r\n                            value = parseFloat(textValue);\r\n                        else\r\n                            value = null;\r\n                    }\r\n                    else {\r\n                        value = textValue;\r\n                    }\r\n                    this.props.updateComponentProp(value);\r\n                } }, items.map(o => React.createElement(\"option\", { key: o.value, value: o.value }, o.text)));\r\n        }\r\n    }\r\n    return Dropdown;\r\n}\r\n//# sourceMappingURL=prop-editor.js.map","import * as React from \"react\";\r\nimport { constants } from \"./components/index\";\r\nimport { classNames } from \"./style\";\r\nexport class ComponentPanel extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { componets: [] };\r\n        this.designer = this.props.designer;\r\n    }\r\n    get element() {\r\n        return this.toolbarElement;\r\n    }\r\n    componentDraggable(toolItemElement, componentData) {\r\n        console.assert(toolItemElement != null);\r\n        toolItemElement.draggable = true;\r\n        toolItemElement.addEventListener('dragstart', function (ev) {\r\n            if (ev.dataTransfer == null)\r\n                return;\r\n            componentData.props = componentData.props || {};\r\n            ev.dataTransfer.setData(constants.componentData, JSON.stringify(componentData));\r\n            ev.dataTransfer.setData('mousePosition', JSON.stringify({ x: ev.offsetX, y: ev.offsetY }));\r\n        });\r\n    }\r\n    setComponets(componets) {\r\n        this.setState({ componets });\r\n    }\r\n    static getComponentData(dataTransfer) {\r\n        var str = dataTransfer.getData(constants.componentData);\r\n        console.assert(str != null);\r\n        return JSON.parse(str);\r\n    }\r\n    /** 获取光标在图标内的位置 */\r\n    static mouseInnerPosition(dataTransfer) {\r\n        let str = dataTransfer.getData('mousePosition');\r\n        console.assert(str != null);\r\n        return JSON.parse(str);\r\n    }\r\n    render() {\r\n        let empty = this.props.empty || React.createElement(\"div\", { className: \"empty\" }, \"\\u6682\\u65E0\\u53EF\\u7528\\u7EC4\\u4EF6\");\r\n        let props = Object.assign({}, this.props);\r\n        let componets = this.state.componets || [];\r\n        return React.createElement(\"ul\", Object.assign({}, props, { className: `${classNames.componentPanel} ${this.props.className || \"\"}`, ref: (e) => this.toolbarElement = this.toolbarElement || e }), componets.length == 0 ? empty : componets.map((c, i) => {\r\n            let props = { key: i };\r\n            props[ComponentPanel.componentIndexName] = `${i}`;\r\n            return React.createElement(\"li\", Object.assign({}, props, { className: classNames.componentIcon }),\r\n                React.createElement(\"div\", { className: \"btn-link\" },\r\n                    React.createElement(\"i\", { className: c.icon, style: { fontSize: 44, color: 'black' }, ref: e => {\r\n                            if (!e)\r\n                                return;\r\n                            let ctrl = c.componentData;\r\n                            this.componentDraggable(e, ctrl);\r\n                        } })),\r\n                React.createElement(\"div\", null, c.displayName));\r\n        }));\r\n    }\r\n}\r\nComponentPanel.componentIndexName = \"data-component-index\";\r\n//# sourceMappingURL=component-panel.js.map","import * as React from \"react\";\r\nimport { PropertyEditor } from \"./property-editor\";\r\nimport { classNames } from \"./style\";\r\nexport class EditorPanel extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { componentDatas: [] };\r\n    }\r\n    get designer() {\r\n        return this._designer;\r\n    }\r\n    render() {\r\n        let { empty } = this.props;\r\n        empty = empty || React.createElement(\"div\", { className: \"empty\" }, \"\\u6682\\u65E0\\u53EF\\u7528\\u7684\\u5C5E\\u6027\");\r\n        return React.createElement(\"div\", { className: `${classNames.editorPanel} ${this.props.className || \"\"}`, ref: (e) => this.element = e || this.element },\r\n            React.createElement(PropertyEditor, { ref: e => this.editor = e || this.editor, empty: empty, customRender: this.props.customRender }));\r\n    }\r\n}\r\n//# sourceMappingURL=editor-panel.js.map","import { Errors } from \"./errors\";\r\nimport { Callback, guid } from \"maishu-toolkit\";\r\nexport class ComponentDataHandler {\r\n    constructor(componentData) {\r\n        this._components = {};\r\n        this.componentSelected = Callback.create();\r\n        this.componentRemoved = Callback.create();\r\n        this.componentAppend = Callback.create();\r\n        this.componentUpdated = Callback.create();\r\n        this.pageDataChanged = Callback.create();\r\n        this._pageData = componentData;\r\n        this.initComponentData(this._pageData);\r\n    }\r\n    /** 对 pageData 字段补全 */\r\n    initComponentData(componentData) {\r\n        if (componentData == null) {\r\n            return;\r\n        }\r\n        componentData.children = componentData.children || [];\r\n        ComponentDataHandler.fillComponent(componentData);\r\n        ComponentDataHandler.setComponetRefProp(componentData, this._components);\r\n    }\r\n    /** 获取已选择了的组件 */\r\n    get selectedComponents() {\r\n        let arr = new Array();\r\n        let stack = new Array();\r\n        stack.push(this._pageData);\r\n        while (stack.length > 0) {\r\n            let item = stack.pop();\r\n            if (item.props != null && item.selected == true)\r\n                arr.push(item);\r\n            (item.children || []).forEach(child => {\r\n                if (typeof child == \"string\")\r\n                    return true;\r\n                stack.push(child);\r\n            });\r\n        }\r\n        return arr;\r\n    }\r\n    /** 获取已选择了的组件编号 */\r\n    get selectedComponentIds() {\r\n        return this.selectedComponents.map(o => o.id);\r\n    }\r\n    /**  */\r\n    get components() {\r\n        return this._components;\r\n    }\r\n    get pageData() {\r\n        return this._pageData;\r\n    }\r\n    set pageData(value) {\r\n        this._pageData = value;\r\n        this.initComponentData(value);\r\n        this.pageDataChanged.fire(value);\r\n    }\r\n    /**\r\n     * 移动控件到另外一个控件容器\r\n     * @param componentId 要移动的组件编号\r\n     * @param parentId 目标组件编号\r\n     * @param beforeChildId 组件的前一个子组件编号\r\n     */\r\n    moveComponent(componentId, parentId, childComponentIndex) {\r\n        let component = this.findComponentData(componentId);\r\n        if (component == null)\r\n            throw new Error(`Cannt find component by id ${componentId}`);\r\n        console.assert(component != null, `Cannt find component by id ${componentId}`);\r\n        let pageData = this.pageData;\r\n        console.assert(pageData.children != null);\r\n        let children = pageData.children; //translateComponentDataChildren(pageData.children);\r\n        this.removeComponentFrom(componentId, children);\r\n        this.appendComponent(parentId, component, childComponentIndex);\r\n    }\r\n    updateComponentProps(componentProps) {\r\n        let componentDatas = [];\r\n        for (let i = 0; i < componentProps.length; i++) {\r\n            let { componentId, propName, value } = componentProps[i];\r\n            let componentData = this.findComponentData(componentId);\r\n            if (componentData == null)\r\n                continue;\r\n            let navPropsNames = propName.split(\".\");\r\n            console.assert(componentData != null);\r\n            console.assert(navPropsNames != null, 'props is null');\r\n            componentData.props = componentData.props || {};\r\n            let obj = componentData.props;\r\n            for (let i = 0; i < navPropsNames.length - 1; i++) {\r\n                obj = obj[navPropsNames[i]] = obj[navPropsNames[i]] || {};\r\n            }\r\n            obj[navPropsNames[navPropsNames.length - 1]] = value;\r\n            componentDatas.push(componentData);\r\n        }\r\n        this.componentUpdated.fire(componentDatas);\r\n    }\r\n    findComponentData(componentId) {\r\n        let pageData = this._pageData;\r\n        if (!pageData)\r\n            throw Errors.pageDataIsNull();\r\n        // let stack = new Array<ComponentData>();\r\n        // stack.push(pageData);\r\n        // while (stack.length > 0) {\r\n        //     let item = stack.pop();\r\n        //     if (item == null)\r\n        //         continue\r\n        //     if (item.props.id == componentId)\r\n        //         return item;\r\n        //     let children = (item.children || []).filter(o => typeof o == 'object') as ComponentData[]\r\n        //     stack.push(...children);\r\n        // }\r\n        let componentDatas = ComponentDataHandler.travelComponentData(pageData, (item) => item.id == componentId);\r\n        return componentDatas[0];\r\n    }\r\n    removeComponentFrom(controlId, collection) {\r\n        let controlIndex = null;\r\n        collection = collection || [];\r\n        for (let i = 0; i < collection.length; i++) {\r\n            let child = collection[i];\r\n            if (typeof child == \"string\")\r\n                continue;\r\n            if (controlId == child.id) {\r\n                controlIndex = i;\r\n                break;\r\n            }\r\n        }\r\n        if (controlIndex == null) {\r\n            for (let i = 0; i < collection.length; i++) {\r\n                let o = collection[i];\r\n                if (typeof o == \"string\")\r\n                    continue;\r\n                let children = o.children;\r\n                if (children && children.length > 0) {\r\n                    let isRemoved = this.removeComponentFrom(controlId, children);\r\n                    if (isRemoved) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n        if (controlIndex == 0) {\r\n            collection.shift();\r\n        }\r\n        else if (controlIndex == collection.length - 1) {\r\n            collection.pop();\r\n        }\r\n        else {\r\n            collection.splice(controlIndex, 1);\r\n        }\r\n        return true;\r\n    }\r\n    static travelComponentData(pageData, filter) {\r\n        let stack = new Array();\r\n        stack.push(pageData);\r\n        let r = [];\r\n        // return new Promise((resolve, reject) => {\r\n        filter = filter || (() => true);\r\n        while (stack.length > 0) {\r\n            let item = stack.shift();\r\n            if (filter(item)) {\r\n                r.push(item);\r\n            }\r\n            //===============================================\r\n            // 子元素有可能为字符串, 过滤出对象\r\n            let children = (item.children || []).filter(o => typeof o == 'object');\r\n            //===============================================\r\n            stack.push(...children);\r\n        }\r\n        return r;\r\n    }\r\n    /**\r\n     * 添加控件\r\n     * @param parentId 父控件编号\r\n     * @param componentData 控件数据\r\n     * @param componentIndex 新添加组件在子组件中的次序\r\n     */\r\n    appendComponent(parentId, componentData, componentIndex) {\r\n        if (!parentId)\r\n            throw Errors.argumentNull('parentId');\r\n        if (!componentData)\r\n            throw Errors.argumentNull('childComponent');\r\n        this.initComponentData(componentData);\r\n        let parentControl = this.findComponentData(parentId);\r\n        if (parentControl == null)\r\n            throw new Error('Parent is not exists');\r\n        console.assert(parentControl != null);\r\n        parentControl.children = parentControl.children || [];\r\n        if (componentIndex != null) {\r\n            parentControl.children.splice(componentIndex, 0, componentData);\r\n        }\r\n        else {\r\n            parentControl.children.push(componentData);\r\n        }\r\n        this.selectComponents(componentData.id);\r\n        this.componentAppend.fire(this);\r\n    }\r\n    /**\r\n     * 对组件及其子控件进行命名\r\n     * @param component\r\n     */\r\n    static fillComponent(component) {\r\n        let namedComponents = {};\r\n        // let props: any = component.props = component.props || {};\r\n        //==================================================\r\n        // 兼容旧版本代码\r\n        // if (props.id) {\r\n        //     component.id = props.id;\r\n        //     delete props.id;\r\n        // }\r\n        // if (props.parentId) {\r\n        //     component.parentId = props.parentId;\r\n        //     delete component.parentId;\r\n        // }\r\n        // if (props.selected) {\r\n        //     component.selected = props.selected;\r\n        // }\r\n        // if (props.name) {\r\n        //     component.name = props.name;\r\n        //     delete props.name;\r\n        // }\r\n        // if (props.attr) {\r\n        //     component.attr = props.attr;\r\n        //     delete props.attr;\r\n        // }\r\n        //==================================================\r\n        if (!component.name) {\r\n            let num = 0;\r\n            let name;\r\n            do {\r\n                num = num + 1;\r\n                name = `${component.type}${num}`;\r\n            } while (namedComponents[name]);\r\n            namedComponents[name] = component;\r\n            component.name = name;\r\n        }\r\n        if (!component.id)\r\n            component.id = guid();\r\n        component.children = component.children || [];\r\n        if (!component.children || component.children.length == 0) {\r\n            return;\r\n        }\r\n        component.children.forEach(child => {\r\n            if (typeof child == \"string\")\r\n                return true;\r\n            ComponentDataHandler.fillComponent(child);\r\n        });\r\n    }\r\n    static setComponetRefProp(pageData, components) {\r\n        //=========================================================\r\n        // 纪录当前 pageData 控件 ID\r\n        let componentIds = {};\r\n        //=========================================================\r\n        ComponentDataHandler.travelComponentData(pageData).forEach(item => {\r\n            console.assert(item.props != null && item.id != null);\r\n            componentIds[item.type] = componentIds[item.type] || [];\r\n            componentIds[item.type].push(item.props[\"id\"]);\r\n            let itemRef = item.props.ref;\r\n            item.props.ref = (e) => {\r\n                if (e != null) {\r\n                    components[item.type] = components[item.type] || [];\r\n                    components[item.type].push(e);\r\n                }\r\n                if (typeof itemRef == \"function\")\r\n                    itemRef(e);\r\n            };\r\n        });\r\n        //=========================================================\r\n        // 仅保留 componentIds 中的控件 \r\n        let names = Object.getOwnPropertyNames(components);\r\n        for (let i = 0; i < names.length; i++) {\r\n            let typename = names[i];\r\n            let ids = componentIds[typename] || [];\r\n            components[typename] = (components[typename] || []).filter(o => ids.indexOf(o[\"id\"] || o.props[\"id\"]) >= 0);\r\n        }\r\n        //=========================================================\r\n    }\r\n    /**\r\n     * 选择指定的控件\r\n     * @param control 指定的控件\r\n     */\r\n    selectComponent(componentId) {\r\n        return this.selectComponents(componentId);\r\n    }\r\n    /**\r\n     * 选择指定的控件，一个或多个\r\n     * @param control 指定的控件\r\n     */\r\n    selectComponents(componentIds) {\r\n        if (typeof componentIds == 'string')\r\n            componentIds = [componentIds];\r\n        var stack = [];\r\n        stack.push(this._pageData);\r\n        while (stack.length > 0) {\r\n            let item = stack.pop();\r\n            let isSelectedControl = componentIds.indexOf(item.id) >= 0;\r\n            item.selected = isSelectedControl;\r\n            (item.children || []).forEach(child => {\r\n                if (typeof child == \"string\")\r\n                    return true;\r\n                stack.push(child);\r\n            });\r\n        }\r\n        this.componentSelected.fire(this.selectedComponentIds);\r\n    }\r\n    removeComponent(componentId) {\r\n        return this.removeComponents([componentId]);\r\n    }\r\n    /** 移除控件 */\r\n    removeComponents(componentIds) {\r\n        let pageData = this.pageData;\r\n        if (!pageData || !pageData.children || pageData.children.length == 0)\r\n            return;\r\n        let children = pageData.children;\r\n        componentIds.forEach(controlId => {\r\n            this.removeComponentFrom(controlId, children);\r\n        });\r\n        this.componentRemoved.fire(componentIds);\r\n    }\r\n    setComponentPosition(componentId, position) {\r\n        return this.setComponentsPosition([{ componentId, position }]);\r\n    }\r\n    setComponentsPosition(positions) {\r\n        let toUpdateProps = [];\r\n        positions.forEach(o => {\r\n            let { componentId } = o;\r\n            let { left, top } = o.position;\r\n            let componentData = this.findComponentData(componentId);\r\n            if (!componentData)\r\n                throw new Error(`Control ${componentId} is not exits.`);\r\n            let style = componentData.props.style = (componentData.props.style || {});\r\n            if (left)\r\n                style.left = left;\r\n            if (top)\r\n                style.top = top;\r\n            toUpdateProps.push({ componentId, propName: \"style\", value: style });\r\n        });\r\n        this.updateComponentProps(toUpdateProps);\r\n    }\r\n    /**\r\n * 设置控件大小\r\n * @param componentId 组件编号\r\n * @param size 组件大小\r\n */\r\n    setComponentSize(componentId, size) {\r\n        console.assert(componentId != null);\r\n        console.assert(size != null);\r\n        let componentData = this.findComponentData(componentId);\r\n        if (!componentData)\r\n            throw new Error(`Control ${componentId} is not exits.`);\r\n        let style = componentData.props.style = (componentData.props.style || {});\r\n        if (size.height)\r\n            style.height = size.height;\r\n        if (size.width)\r\n            style.width = size.width;\r\n        // this.componentUpdated.fire([componentData])\r\n        this.updateComponentProps([{ componentId, propName: \"style\", value: style }]);\r\n    }\r\n}\r\n//# sourceMappingURL=component-data-handler.js.map","// import './jquery';\r\n// import '../lib/jquery.event.drag-2.2';\r\n// import '../lib/jquery.event.drag.live-2.2';\r\n// import '../lib/jquery.event.drop-2.2';\r\n// import '../lib/jquery.event.drop.live-2.2';\r\nexport { groupDisplayNames } from \"./common\";\r\nexport { Component } from \"./component\";\r\nexport { ComponentPanel } from \"./component-panel\";\r\nexport { EditorPanel } from \"./editor-panel\";\r\nexport { PageDesigner, DesignerContext, } from \"./page-designer\";\r\nexport { PropEditor, TextInput, } from \"./prop-editor\";\r\nexport { classNames } from \"./style\";\r\nexport { ComponentDataHandler } from \"./component-data-handler\";\r\nexport * from \"./components/index\";\r\nexport * from \"maishu-jueying-core\";\r\nexport { component } from \"maishu-jueying-core\";\r\n//# sourceMappingURL=index.js.map","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/** 组件标记，用于将指定的组件标记为可被外部加载 */\r\nfunction component(options) {\r\n    return function classDecorator(constructor) {\r\n    };\r\n}\r\nexports.component = component;\r\n//# sourceMappingURL=decorators.js.map"],"sourceRoot":""}